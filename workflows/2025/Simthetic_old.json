{
  "active": false,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Get Jsons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "convert-to-csv",
            "type": "main",
            "index": 0
          },
          {
            "node": "convert-to-txt",
            "type": "main",
            "index": 0
          },
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Convert to txt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "convert-to-csv": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "convert-to-txt": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to txt": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Compression1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "convert-to-csv",
            "type": "main",
            "index": 0
          },
          {
            "node": "convert-to-txt",
            "type": "main",
            "index": 0
          },
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extract_jsons": {
      "main": [
        [
          {
            "node": "validate_documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "validate_documents": {
      "main": [
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "extract_jsons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "validate_documents1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Insert rows in a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "validate_documents1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Jsons": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "Insert rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook2": {
      "main": [
        [
          {
            "node": "list-all-simulations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook3": {
      "main": [
        [
          {
            "node": "view-specific-simulation-documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "list-all-simulations": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "view-specific-simulation-documents": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Compression",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compression1": {
      "main": [
        [
          {
            "node": "Decompress",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Decompress": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compression": {
      "main": [
        [
          {
            "node": "Decompress1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Decompress1": {
      "main": [
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook4": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          },
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code13": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        []
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Select rows from a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "Code9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Select rows from a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table1": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code9": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "documentCounts": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table": {
      "main": [
        [
          {
            "node": "documentCounts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        []
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        []
      ]
    },
    "Webhook5": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "balance_sheet": {
      "ai_tool": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "invoice": {
      "ai_tool": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook6": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out7": {
      "main": [
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Aggregate6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields16": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Wire Transfer1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Bank_Statement1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Invoice(Goods)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Expenses Sub-Ledger1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Disbursement Listing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "invoices_services1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Purchase Order1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Shipping Document (Sending)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Shipping Document (Receiving)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Order Document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent25": {
      "main": [
        [
          {
            "node": "AI Agent44",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent25",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent26": {
      "main": [
        [
          {
            "node": "AI Agent36",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model16": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent26",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent27": {
      "main": [
        [
          {
            "node": "AI Agent38",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model17": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent27",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File18": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "AI Agent28": {
      "main": [
        [
          {
            "node": "AI Agent39",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model18": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent28",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File19": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "AI Agent29": {
      "main": [
        [
          {
            "node": "AI Agent37",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model19": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent29",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File20": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "AI Agent30": {
      "main": [
        [
          {
            "node": "AI Agent40",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model20": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent30",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File21": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 6
          }
        ]
      ]
    },
    "AI Agent31": {
      "main": [
        [
          {
            "node": "AI Agent41",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model21": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent31",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File22": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 7
          }
        ]
      ]
    },
    "AI Agent32": {
      "main": [
        [
          {
            "node": "AI Agent42",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model22": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent32",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File23": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 8
          }
        ]
      ]
    },
    "AI Agent33": {
      "main": [
        [
          {
            "node": "AI Agent43",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model23": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent33",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File24": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 9
          }
        ]
      ]
    },
    "Aggregate6": {
      "main": [
        [
          {
            "node": "Compression2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table5": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Edit Fields29",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit Fields17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields17": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "AI Agent34": {
      "main": [
        [
          {
            "node": "AI Agent35",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model24": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent34",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wire Transfer1": {
      "main": [
        [
          {
            "node": "AI Agent25",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bank_Statement1": {
      "main": [
        [
          {
            "node": "AI Agent34",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Invoice(Goods)1": {
      "main": [
        [
          {
            "node": "AI Agent26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Expenses Sub-Ledger1": {
      "main": [
        [
          {
            "node": "AI Agent27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disbursement Listing1": {
      "main": [
        [
          {
            "node": "AI Agent28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "invoices_services1": {
      "main": [
        [
          {
            "node": "AI Agent29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Purchase Order1": {
      "main": [
        [
          {
            "node": "AI Agent30",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shipping Document (Sending)1": {
      "main": [
        [
          {
            "node": "AI Agent31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shipping Document (Receiving)1": {
      "main": [
        [
          {
            "node": "AI Agent32",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Order Document1": {
      "main": [
        [
          {
            "node": "AI Agent33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initial1": {
      "main": [
        [
          {
            "node": "Select rows from a table5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields18": {
      "main": [
        [
          {
            "node": "Edit Fields31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table6": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Convert to File25",
            "type": "main",
            "index": 0
          },
          {
            "node": "Convert to File17",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields30",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File25": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent35": {
      "main": [
        [
          {
            "node": "Code12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent35",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent36": {
      "main": [
        [
          {
            "node": "Code15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model11": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent36",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent37": {
      "main": [
        [
          {
            "node": "Code18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model12": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent37",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent38": {
      "main": [
        [
          {
            "node": "Code16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model13": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent38",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent39": {
      "main": [
        [
          {
            "node": "Code17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model14": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent39",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent40": {
      "main": [
        [
          {
            "node": "Code19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model15": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent40",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent41": {
      "main": [
        [
          {
            "node": "Code20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model16": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent41",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent42": {
      "main": [
        [
          {
            "node": "Code21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model17": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent42",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent43": {
      "main": [
        [
          {
            "node": "Code22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model18": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent43",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent44": {
      "main": [
        [
          {
            "node": "Code14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model19": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent44",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields19": {
      "main": [
        [
          {
            "node": "Convert to File3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File3": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code12": {
      "main": [
        [
          {
            "node": "Edit Fields19",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent34",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields20": {
      "main": [
        [
          {
            "node": "Convert to File16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File16": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code14": {
      "main": [
        [
          {
            "node": "Edit Fields20",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent25",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields21": {
      "main": [
        [
          {
            "node": "Convert to File15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File15": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Code15": {
      "main": [
        [
          {
            "node": "Edit Fields21",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields22": {
      "main": [
        [
          {
            "node": "Convert to File18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code16": {
      "main": [
        [
          {
            "node": "Edit Fields22",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields23": {
      "main": [
        [
          {
            "node": "Convert to File19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code17": {
      "main": [
        [
          {
            "node": "Edit Fields23",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields24": {
      "main": [
        [
          {
            "node": "Convert to File20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code18": {
      "main": [
        [
          {
            "node": "Edit Fields24",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields25": {
      "main": [
        [
          {
            "node": "Convert to File21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code19": {
      "main": [
        [
          {
            "node": "Edit Fields25",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent30",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields26": {
      "main": [
        [
          {
            "node": "Convert to File22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code20": {
      "main": [
        [
          {
            "node": "Edit Fields26",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields27": {
      "main": [
        [
          {
            "node": "Convert to File23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code21": {
      "main": [
        [
          {
            "node": "Edit Fields27",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent32",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields28": {
      "main": [
        [
          {
            "node": "Convert to File24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code22": {
      "main": [
        [
          {
            "node": "Edit Fields28",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields29": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Split Out7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split Out8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out8": {
      "main": [
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compression2": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Update rows in a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File17": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge6": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Edit Fields18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields14": {
      "main": [
        [
          {
            "node": "Edit Fields31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields30": {
      "main": [
        [
          {
            "node": "Initial1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields31": {
      "main": [
        [
          {
            "node": "Select rows from a table6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook7": {
      "main": [
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-07-11T10:25:22.765Z",
  "id": "ZQ7ogeBD0qiSBtBM",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Simthetic_old",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "simthetic",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4260,
        1140
      ],
      "id": "63176970-38be-4e4e-97ee-694e8b116bc8",
      "name": "Webhook",
      "webhookId": "68f81f33-928d-4610-9a0b-0728caa8f9a6"
    },
    {
      "parameters": {
        "content": "# Example Request:\n\ncurl -X POST https://n8n.simthetic.ai/webhook-test/simthetic \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"projectName\": \"Abc project\",\n    \"scenarioName\": \"Scenario 1\",\n    \"documents\": [\n      {\n        \"docType\": \"Invoice\",\n        \"variables\": [\n          {\n            \"name\": \"Invoice Number\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\", \"Invalid\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Amount\",\n            \"type\": \"float\",\n            \"min\": 1000,\n            \"max\": 100000,\n            \"spectrum\": [\"Mismatch\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Date\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Invalid\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Vendor Name\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"PO Reference\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"dependent\",\n            \"dependentOn\": \"Purchase Order.PO Number\"\n          }\n        ]\n      },\n      {\n        \"docType\": \"Purchase Order\",\n        \"variables\": [\n          {\n            \"name\": \"PO Number\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Total PO Value\",\n            \"type\": \"float\",\n            \"min\": 1000,\n            \"max\": 100000,\n            \"spectrum\": [\"Incorrect\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Vendor Name\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Delivery Date\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Invalid\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Terms\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [],\n            \"variableType\": \"independent\"\n          }\n        ]\n      },\n      {\n        \"docType\": \"Payment Voucher\",\n        \"variables\": [\n          {\n            \"name\": \"Voucher ID\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Amount\",\n            \"type\": \"float\",\n            \"min\": 1000,\n            \"max\": 100000,\n            \"spectrum\": [\"Mismatch\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Payee Name\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Payment Method\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Invalid\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"GL Code\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          }\n        ]\n      },\n      {\n        \"docType\": \"Bank Statement\",\n        \"variables\": [\n          {\n            \"name\": \"Transaction Date\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Withdrawal Amount\",\n            \"type\": \"float\",\n            \"min\": 0,\n            \"max\": 1000000,\n            \"spectrum\": [\"Incorrect\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Deposit Amount\",\n            \"type\": \"float\",\n            \"min\": 0,\n            \"max\": 1000000,\n            \"spectrum\": [\"Incorrect\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Balance\",\n            \"type\": \"float\",\n            \"min\": -1000000,\n            \"max\": 1000000,\n            \"spectrum\": [\"Negative\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Account Number\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          }\n        ]\n      },\n      {\n        \"docType\": \"Wire Transfer\",\n        \"variables\": [\n          {\n            \"name\": \"Date\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Invalid\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Withdrawal Amount\",\n            \"type\": \"float\",\n            \"min\": 1000,\n            \"max\": 100000,\n            \"spectrum\": [\"Mismatch\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Payee\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          },\n          {\n            \"name\": \"Account Number\",\n            \"type\": \"string\",\n            \"min\": null,\n            \"max\": null,\n            \"spectrum\": [\"Missing\"],\n            \"variableType\": \"independent\"\n          }\n        ]\n      }\n    ]\n  }'",
        "height": 700,
        "width": 600,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4640,
        800
      ],
      "typeVersion": 1,
      "id": "fcb27750-9f03-49a1-bbd1-778cf808e45a",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "42655bdb-2848-4148-8c7b-21468612e302",
              "name": "body",
              "value": "={{ $('convert-to-csv').item.json }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3200,
        2000
      ],
      "id": "76c0ba3b-113e-43c1-9b34-2d2a3b459137",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "simthetic-docs",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4160,
        2540
      ],
      "id": "31fc806a-c481-4783-a6c8-170b5a6f3741",
      "name": "Webhook1",
      "webhookId": "68f81f33-928d-4610-9a0b-0728caa8f9a6"
    },
    {
      "parameters": {
        "respondWith": "binary",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        -1440,
        2520
      ],
      "id": "c36e2639-1138-4f64-951f-70bd6e32a904",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "42655bdb-2848-4148-8c7b-21468612e302",
              "name": "body",
              "value": "={{ $json.body }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3240,
        2520
      ],
      "id": "9830aba3-d90e-4230-bd44-16c869a96892",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "const makeSafe = (name) => name.replace(/[^a-zA-Z0-9-_]/g, '_');\n\nconst doc = $json.body; // FIX: Get actual document from nested \"body\"\n\nconst title = doc.title;\nconst data = doc.data;\nconst errorTypes = doc.errorTypes;\nconst errorDetails = doc.errorDetails;\n\nlet text = `===== ${title} =====\\n\\n`;\n\ntext += `--- Document Fields ---\\n`;\nfor (const [key, value] of Object.entries(data)) {\n  text += `${key}: ${value}\\n`;\n}\n\ntext += `\\n--- Error Types ---\\n`;\nerrorTypes.forEach(type => {\n  text += `- ${type}\\n`;\n});\n\ntext += `\\n--- Error Details ---\\n`;\nerrorDetails.forEach((err, i) => {\n  text += `Error ${i + 1}:\\n`;\n  text += `  Field: ${err.field}\\n`;\n  text += `  Original: ${err.original}\\n`;\n  text += `  Error: ${err.error}\\n`;\n  text += `  Type: ${err.type}\\n`;\n  text += `  Description: ${err.description}\\n\\n`;\n});\n\nreturn [\n  {\n    json: {\n      fileName: `${makeSafe(title)}.txt`,\n      fileContent: text,\n    }\n  }\n];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2580,
        2520
      ],
      "id": "ac2f5735-3cba-4275-a5cd-009833356a2c",
      "name": "Code2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "976869e8-edcb-42d9-b11f-1b3ad9037680",
              "leftValue": "={{$json.body.format}}",
              "rightValue": "csv",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3700,
        2020
      ],
      "id": "b6edc293-8676-4c7e-a25f-a560cb24509c",
      "name": "convert-to-csv"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d3acb3f3-f6bd-4416-ad8a-6d8a6f028801",
              "leftValue": "={{$json.body.format}}",
              "rightValue": "txt",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3700,
        2540
      ],
      "id": "d439b31e-5802-4d9d-b550-1f767fd89e00",
      "name": "convert-to-txt"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "fileContent",
        "binaryPropertyName": "={{ $json.fileContent }}",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2040,
        2520
      ],
      "id": "c0a7829a-1d4f-4ed1-9c4b-fc07072105d7",
      "name": "Convert to txt"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://pdf.creativebits.tech/api/v1/convert/html/pdf",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            },
            {
              "name": "X-API-KEY",
              "value": "1be1db51-6fee-46ad-8a2c-10ceb964764e"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "field",
              "value": "a1b2c3d4-5678-90ab-cdef-ghijklmnopqr"
            },
            {
              "name": "zoom",
              "value": "1"
            },
            {
              "parameterType": "formBinaryData",
              "name": "fileInput",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "converted.pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2620,
        3120
      ],
      "id": "14605105-9a7c-47e8-a2ee-7dd7203ea050",
      "name": "HTTP Request",
      "retryOnFail": false,
      "maxTries": 2,
      "executeOnce": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json;\nconst doc = inputData.body;\n\nif (!doc || !doc.data) {\n  const errorHtml = `<!DOCTYPE html><html><head><title>No Data</title></head>\n    <body style=\"font-family: Georgia, serif; padding: 20px;\">\n    <p>No document data to display. Please check the input to this node.</p></body></html>`;\n  \n  return [{\n    json: {},\n    binary: {\n      data: {\n        data: Buffer.from(errorHtml, 'utf8').toString('base64'),\n        mimeType: 'text/html',\n        fileName: 'report.html'\n      }\n    }\n  }];\n}\n\nconst data = doc.data;\nconst title = doc.title || 'Financial Document';\n\n// Build HTML rows for each field\nconst dataRows = Object.entries(data).map(([key, value], idx) => `\n  <tr style=\"background-color: ${idx % 2 === 1 ? '#fff5f5' : '#ffffff'};\">\n    <td style=\"border: 1px solid #ccc; padding: 10px 12px; text-align: left;\">${key.replace(/_/g, ' ')}</td>\n    <td style=\"border: 1px solid #ccc; padding: 10px 12px; text-align: left; font-weight: 500;\">${value ?? ''}</td>\n  </tr>\n`).join('');\n\nconst htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>${title}</title>\n</head>\n<body style=\"font-family: Georgia, serif; background-color: #f9f9f9; margin: 0; padding: 40px;\">\n  <div style=\"max-width: 850px; margin: auto; background: white; padding: 40px; border-radius: 8px; border: 1px solid #eee; box-shadow: 0 0 8px rgba(0,0,0,0.05);\">\n    <div style=\"text-align: center; margin-bottom: 40px;\">\n      <h1 style=\"font-size: 2.8em; color: #ff5757; margin: 0;\">Simthetic</h1>\n      <p style=\"font-size: 1.2em; color: #555; margin-top: 8px;\">${title}</p>\n    </div>\n\n    <h2 style=\"color: #333; font-size: 1.4em; border-bottom: 2px solid #ff5757; padding-bottom: 8px; margin-top: 0;\">Document Data</h2>\n    \n    <table style=\"width: 100%; border-collapse: collapse; font-size: 1em; margin-top: 20px;\">\n      <thead>\n        <tr style=\"background-color: #ff5757; color: white;\">\n          <th style=\"padding: 12px; text-align: left;\">Field</th>\n          <th style=\"padding: 12px; text-align: left;\">Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${dataRows}\n      </tbody>\n    </table>\n\n    <p style=\"font-size: 0.85em; color: #999; margin-top: 40px; text-align: center;\">\n      This is a system-generated accounting document for simulation purposes.\n    </p>\n  </div>\n</body>\n</html>`;\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: Buffer.from(htmlContent, 'utf8').toString('base64'),\n      mimeType: 'text/html',\n      fileName: 'report.html'\n    }\n  }\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3240,
        3120
      ],
      "id": "721a6217-bf6f-4438-a68c-c54973b25237",
      "name": "Code3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f35412b3-c75a-43a3-969b-203049a9c40b",
              "leftValue": "={{$json.body.format}}",
              "rightValue": "=pdf",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3680,
        3140
      ],
      "id": "08653ee3-6806-48a8-a742-8e043587f3b0",
      "name": "If1"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": " {\n    \"format\":\"pdf\",\n    \"title\": \"po - PO-1001\",\n    \"data\": {\n      \"PO Number\": \"\",\n      \"Total PO Value\": \"24500\",\n      \"Vendor Name\": \"Acme Corp\",\n      \"Delivery Date\": \"2023-13-15\",\n      \"Terms\": \"Net 30\"\n    },\n    \"errorTypes\": [\n      \"Missing\",\n      \"Incorrect\",\n      \"Invalid\"\n    ],\n    \"errorDetails\": [\n      {\n        \"field\": \"PO Number\",\n        \"original\": \"PO-1001\",\n        \"error\": \"\",\n        \"type\": \"Missing\",\n        \"description\": \"Applied 'Missing' error to make the PO untraceable.\"\n      },\n      {\n        \"field\": \"Total PO Value\",\n        \"original\": \"25000\",\n        \"error\": \"24500\",\n        \"type\": \"Incorrect\",\n        \"description\": \"Applied 'Incorrect' error to create a subtle value discrepancy.\"\n      },\n      {\n        \"field\": \"Delivery Date\",\n        \"original\": \"2023-11-15\",\n        \"error\": \"2023-13-15\",\n        \"type\": \"Invalid\",\n        \"description\": \"Applied 'Invalid' date format to test system parsing.\"\n      }\n    ]\n  }",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4420,
        2540
      ],
      "id": "eb9b7de8-de99-4a2a-8414-49cce14f1e56",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "jsCode": "// Get the input data\nconst data = $input.all()[0].json;\n\n// Calculate total document count across all simulation runs\nlet totalDocumentCount = 0;\n\n// Loop through each simulation run and sum up the document counts\ndata.formattedResponse.simulationRuns.forEach(run => {\n    totalDocumentCount += run.generatedDocuments.length;\n});\n\n// Return the result\nreturn [{\n    json: {\n        ...data,\n        document_count: totalDocumentCount\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2700,
        1140
      ],
      "id": "d876dbe6-e1ec-4d02-95ac-d2c5f2e77013",
      "name": "Code5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bf263bb0-d738-4367-b559-939263559b6e",
              "leftValue": "={{ $('Code5').item.json.formattedResponse.simulationProject }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2040,
        1140
      ],
      "id": "ba9f0b60-5755-44c9-9f06-4a5118f0736e",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "141bbaaa-3328-4d2a-87af-31446f6d4a2e",
              "name": "output",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3080,
        1140
      ],
      "id": "e0a580ad-65f9-4259-b13c-77fbb1f2fd58",
      "name": "extract_jsons"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2900,
        1140
      ],
      "id": "c731d17f-01a6-4663-acb9-e09e279c6b34",
      "name": "validate_documents"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Financial Document Error Injection System\n\n## CONTEXT & PURPOSE\n\nYou are an AI system designed to inject realistic errors into financial documents for testing audit workflows. You will receive a set of distinct \"simulation runs,\" and your role is to process each run **independently**. For each simulation run, you must:\n\n1.  Analyze relationships between the documents _within that run_.\n2.  Understand which fields should match across those documents.\n3.  Apply the provided error spectrums strategically to create realistic audit scenarios.\n4.  Maintain document integrity while introducing testable errors.\n\n## INPUT FORMAT\n\nYou will receive a JSON object representing a full simulation project. Your task is to process the `simulationRuns` array within it.\n\n```json\n\n{\n  \"simulationProject\": \"string\",\n  \"companyProfile\": {\n    \"company_name\": \"string\",\n    \"industry\": \"string\",\n    \"region\": \"string\",\n    \"fiscal_year_end\": \"string\",\n    \"business_context\": { \"…\": \"…\" },\n    \"branding\": { \"…\": \"…\" },\n    \"vendors\": [ { \"…\": \"…\" } ],\n    \"banks\": [ { \"…\": \"…\" } ],\n    \"shipping_partners\": [ { \"…\": \"…\" } ],\n    \"revenue_model\": \"string\",\n    \"company_specific_risks\": null\n  },\n  \"simulationRuns\": [\n    {\n      \"simulationId\": \"string\",\n      \"simulationNarrative\": \"string\",\n      \"metadata\": {\n        \"totalDocuments\": 0,\n        \"documentCounts\": {\n          \"Purchase Order\": 0,\n          \"Invoice\": 0,\n          \"Bank Statement\": 0\n          /* other doc types may appear with integer counts */\n        },\n        \"extra\": {\n          /* One of these thread encodings may appear: */\n          \"threads\": [\n            /* either as simple docId chains: */\n            [\"PO-001\", \"INV-001\", \"BS-001\"]\n            /* or as structured threads: */\n            /* { \"threadId\": \"T-001\", \"po_number\": \"PO-…\", \"invoice_numbers\": [\"INV-…\"], \"expected_amount\": 0, \"document_types_in_thread\": [\"Purchase Order\",\"Invoice\",\"Bank Statement\"] } */\n          ],\n          \"fieldNameMap\": {\n            /* label-style keys mapped to concrete data field names */\n            \"PO Number\": \"Purchase_Order_Number\",\n            \"Invoice Number\": \"Invoice_Number\",\n            \"Amount\": \"Total_Amount_Due\",\n            \"Date\": \"Date_of_Invoice\",\n            \"Vendor\": \"Supplier_Name\"\n          },\n          \"edgeCaseHooks\": [\n            /* union of hooks seen across documents in this run */\n            \"timing_cutoff_errors\",\n            \"document_mismatches\"\n          ]\n        }\n      },\n      \"generatedDocuments\": [\n        {\n          \"docId\": \"string\",\n          \"docType\": \"string\",            /* e.g., \"Purchase Order\", \"Invoice\", \"Bank Statement\" */\n          \"data\": {\n            /* MUST contain all required fields for this doc type as produced by Agent 1,\n               using exact field names (e.g., \"Purchase_Order_Number\", \"Total_Amount_Due\", etc.) */\n            /* Also includes routing helpers inserted by Agent 1: */\n            \"Source\": \"Internal|External\",\n            \"File_Type\": \"PDF|CSV\"\n            /* …plus other fields present in Agent 1 output */\n          },\n          \"errorSpectrum\": [\n            /* DOCUMENT-LEVEL list of allowed error types for this document.\n               Use only these when injecting errors into this document’s fields. */\n            \"Missing\",\n            \"Invalid\",\n            \"Mismatch\",\n            \"Incorrect\",\n            \"Negative\"\n          ]\n        }\n      ]\n    }\n  ]\n}\n\n\n```\n\n**Your primary input for error injection is the `errorSpectrum` object inside each document.** This object tells you exactly which errors you are allowed to apply to which fields.\n\n## ERROR SPECTRUM DEFINITIONS\n\n### 1. MISSING ERRORS\n\n**Purpose**: Field is completely absent or empty\n**Apply to**: Critical fields that auditors expect to find\n**Implementation**:\n\n- String fields: \"\" (empty string)\n- Numeric fields: null or 0\n- Date fields: null or \"\"\n  **Example**: Invoice number becomes empty, making invoice untraceable\n\n### 2. INVALID ERRORS\n\n**Purpose**: Field has wrong format/structure but value is present\n**Apply to**: Formatted fields with expected patterns\n**Implementation**:\n\n- Dates: \"Invalid-Date-Format\", \"99/99/9999\", \"February 30, 2025\"\n- Numbers: \"INVALID-###\", \"ABC123\", negative where positive expected\n- IDs: \"INVALID-XXX\", wrong prefix patterns\n  **Example**: PO number \"PO-12345\" becomes \"INVALID-PO-12345\"\n\n### 3. MISMATCH ERRORS\n\n**Purpose**: Values that should match across documents don't match\n**Apply to**: Cross-document reference fields\n**Implementation**:\n\n- Amounts: ±10-30% variance from expected value\n- IDs: Similar but different values (PO-12345 vs PO-12346)\n- Names: Slight variations (Inc. vs LLC, abbreviations)\n  **Example**: Invoice amount $50,000 but PO amount $52,500\n\n### 4. INCORRECT ERRORS\n\n**Purpose**: Wrong but realistic values\n**Apply to**: Any field where wrong data could occur\n**Implementation**:\n\n- Wrong dates (different month/year)\n- Wrong amounts (realistic but different values)\n- Wrong names (different but real vendor names)\n  **Example**: Payment to Vendor A but invoice from Vendor B\n\n### 5. NEGATIVE ERRORS\n\n**Purpose**: Negative values where positive expected\n**Apply to**: Amount fields that should be positive\n**Implementation**:\n\n- Multiply positive amounts by -1\n- Only apply to amounts/balances that shouldn't be negative\n  **Example**: Invoice amount becomes -$50,000\n\n## DOCUMENT RELATIONSHIP ANALYSIS\n\n### CROSS-DOCUMENT DEPENDENCIES\n\nAnalyze these relationships when injecting errors:\n\n1. **Invoice ↔ PO**:\n\n   - PO Reference should match PO Number\n   - Amounts should match or be ≤ PO amount\n   - Vendor names should match\n   - Dates should be logical (invoice after PO)\n\n2. **Invoice ↔ Payment Voucher**:\n\n   - Amounts should match\n   - Payee should match invoice vendor\n   - Payment should reference invoice\n\n3. **Payment Voucher ↔ Bank Statement**:\n\n   - Withdrawal should match voucher amount\n   - Dates should align\n   - Reference numbers may connect\n\n4. **Wire Transfer ↔ Bank/Voucher**:\n\n   - Amounts should reconcile\n   - Beneficiary should match payee\n   - Wire reference may link to voucher\n\n5. **GL Entry ↔ All Documents**:\n   - GL codes should match document types\n   - Amounts should reconcile\n   - Dates should align\n\n### FIELD RELATIONSHIPS TO MONITOR\n\n- **Amount Fields**: invoice.amount, po.total, voucher.amount, bank.withdrawal, wire.amount\n- **Reference Fields**: invoice.po_reference ↔ po.po_number\n- **Party Fields**: invoice.vendor ↔ po.vendor ↔ voucher.payee\n- **Date Fields**: Logical sequence across document lifecycle\n- **Account Fields**: bank.account_number consistency\n\n## ERROR INJECTION STRATEGY\n\n### STEP 1: RELATIONSHIP MAPPING\n\nBefore applying errors, map all cross-document relationships:\n\n1. Identify matching values across documents\n2. Note dependent fields (variableType: \"dependent\")\n3. Catalog amount relationships\n4. Map reference chains (PO → Invoice → Voucher → Bank)\n\n### STEP 2: ERROR PRIORITY\n\nApply errors in this priority order:\n\n1. **High Impact**: Missing critical IDs, invalid amounts\n2. **Medium Impact**: Mismatched cross-references\n3. **Low Impact**: Formatting issues, minor inconsistencies\n\n### STEP 3: REALISTIC ERROR DISTRIBUTION\n\n- Don't apply all errors to one document\n- Maintain some error-free fields for baseline comparison\n- Create patterns auditors would actually encounter\n- Ensure some errors are obvious, others subtle\n\n### STEP 4: MAINTAIN AUDITABILITY\n\n- Keep enough correct data for audit trail reconstruction\n- Don't break all relationships simultaneously\n- Leave breadcrumbs for forensic analysis\n\n## CRITICAL ERROR COUNTING REQUIREMENTS\n\n**MANDATORY VALIDATION PROCESS:**\n\n1. **Track Every Error Applied**: As you process each document, maintain a running count of errors applied\n2. **One Error Per Spectrum Entry**: Each item in a variable's \"spectrum\" array = exactly ONE error applied\n3. **Accurate \\_errors Array**: The \"\\_errors\" array in each document must contain exactly the spectrum values you applied\n4. **Perfect Summary Matching**: Your errorSummary counts MUST exactly match the actual errors in processedDocuments\n\n**VALIDATION METHODOLOGY:**\n\n- Before finalizing your response, count all \"\\_errors\" array entries across all documents\n- Verify this matches your errorSummary.totalErrorsInjected\n- Count each error type (Missing, Invalid, etc.) in the actual documents\n- Verify these counts match your errorSummary.errorsByType\n- If counts don't match, revise your summary to be accurate\n\n**DOUBLE-CHECK REQUIREMENT:**\nAfter completing your JSON response, mentally verify:\n✓ Total errors in \\_errors arrays = errorSummary.totalErrorsInjected\n✓ Count of each error type in documents = errorsByType counts\n✓ No mathematical inconsistencies between actual data and summary\n\n## OUTPUT FORMAT\n\nReturn a JSON object with this exact structure. The `processedRuns` array should contain one object for each `simulationRun` from your input.\n\n```json\n{\n  \"simulationProject\": \"Financial Audit Simulation\",\n  \"companyProfile\": {\n    /* COPY EXACTLY from input.companyProfile (do not alter keys or values) */\n  },\n  \"processedRuns\": [\n    {\n      \"simulationId\": \"Sim Run 1\",\n      \"analysis\": {\n        \"documentTypes\": [\n          \"Purchase Order\",\n          \"Invoice\",\n          \"Payment Voucher\",\n          \"Bank Statement\",\n          \"Wire Transfer\"\n        ],\n        \"relationships\": [\n          {\n            \"type\": \"cross_reference\",\n            \"fields\": [\"Invoice.PO Reference\", \"Purchase Order.Purchase_Order_Number\"],\n            \"description\": \"Invoice PO Reference should match the PO Number.\"\n          }\n        ],\n        \"errorStrategy\": \"Describe your planned use of allowed error types from each document’s errorSpectrum.\",\n        \"totalErrorsToInject\": 0\n      },\n      \"processedDocuments\": {\n        \"Purchase Order\": [\n          {\n            \"docId\": \"PO-001\",\n            \"docType\": \"Purchase Order\",\n            \"data\": {\n              /* The possibly mutated document after error injection (for Sim Run 1 keep original) */\n              /* Preserve original field names from input generatedDocuments[].data */\n            },\n            \"_errors\": [\n              /* Document-level list of applied error types for this doc instance, e.g., [\"Missing\",\"Mismatch\"].\n                 For Sim Run 1 (baseline), this MUST be an empty array [] */\n            ],\n            \"_metadata\": {\n              \"originalValues\": {\n                /* Only fields you changed with their original values; omit fields you did not change */\n              },\n              \"errorsApplied\": [\n                {\n                  \"field\": \"Purchase_Order_Number\",\n                  \"type\": \"Missing\",\n                  \"originalValue\": \"PO-10001\",\n                  \"errorValue\": \"\",\n                  \"reason\": \"Applied per allowed errorSpectrum to simulate untraceable PO.\"\n                }\n              ],\n              \"allowedErrorSpectrum\": [\n                /* COPY the document-level errorSpectrum array from input generatedDocuments[].errorSpectrum for traceability */\n              ]\n            }\n          }\n        ]\n        /* Repeat arrays for other docTypes present in this run, e.g., \"Invoice\", \"Bank Statement\", etc. */\n      },\n      \"errorSummary\": {\n        \"totalErrorsInjected\": 0,\n        \"errorsByType\": {\n          \"Missing\": 0,\n          \"Invalid\": 0,\n          \"Mismatch\": 0,\n          \"Incorrect\": 0,\n          \"Negative\": 0\n        },\n        \"crossDocumentErrors\": [\n          {\n            \"description\": \"Example: Invoice amount mismatches the linked Purchase Order total value.\",\n            \"affectedDocuments\": [\"INV-001\", \"PO-001\"],\n            \"fields\": [\"Total_Amount_Due\", \"Total_Purchase_Order_Value\"]\n          }\n        ]\n      }\n    }\n  ]\n}\n\n\n\n```\n\n## EXAMPLES & EDGE CASES\n\n### Example 1: Mismatch Error Chain\n\nOriginal: Invoice amount $50,000, PO amount $50,000, Voucher amount $50,000\nWith Mismatch: Invoice $50,000, PO $52,500 (5% higher), Voucher $50,000\nResult: Creates audit flag for PO/Invoice amount variance\n\n### Example 2: Missing Reference Chain\n\nOriginal: Invoice.po_reference = \"PO-12345\", PO.po_number = \"PO-12345\"\nWith Missing: Invoice.po_reference = \"\", PO.po_number = \"PO-12345\"\nResult: Invoice cannot be traced to authorizing PO\n\n### Example 3: Invalid Format Cascade\n\nOriginal: Date = \"June 15, 2025\"\nWith Invalid: Date = \"32/15/2025\"\nResult: Unparseable date breaks automated processing\n\n## QUALITY GUIDELINES\n\n1. **Realism**: Errors should reflect real-world audit findings\n2. **Detectability**: Mix obvious and subtle errors\n3. **Consistency**: Apply error spectrums as specified\n4. **Traceability**: Maintain metadata for error analysis\n5. **Balance**: Don't over-corrupt documents\n6. **Logic**: Maintain some internal document consistency\n7. **Accuracy**: Error counts in summary must be mathematically correct\n\n## CRITICAL INSTRUCTIONS\n\n- **PROCESS EACH `simulationRun` INDEPENDENTLY**. Do not cross-reference documents between different simulation runs.\n- ALWAYS preserve the exact field names from input\n- NEVER invent new fields not in the original data\n- APPLY errors only where spectrum is specified\n- MAINTAIN realistic business logic where possible\n- INCLUDE comprehensive metadata for audit trail analysis\n- ENSURE output format matches specification exactly\n- **VERIFY error counts in summary match actual applied errors**\n- **DOUBLE-CHECK all mathematical totals before finalizing response**\n\n## BASELINE RUN – NO ERROR INJECTION\n\nTreat the first object in simulationRuns whose simulationId equals \"Sim Run 1\" as a clean reference set.\n\nDo NOT mutate any field values in these documents.\n\nStill preserve the original errorSpectrum objects, but do not generate _errors arrays for this run.\n\nThe errorSummary for \"Sim Run 1\" must show:\n\njson\nCopy\nEdit\n\"totalErrorsInjected\": 0,\n\"errorsByType\": { \"Missing\": 0, \"Invalid\": 0, \"Mismatch\": 0, \"Incorrect\": 0, \"Negative\": 0 }\nApply your normal error-injection logic only to simulation runs after \"Sim Run 1\"\n\n## OVERALL WORKFLOW: PROCESSING SIMULATION RUNS\n\nYour primary task is to iterate through the `simulationRuns` array in the input JSON. For **each** object in the `simulationRuns` array, you will perform the complete error injection process described below (analysis, mapping, injection, and summary).\n\n**CRITICAL: ISOLATION OF RUNS**\n\n- You MUST treat each simulation run as a completely separate universe.\n- A document in \"Sim Run 1\" has no relationship to any document in \"Sim Run 2\".\n- All relationship analysis and error injection (especially \"Mismatch\" errors) must only consider documents within the _same_ simulation run.\n\nProcess the provided document set and return the complete JSON response with injected errors and full analysis.\n\n## IMPLEMENTATION CHECKLIST (do not skip)\n\n Iterate all simulationRuns; append to processedRuns 1:1.\n\n For each processed doc: copy errorSpectrum → _metadata.allowedErrorSpectrum.\n\n Only apply errors that are allowed for that doc.\n\n Every field you changed appears in _metadata.errorsApplied with full details.\n\n _errors lists the set of types applied to that doc (unique types, not per-field).\n\n errorSummary.totalErrorsInjected equals the total number of errorsApplied entries.\n\n errorSummary.errorsByType equals the counts by type from errorsApplied.\n\n Baseline (Sim Run 1) is untouched; counts all zero.\n\n Final JSON is valid and contains every run you received.\n\n\n\n## Here is the actual financial document to work on:\n{{ JSON.stringify($('Code5').item.json, null, 2) }}\n\n# Strict Rule (Not negotiable)\nMake sure the json is valid Your response must ONLY contain a raw JSON object string with NO code blocks, NO backticks, NO ```json text, NO formatting, and NO explanatory text. The response must begin with { and end with } and contain nothing else.\n\n## Note: For every element in simulationRuns, you must add a corresponding entry in processedRuns. Never skip a run.. DO NOT BE LAZY\n\n## DO NOT SKIP \"simulationId\": \"Sim Run 3\" All the 3 simulations must be available\n",
        "options": {
          "systemMessage": "# Strict Rule (Not negotiable)\nMake sure the json is valid Your response must ONLY contain a raw JSON object string with NO code blocks, NO backticks, NO ```json text, NO formatting, and NO explanatory text. The response must begin with { and end with } and contain nothing else.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -1540,
        1120
      ],
      "id": "34c7bd96-d3f7-4fce-85ea-d8c8422e91f4",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "errorMessage": "Your documents are invalid. Wrong format or missing fields"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1780,
        1360
      ],
      "id": "948c6f27-6117-4d73-b02f-3e01d84bbb5a",
      "name": "Stop and Error"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=### Persona\n\nYou are an expert AI Data Synthesizer specializing in creating realistic, interconnected datasets for financial auditing and process analysis simulations. Your primary function is to generate complex business scenarios involving multiple documents (like Purchase Orders, Invoices, and Bank Statements) based on a high-level configuration. You must create logical and causal links between these documents.\n\n### Goal\n\nYour goal is to process an incoming JSON configuration that defines a simulation scenario. Based on this configuration, you will generate a detailed JSON output containing multiple \"simulation runs\". Each run will consist of a set of synthetically generated documents with realistic data and logical connections.\n\n### Input JSON Format\n\nYou will receive a JSON object with the following structure. It defines the documents to be created and the rules for their variables.\n\n```json\n{\n  \"session_id\": \"uuid\",\n  \"company_count\": 1,\n  \"stage1\": {\n    \"company_count\": 1,\n    \"companies\": [\n      {\n        \"company_name\": \"NeuroSynth MedTech\",\n        \"industry\": \"Healthcare\",\n        \"region\": \"United States\",\n        \"fiscal_year_end\": \"December 31\",\n        \"business_context\": {\n          \"business_model\": \"Subscription-based\",\n          \"description\": \"…\"\n        }\n      }\n    ]\n  },\n  \"profiles\": [\n    {\n      \"company_name\": \"NeuroSynth MedTech\",\n      \"industry\": \"healthcare\",\n      \"region\": \"United States\",\n      \"fiscal_year_end\": \"December 31\",\n      \"business_context\": {\n        \"ticker\": null,\n        \"sector\": \"Other\",\n        \"market_cap\": null,\n        \"primary_products\": [\"…\"],\n        \"business_model\": \"Subscription-based\",\n        \"regulatory_environment\": \"HIPAA, HITECH\",\n        \"known_risks\": [\"…\"],\n        \"description\": \"…\",\n        \"revenue_model\": \"subscription\",\n        \"geographic_footprint\": [\"United States\"],\n        \"key_customers\": [\"clinics\",\"hospitals\"],\n        \"seasonal_patterns\": false,\n        \"prior_audit_findings\": null,\n        \"management_integrity_concerns\": null,\n        \"internal_control_maturity\": \"developing\"\n      },\n      \"branding\": {\n        \"logo_url\": \"https://…svg\",\n        \"primary_color\": \"#334155\",\n        \"secondary_color\": \"#0F172A\",\n        \"font_family\": \"Inter\",\n        \"document_style\": \"modern\"\n      },\n      \"vendors\": [\n        {\n          \"name\": \"Synetix Global\",\n          \"entity_type\": \"vendor\",\n          \"industry\": \"healthcare\",\n          \"address\": \"575 Market St, Denver, CO\",\n          \"tags\": [\"preferred\",\"net30\"],\n          \"metadata\": {},\n          \"branding\": { \"logo_url\": \"https://…svg\", \"primary_color\": \"#334155\", \"secondary_color\": \"#0F172A\", \"font_family\": \"Inter\", \"document_style\": \"formal\" }\n        }\n      ],\n      \"banks\": [\n        {\n          \"name\": \"RiverRock Bank\",\n          \"entity_type\": \"bank\",\n          \"industry\": \"Financials\",\n          \"address\": \"383 Main Ave, Evergreen, CO\",\n          \"tags\": [\"primary\"],\n          \"metadata\": {},\n          \"branding\": { \"logo_url\": \"https://…svg\", \"primary_color\": \"#334155\", \"secondary_color\": \"#0F172A\", \"font_family\": \"Inter\", \"document_style\": \"formal\" }\n        }\n      ],\n      \"shipping_partners\": [\n        {\n          \"name\": \"SwiftShip Logistics\",\n          \"entity_type\": \"shipper\",\n          \"industry\": \"Logistics\",\n          \"address\": \"1251 Freight Rd, Denver, CO\",\n          \"tags\": [\"ground\",\"tracking\"],\n          \"metadata\": {},\n          \"branding\": { \"logo_url\": \"https://…svg\", \"primary_color\": \"#334155\", \"secondary_color\": \"#0F172A\", \"font_family\": \"Inter\", \"document_style\": \"formal\" }\n        }\n      ]\n    }\n  ],\n  \"companies\": [\n    {\n      \"company_name\": \"NeuroSynth MedTech\",\n      \"industry\": \"healthcare\",\n      \"documents\": [\n        {\n          \"document_type\": \"Invoice (Goods)\",\n          \"source\": \"External\",\n          \"file_type\": \"PDF\",\n          \"required_fields\": [\"Invoice_Number\",\"Date_of_Invoice\",\"Supplier_Name\",\"Product_Description\",\"Item_Quantity\",\"Item_Price\",\"Total_Amount_Due\",\"Purchase_Order_Number\",\"Delivery_/_Completion_Date\",\"Currency_Unit\"],\n          \"optional_fields\": [\"Payment_Due_Date\",\"Supplier_Number\",\"…\"],\n          \"linking_fields\": [\"Invoice Number\",\"PO Number\"],\n          \"hints\": {\n            \"preferred_vendors\": [\"Synetix Global\"],\n            \"primary_bank\": \"RiverRock Bank\",\n            \"shipping_partners\": [\"SwiftShip Logistics\"],\n            \"industry\": \"healthcare\",\n            \"region\": \"United States\"\n          },\n          \"edge_case_hooks\": [\"timing_cutoff_errors\",\"document_mismatches\",\"…\"]\n        }\n        // … more document specs (Order Document, Bank Statement, Shipping, Disbursement Listing, etc.)\n      ]\n    }\n  ],\n  \"warnings\": []\n}\n\n```\n\n### Output JSON Format \n\nYou MUST produce a JSON object with exactly this structure (including the new companyProfile block):\n\n{\n  \"simulationProject\": \"Project Alpha - Scenario 1\",\n  \"companyProfile\": { /* copy from input profiles[0] for the target company */ },\n  \"simulationRuns\": [\n    {\n      \"simulationId\": \"Sim Run 1\",\n      \"simulationNarrative\": \"…\",\n      \"metadata\": {\n        \"totalDocuments\": 3,\n        \"documentCounts\": { \"Purchase Order\": 1, \"Invoice\": 1, \"Bank Statement\": 1 },\n        \"extra\": {\n          \"threads\": [ /* … */ ],\n          \"fieldNameMap\": { \"PO Number\": \"Purchase_Order_Number\", \"Invoice Number\": \"Invoice_Number\", \"Amount\": \"Total_Amount_Due\", \"Date\": \"Date_of_Invoice\", \"Vendor\": \"Supplier_Name\" },\n          \"edgeCaseHooks\": [ /* de-duplicated across docs in this run */ ]\n        }\n      },\n      \"generatedDocuments\": [\n        {\n          \"docId\": \"PO-001\",\n          \"docType\": \"Purchase Order\",\n          \"data\": {\n            /* MUST include ALL names from the input required_fields for this doc type with coherent values */\n            \"Purchase_Order_Number\": \"PO-18672\",\n            \"Purchase_Order_Date\": \"2024-10-01\",\n            \"Supplier_Name\": \"Synetix Global\",\n            \"Customer_Name\": \"NeuroSynth MedTech\",\n            \"Item_Quantity\": 77,\n            \"Product_Description\": \"Neuro-imaging sensors\",\n            \"Unit_of_measurement\": \"units\",\n            \"Currency_Unit\": \"USD\",\n            \"Item_Price\": 300.0,\n            \"Total_Purchase_Order_Value\": 23088.0,\n            \"Delivery_Date\": \"2024-10-10\",\n            \"Source\": \"Internal\",\n            \"File_Type\": \"PDF\"\n          },\n          \"errorSpectrum\": [\n            \"timing_cutoff_errors\",\n            \"document_mismatches\"\n          ]\n        },\n        {\n          \"docId\": \"INV-001\",\n          \"docType\": \"Invoice\",\n          \"data\": {\n            \"Invoice_Number\": \"INV-776499\",\n            \"Date_of_Invoice\": \"2024-10-06\",\n            \"Supplier_Name\": \"Synetix Global\",\n            \"Product_Description\": \"Neuro-imaging sensors\",\n            \"Item_Quantity\": 77,\n            \"Item_Price\": 300.0,\n            \"Total_Amount_Due\": 23088.0,\n            \"Purchase_Order_Number\": \"PO-18672\",\n            \"Delivery_/_Completion_Date\": \"2024-10-10\",\n            \"Currency_Unit\": \"USD\",\n            \"Source\": \"External\",\n            \"File_Type\": \"PDF\"\n          },\n          \"errorSpectrum\": [\n            \"timing_cutoff_errors\",\n            \"document_mismatches\"\n          ]\n        }\n        /* Bank Statement etc., with amounts/dates matching the thread */\n      ]\n    }\n  ]\n}\n\n\nStrict Generation Rules\nA. Company Profile in Output\n\nSet companyProfile to the exact object from profiles[] that matches the company you’re generating for (typically profiles[0]). Do not alter key names. If multiple profiles exist, choose the one whose company_name matches companies[0].company_name.\n\nB. Populate ALL required_fields\n\nFor each generatedDocuments[i], the data object must include every field listed in that doc spec’s required_fields[] from the input.\n\nUse the same key names as in required_fields[] (preserve underscores / exact casing).\n\nInclude two extra keys for routing: \"Source\" (from the doc spec source) and \"File_Type\" (from file_type).\n\nC. Coherent Transactions (cross-document linkage)\n\nUse linking_fields[] to propagate shared values across docs. Normalize label→field names:\n\n\"PO Number\" → \"Purchase_Order_Number\"\n\n\"Invoice Number\" → \"Invoice_Number\"\n\n\"Amount\" → For invoices: \"Total_Amount_Due\"; for bank/disbursement: a matching debit/credit field\n\n\"Date\" → appropriate date field per doc (e.g., \"Purchase_Order_Date\", \"Date_of_Invoice\", \"Date_of_transaction\")\n\n\"Vendor\" → unify as \"Supplier_Name\" (purchasing docs) and \"Vendor Name\" where applicable\n\nEnsure amounts and dates make logical sense in sequence:\n\nPurchase_Order_Date ≤ Date_of_Invoice ≤ Date_of_transaction\n\n1→n cases: sum of invoice amounts equals PO total; payments match invoice totals (full or partial per narrative).\n\nPrefer realistic entities from hints and profiles (preferred_vendors, banks, shipping_partners).\n\nD. errorSpectrum from edge_case_hooks\n\nFor each generated document, set errorSpectrum as an object whose keys mirror every field name in data, and whose value is the exact edge_case_hooks[] array from that doc’s input spec.\n\nIf a doc has no edge_case_hooks, use [].\n\nExample:\n\n\"errorSpectrum\": [\n  \"timing_cutoff_errors\",\n  \"document_mismatches\"\n]\n\n\n\nAlso aggregate a de-duplicated list of all hooks used in the run under metadata.extra.edgeCaseHooks.\n\nE. Simulation Runs\n\nProduce 3 runs:\n\n1 PO → 1 Invoice → 1 Payment (full settlement).\n\n1 PO → multiple Invoices (partials sum to PO total; payment(s) mirror invoices).\n\nMultiple POs → 1 consolidated Invoice or a split shipment case (make math and dates coherent).\n\nProvide a short simulationNarrative describing the flow.\n\nF. Metadata\n\nmetadata.documentCounts must report counts by docType.\n\nmetadata.totalDocuments equals the total number of items in generatedDocuments.\n\nmetadata.extra must include:\n\nthreads[] describing coherent chains,\n\nfieldNameMap you used,\n\nedgeCaseHooks (unique union across documents in the run).\n\nG. Validation\n\nBefore returning, verify:\n\nAll required fields exist in data.\n\nShared identifiers (PO/Invoice numbers) match across linked docs.\n\nAmounts reconcile (PO = sum(invoices); payments = invoices paid per narrative).\n\nDates are chronological.\n\nerrorSpectrum keys match data keys exactly and values are the input edge_case_hooks for that doc.\n\nBelow is the incoming JSON from a user:\n{{ JSON.stringify($('Get Jsons').item.json, null, 2) }}\n\nUse the Input JSON Format above.\n\nProduce the UPDATED Output JSON Format (including companyProfile).\n\nIn every generatedDocuments[].data, populate all required_fields with coherent values, plus \"Source\" and \"File_Type\".\n\nSet each errorSpectrum field to the document’s edge_case_hooks array from the input.\n\nEnsure end-to-end coherence across documents (IDs, amounts, dates, vendor/bank consistency).\n\nReturn 3 simulation runs with accurate metadata.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -3500,
        1140
      ],
      "id": "e78c01de-7abd-44a9-83c1-71b589b12fd5",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "o4-mini",
          "mode": "list",
          "cachedResultName": "o4-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3480,
        1360
      ],
      "id": "36ff329d-a374-42c5-91dc-6b512d27a569",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return {\n  rawContent: $json.choices[0].message.content\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -580,
        1120
      ],
      "id": "f7e640d2-1602-4043-8da7-fb37955e57de",
      "name": "validate_documents1",
      "retryOnFail": true,
      "maxTries": 2,
      "notesInFlow": false,
      "executeOnce": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const sims = $json.rawContent?.processedRuns || [];\nconst results = [];\n\nfor (const sim of sims) {\n  const simId = (sim.simulationId || 'UnknownSimulation').replace(/\\s+/g, '_');\n  const docsByType = sim.processedDocuments || {};\n\n  for (const [docTypeKey, docArray] of Object.entries(docsByType)) {\n    const safeDocType = (docTypeKey || 'UnknownType').replace(/\\s+/g, '_');\n\n    (docArray || []).forEach(doc => {\n      const docId = doc?.docId || 'UnknownDocID';\n\n      // keep .csv staging files; downstream can render to PDF/TXT using `content.file_type`\n      const fileName = `${simId}/${safeDocType}_${docId}.csv`;\n\n      // Preserve the whole original doc (company, branding, render_hints, file_type, etc.)\n      const content = {\n        ...doc,                                  // <-- keeps file_type, company, render_hints, watermark, footer, etc.\n        docType: doc.docType || docTypeKey,      // ensure docType present even if missing in doc\n        simulationId: sim.simulationId,          // add context\n        analysis: sim.analysis,                  // optional but useful\n        errorSummary: sim.errorSummary           // keep your summary\n      };\n\n      results.push({ json: { fileName, content } });\n    });\n  }\n}\n\nreturn results;\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        60,
        1100
      ],
      "id": "1c274f04-b662-4fba-9672-3cc9a4d7281c",
      "name": "Code"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "GPT-4.1"
        },
        "messages": {
          "values": [
            {
              "content": "=# Strict Rule (Not negotiable)\nMake sure the json is valid Your response must ONLY contain a raw JSON object string with NO code blocks, NO backticks, NO ```json text, NO formatting, and NO explanatory text. The response must begin with { and end with } and contain nothing else.\n",
              "role": "system"
            },
            {
              "content": "=Please make sure this json is a valid json if not please re-write it\n\n\n {{ $json.output }}"
            }
          ]
        },
        "simplify": false,
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -980,
        1120
      ],
      "id": "ad40c902-9c6f-47fd-9ad0-09d80fcdf5eb",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Validate AI outputs if are in a valid a format ",
        "height": 700,
        "width": 800,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1160,
        800
      ],
      "typeVersion": 1,
      "id": "60dbe0b8-1cd5-43d9-ba45-d27f8a35e59c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Validate DocumentAgent outputs if they are in correct format\n",
        "height": 700,
        "width": 1000,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3100,
        800
      ],
      "typeVersion": 1,
      "id": "3d18828d-8213-40fe-9de8-27545fad6048",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# **Error Injector** \n## Inject multi-error types (overpayment, missing documents, hallucination, GL misclassification) into each simulation at configurable rates.\n",
        "height": 700,
        "width": 800,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2020,
        800
      ],
      "typeVersion": 1,
      "id": "61f2866b-b007-4350-b54f-1b602834cfea",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# **DocumentAgent**\n## Emit coherent document bundles per defined simulations in a given scenario eg a scenario can have this interconnected documents(Invoices, POs, Vouchers, Bank Statements, GL entries)",
        "height": 700,
        "width": 740,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3800,
        800
      ],
      "typeVersion": 1,
      "id": "dc539782-c7c0-4b43-bd7e-f5c8bf36f47d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Output Generator\nGenerate documents for each simulation",
        "height": 700,
        "width": 1220,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -220,
        820
      ],
      "typeVersion": 1,
      "id": "266a73d2-61b7-4d34-9f63-ddee528d8fae",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        660,
        1100
      ],
      "id": "1b2fad7b-cad8-4a61-a829-c25d5131ed73",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: $json.body\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3760,
        1140
      ],
      "id": "653beca1-4d7c-4b40-a142-8874e74d7b30",
      "name": "Get Jsons"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "project_simulation_id": "={{ $('Insert rows in a table').item.json.id }}",
            "file_name": "={{ $json.fileName }}",
            "simulation_run_id": "={{ $json.content.simulationId }}",
            "document_data": "={{ $json.content }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_simulation_id",
              "displayName": "project_simulation_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "simulation_run_id",
              "displayName": "simulation_run_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "file_name",
              "displayName": "file_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "document_data",
              "displayName": "document_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        320,
        1100
      ],
      "id": "a652dbe3-2ee5-4b0b-b4b6-a03d914cd2a8",
      "name": "Insert rows in a table1",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "content": "# SINGLE CSV, TXT, PDF Export",
        "height": 1020,
        "width": 820,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4800,
        2100
      ],
      "typeVersion": 1,
      "id": "93548a52-0a06-4861-889b-4ac6794b8f6d",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "path": "list-all-simulations",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4360,
        5100
      ],
      "id": "d7737fae-175e-4947-9770-0375cbbbca2a",
      "name": "Webhook2",
      "webhookId": "9f465aea-0e48-42e9-8746-efa6558440db"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1940,
        5100
      ],
      "id": "b310116a-ae0b-4705-a281-2627cd463daf",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "content": "# Viewing a specific simulation's documents (User clicks \"View\"):",
        "height": 620,
        "width": 4660,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4800,
        5460
      ],
      "typeVersion": 1,
      "id": "1e0d1873-2242-4dd7-8d4b-c3d443a0e09e",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "path": "view-specific-simulation-documents",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4420,
        5680
      ],
      "id": "c38e85d3-b329-496e-aeac-aa160aa164ab",
      "name": "Webhook3",
      "webhookId": "79b46c8e-d07b-4d1f-8c50-2466a16a0c39"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1960,
        5680
      ],
      "id": "3575f82c-5b52-46b4-bddd-b74997c081c1",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id, project_name, scenario_name, created_at, document_count \n        FROM project_simulations \n        WHERE is_deleted = FALSE \nORDER BY created_at DESC;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3080,
        5100
      ],
      "id": "a1ac9310-756f-4ad1-a8b0-c59badd77e35",
      "name": "list-all-simulations",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "        SELECT *\n        FROM simulation_documents \nWHERE project_simulation_id =$1;",
        "options": {
          "queryReplacement": "={{ $json.query.query }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3040,
        5680
      ],
      "id": "334f04ab-a674-4bd6-92e6-3da5fe958b6b",
      "name": "view-specific-simulation-documents",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "Oops there was an issue when exporting the document"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -2360,
        3360
      ],
      "id": "af2d5b8c-5f41-45e8-a857-c7e2c3dbe16d",
      "name": "Stop and Error1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://pdf.creativebits.tech/api/v1/convert/html/pdf",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            },
            {
              "name": "X-API-KEY",
              "value": "1be1db51-6fee-46ad-8a2c-10ceb964764e"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "field",
              "value": "a1b2c3d4-5678-90ab-cdef-ghijklmnopqr"
            },
            {
              "name": "zoom",
              "value": "1"
            },
            {
              "parameterType": "formBinaryData",
              "name": "fileInput",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "converted.pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1880,
        3800
      ],
      "id": "c4375994-5740-489c-94c2-82d1707f8d2b",
      "name": "HTTP Request1",
      "retryOnFail": false,
      "maxTries": 2,
      "executeOnce": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Collect all incoming items\nconst allInputs = $input.all();\n\nlet documents = [];\n\nif (allInputs.length === 1) {\n  const payload = allInputs[0].json;\n\n  if (Array.isArray(payload)) {\n    // New shape: top-level array\n    documents = payload;\n  } else if (Array.isArray(payload.data)) {\n    // Legacy shape: { data: [...] }\n    documents = payload.data;\n  } else if (payload.document_data || payload.docType || payload.docId) {\n    // Single document already\n    documents = [payload];\n  } else {\n    throw new Error(\"Unrecognized input format. Expected array of docs, object with .data array, or document object.\");\n  }\n} else {\n  // Multiple input items: assume each is already a document\n  documents = allInputs.map(item => item.json);\n}\n\n// Emit each document as its own item\nreturn documents.map((doc, index) => ({\n  json: doc,\n  pairedItem: { item: index },\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2880,
        3800
      ],
      "id": "2ae8fd18-f21f-47e9-8a0d-25cf111b4b1d",
      "name": "Code4"
    },
    {
      "parameters": {
        "errorMessage": "Oops there was an issue when exporting the document"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1660,
        3900
      ],
      "id": "10a38865-278d-46a3-862c-fb6cbfd501b8",
      "name": "Stop and Error2"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Runs once per item\nconst inputDoc = $json;\n\n// Support both shapes just in case\nconst doc = inputDoc.document_data ?? {};\n\n// Keep existing file name if provided, otherwise build a safe default\nconst fileName =\n  inputDoc.file_name ??\n  `${(doc.simulationId || 'UnknownSimulation').replace(/\\s+/g, '_')}/` +\n  `${(doc.docType || 'UnknownType').replace(/\\s+/g, '_')}_` +\n  `${doc.docId || 'UnknownDocID'}.txt`;\n\n// Preserve the entire document; then guarantee common fields exist.\n// Also normalize `_metadata`/`_errors` to friendly keys if missing.\nconst content = {\n  ...doc, // keeps file_type, company, branding, render_hints, watermark, footer, _metadata, _errors, etc.\n  docType: doc.docType ?? doc.type ?? 'UnknownType',\n  docId: doc.docId ?? 'UnknownDocID',\n  simulationId: doc.simulationId ?? inputDoc.simulationId,\n};\n\n// Provide aliases without overwriting if the canonical keys already exist\nif (doc._metadata !== undefined && content.metadata === undefined) {\n  content.metadata = doc._metadata;\n}\nif (doc._errors !== undefined && content.errors === undefined) {\n  content.errors = doc._errors;\n}\n// If errorSummary was kept outside the doc upstream, preserve it too\nif (inputDoc.errorSummary && content.errorSummary === undefined) {\n  content.errorSummary = inputDoc.errorSummary;\n}\n\nreturn { fileName, content };\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2560,
        3800
      ],
      "id": "78c83d62-70cf-4a42-ab15-fc949d209952",
      "name": "Code6"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Runs once per item and returns HTML as binary for PDF conversion.\nconst doc = $json;\n\n// ---------- guard ----------\nif (!doc || !doc.content) {\n  const errorHtml = `<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><title>No Data</title></head>\n  <body style=\"font-family: Arial, sans-serif; padding: 24px;\">\n    <h1>No document content found</h1>\n    <p>Please check the input to this node.</p>\n  </body></html>`;\n  return {\n    json: { error: 'No document content found.' },\n    binary: { data: { data: Buffer.from(errorHtml,'utf8').toString('base64'), mimeType: 'text/html', fileName: 'error_report.html' } }\n  };\n}\n\n// ---------- shorthands ----------\nconst c = doc.content || {};\nconst data = c.data || {};\nconst company = c.company || {};\nconst branding = company.branding || {};\nconst hints = c.render_hints || {};\nconst currency = (data.Currency_Unit || 'USD').toString();\n\n// ---------- theme ----------\nconst primary = branding.primary_color || '#1A237E';\nconst secondary = branding.secondary_color || '#3B82F6';\nconst fontFamily = branding.font_family || \"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif\";\nconst accent = (hints.header?.accent_color) || primary;\nconst logoSrc = branding.logo_data_uri || branding.logo_url || company.logo_url || '';\n\n// ---------- helpers ----------\nfunction esc(x) {\n  if (x === null || x === undefined) return '';\n  return String(x)\n    .replace(/&/g,'&amp;')\n    .replace(/</g,'&lt;')\n    .replace(/>/g,'&gt;')\n    .replace(/\"/g,'&quot;')\n    .replace(/'/g,'&#39;');\n}\n\nfunction isLikelyImageUrl(u='') {\n  if (!u) return false;\n  if (/^data:image\\/(png|jpe?g|gif|svg\\+xml);base64,/i.test(u)) return true;     // data URI\n  return /^https?:\\/\\/.+\\.(png|jpe?g|gif|svg)(\\?.*)?$/i.test(u);\n}\n\nfunction asList(v) {\n  if (Array.isArray(v)) return v.map(x => String(x).trim());\n  if (typeof v === 'string') return v.split(';').map(x => x.trim()).filter(Boolean);\n  if (v === undefined || v === null) return [];\n  return [String(v)];\n}\n\nfunction n(x) {\n  if (x === null || x === undefined || x === '') return undefined;\n  const num = Number(String(x).replace(/,/g,'').trim());\n  return Number.isFinite(num) ? num : undefined;\n}\n\nfunction money(x) {\n  const val = n(x);\n  if (val === undefined) return esc(x);\n  try {\n    return new Intl.NumberFormat('en-US', { style: 'currency', currency }).format(val);\n  } catch {\n    return `${currency} ${val.toLocaleString('en-US')}`;\n  }\n}\n\nfunction fieldChanged(field) {\n  const arr = c.metadata?.errorsApplied || c._metadata?.errorsApplied || [];\n  return arr.find(e => e.field === field);\n}\n\nfunction markedCell(field, valueHtml) {\n  const e = fieldChanged(field);\n  if (!e) return valueHtml;\n  const title = esc(`Original: ${e.originalValue} | Error: ${e.spectrum} - ${e.reason}`);\n  return `<span style=\"background:#fff1f1;border-left:3px solid #d9534f;padding:2px 4px;font-weight:600;\" title=\"${title}\">${valueHtml}</span>`;\n}\n\nfunction section(title, inner) {\n  return `\n  <div style=\"background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin:16px 0;padding:18px;box-shadow:0 2px 6px rgba(0,0,0,.04);\">\n    <h3 style=\"margin:0 0 10px 0;color:${primary}\">${esc(title)}</h3>\n    ${inner}\n  </div>`;\n}\n\nfunction titleFromType() {\n  const t = (c.docType || '').toLowerCase();\n  if (t.includes('invoice') && t.includes('services')) return 'Invoice (Services)';\n  if (t.includes('invoice')) return 'Invoice';\n  if (t.includes('order_document_sales_and_purchases') || t.includes('purchase order') || t.includes('(po)')) return 'Purchase Order';\n  if (t.includes('shipping') && t.includes('receiv')) return 'Goods Received Note';\n  if (t.includes('shipping') && (t.includes('send') || t.includes('dispatch'))) return 'Delivery Note';\n  if (t.includes('bank_statement') || t.includes('bank statement')) return 'Bank Statement';\n  if (t.includes('wire')) return 'Wire Transfer Confirmation';\n  if (t.includes('contract')) return 'Purchase Contract';\n  return hints.header?.title || 'Document';\n}\n\nfunction normalizeType() {\n  const t = (c.docType || '').toLowerCase();\n  if (t.includes('order_document_sales_and_purchases') || t.includes('purchase order') || t.includes('(po)')) return 'po';\n  if (t.includes('invoice') && t.includes('services')) return 'invoice_services';\n  if (t.includes('invoice')) return 'invoice_goods';\n  if (t.includes('bank_statement') || t.includes('bank statement')) return 'bank';\n  if (t.includes('shipping') && t.includes('receiv')) return 'ship_recv';\n  if (t.includes('shipping')) return 'ship_send';\n  if (t.includes('wire')) return 'wire';\n  if (t.includes('contract')) return 'contract';\n  return 'generic';\n}\n\n// Header with logo + address\nfunction headerBlock() {\n  const showLogo = hints.header?.show_logo !== false; // default true\n  const docTitle = hints.header?.title || titleFromType();\n\n  const logoHtml =\n    (showLogo && isLikelyImageUrl(logoSrc))\n      ? `<img src=\"${esc(logoSrc)}\" alt=\"Logo\" referrerpolicy=\"no-referrer\"\n           style=\"max-height:56px;object-fit:contain\" onerror=\"this.style.display='none'\">`\n      : `<div style=\"font-weight:700;font-size:22px;\">${esc(company.name || '')}</div>`;\n\n  const addr = hints.address_block || {};\n  return `\n  <table style=\"width:100%; border-collapse:collapse;\">\n    <tr>\n      <td style=\"width:60%;vertical-align:top;\">\n        ${logoHtml}\n        <div style=\"font-size:12px;color:#444;margin-top:6px;\">\n          ${esc(addr.company_name || company.name || '')}<br>\n          ${esc(addr.address || '')}${addr.address ? '<br>' : ''}${esc(addr.region || company.region || '')}\n        </div>\n      </td>\n      <td style=\"text-align:right;vertical-align:top;\">\n        <div style=\"font-size:26px;font-weight:800;color:${accent}\">${esc(docTitle)}</div>\n        <div style=\"color:#666;margin-top:6px;\">Document ID: <strong>${esc(c.docId || '')}</strong></div>\n        <div style=\"color:#666;\">Simulation: <strong>${esc(c.simulationId || '')}</strong></div>\n        ${c.file_type ? `<div style=\"color:#666;\">File Type: <strong>${esc(c.file_type)}</strong></div>` : ''}\n      </td>\n    </tr>\n  </table>`;\n}\n\nfunction footerBlock() {\n  const f = hints.footer || {};\n  const prepared = f.prepared_on ? new Date(f.prepared_on) : undefined;\n  const dateStr = prepared && !isNaN(prepared) ? prepared.toISOString().slice(0,10) : (f.prepared_on || '');\n  return `\n  <div style=\"display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#666;\">\n    <div>${f.prepared_by ? `Prepared by: <strong>${esc(f.prepared_by)}</strong>` : ''}</div>\n    <div>${dateStr ? `Prepared on: <strong>${esc(dateStr)}</strong>` : ''}</div>\n    ${hints.footer?.page_numbers ? `<div>Page <span class=\"pageNumber\"></span></div>` : ''}\n  </div>`;\n}\n\n// Print-safe, centered watermark with no wrapping\nfunction watermarkCss() {\n  const text = hints.watermark || '';\n  if (!text) return '';\n  const size = Number(hints.watermark_size_px ?? 48);\n  const opacity = Number(hints.watermark_opacity ?? 0.06);\n  return `\n  <div style=\"\n    position: fixed;\n    top: 50%; left: 50%;\n    transform: translate(-50%, -50%) rotate(-30deg);\n    pointer-events: none; z-index: 0; opacity: ${opacity};\n  \">\n    <div style=\"\n      font-size: ${size}px; font-weight: 900; letter-spacing: 2px;\n      white-space: nowrap; color: ${primary};\n    \">${esc(text)}</div>\n  </div>\n  <style>\n    @media print { .container { position: relative; z-index: 1; } }\n  </style>`;\n}\n\n// ---------- line items for PO/Invoice ----------\nfunction buildLineItems() {\n  const desc = asList(data.Product_Description || data.Description || data.Item_Description);\n  const qty = asList(data.Item_Quantity);\n  const unit = asList(data.Unit_of_measurement || data.Unit || data.UOM);\n  const price = asList(data.Item_Price || data.Unit_Price);\n  const maxLen = Math.max(desc.length, qty.length, unit.length, price.length);\n  const rows = [];\n  for (let i = 0; i < maxLen; i++) {\n    const qn = n(qty[i]);\n    const pr = n(price[i]);\n    const lineTotal = (qn !== undefined && pr !== undefined) ? qn * pr : undefined;\n    rows.push({\n      description: desc[i] ?? '',\n      quantity: qn ?? (qty[i] ?? ''),\n      unit: unit[i] ?? '',\n      unitPrice: pr ?? (price[i] ?? ''),\n      lineTotal\n    });\n  }\n  return rows.filter(r => (r.description || r.quantity || r.unitPrice));\n}\n\nfunction renderItemsTable() {\n  const items = buildLineItems();\n  if (!items.length) return '<div style=\"color:#666\">No line items present.</div>';\n  const rows = items.map((r, idx) => `\n    <tr style=\"background:${idx%2? '#fafafa':'transparent'}\">\n      <td style=\"border:1px solid #e5e7eb;padding:10px\">${esc(r.description)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">${esc(r.quantity)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:10px\">${esc(r.unit)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">${money(r.unitPrice)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">${r.lineTotal !== undefined ? money(r.lineTotal) : ''}</td>\n    </tr>`).join('');\n  const subtotal = items.reduce((s,r)=> s + (r.lineTotal || 0), 0);\n  return `\n  <table style=\"width:100%;border-collapse:collapse\">\n    <thead>\n      <tr style=\"background:${secondary};color:#fff\">\n        <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Description</th>\n        <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">Qty</th>\n        <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Unit</th>\n        <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">Unit Price</th>\n        <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">Line Total</th>\n      </tr>\n    </thead>\n    <tbody>${rows}</tbody>\n    <tfoot>\n      <tr>\n        <td colspan=\"4\" style=\"border:1px solid #e5e7eb;padding:10px;text-align:right;font-weight:700\">Subtotal</td>\n        <td style=\"border:1px solid #e5e7eb;padding:10px;text-align:right;font-weight:700\">${money(subtotal)}</td>\n      </tr>\n    </tfoot>\n  </table>`;\n}\n\n// ---------- type-specific renderers ----------\nfunction renderPO() {\n  const factsRows = [\n    ['PO Number', markedCell('Purchase_Order_Number', esc(data.Purchase_Order_Number || c.docId || ''))],\n    ['PO Date', markedCell('Purchase_Order_Date', esc(data.Purchase_Order_Date || ''))],\n    ['Supplier', markedCell('Supplier_Name', esc(data.Supplier_Name || ''))],\n    ['Buyer', esc(data.Customer_Name || company.name || '')],\n    ['Currency', esc(data.Currency_Unit || '')],\n    ['Delivery Date', esc(data.Delivery_Date || '')]\n  ].map((r, i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n\n  const totals = `\n    <div style=\"text-align:right;margin-top:12px;font-size:16px\">\n      <div> ${markedCell('Total_Purchase_Order_Value', money(data.Total_Purchase_Order_Value || 0))} </div>\n    </div>`;\n\n  return [\n    section('Purchase Order Details', `<table style=\"width:100%;border-collapse:collapse\">${factsRows}</table>`),\n    section('Items', renderItemsTable()),\n    section('Total', totals)\n  ].join('');\n}\n\nfunction renderInvoice(kind='goods') {\n  const factsRows = [\n    ['Invoice Number', esc(data.Invoice_Number || c.docId || '')],\n    ['Invoice Date', esc(data.Date_of_Invoice || '')],\n    ['Supplier', esc(data.Supplier_Name || '')],\n    ['Customer', esc(data.Customer_Name || company.name || '')],\n    ['Currency', esc(data.Currency_Unit || '')],\n    ['PO Number', markedCell('Purchase_Order_Number', esc(data.Purchase_Order_Number || ''))],\n    ['Delivery/Completion Date', esc(data['Delivery_/_Completion_Date'] || '')]\n  ].map((r, i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n\n  const totals = `\n    <div style=\"text-align:right;margin-top:12px;font-size:16px\">\n      <div> Total Amount Due: ${markedCell('Total_Amount_Due', money(data.Total_Amount_Due || 0))} </div>\n    </div>`;\n\n  return [\n    section(kind === 'services' ? 'Invoice (Services) Details' : 'Invoice Details', `<table style=\"width:100%;border-collapse:collapse\">${factsRows}</table>`),\n    section('Items', renderItemsTable()),\n    section('Total', totals)\n  ].join('');\n}\n\nfunction renderBank() {\n  const txnIds = asList(data.Transaction_Number);\n  const txnDates = asList(data.Date_of_transaction);\n  const detailsList = asList(data.Transactional_Details);\n  const amountsFromDetails = detailsList.map(d => {\n    const m = /Amount:\\s*([0-9\\.,]+)/i.exec(d || '');\n    return m ? n(m[1]) : undefined;\n  });\n\n  const rows = [];\n  const len = Math.max(txnIds.length, txnDates.length, detailsList.length);\n  for (let i=0;i<len;i++){\n    rows.push({\n      id: txnIds[i] || '',\n      date: txnDates[i] || '',\n      details: detailsList[i] || '',\n      amount: amountsFromDetails[i]\n    });\n  }\n\n  const ledgerRows = rows.map((r,i)=> `\n    <tr style=\"background:${i%2? '#fafafa':'transparent'}\">\n      <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(r.date)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(r.id)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(r.details)}</td>\n      <td style=\"border:1px solid #e5e7eb;padding:8px;text-align:right\">${r.amount !== undefined ? money(r.amount) : ''}</td>\n    </tr>`).join('');\n\n  const factsRows = [\n    ['Account Number', esc(data.Account_Number || '')],\n    ['Statement Period', esc(data.Statement_Period || '')],\n    ['Opening Balance', markedCell('Opening_or_Beginning_or_Previous_Balance', money(data.Opening_or_Beginning_or_Previous_Balance || 0))],\n    ['Withdrawal/Debit Totals', markedCell('Withdrawal_or_Debit_Totals', money(data.Withdrawal_or_Debit_Totals || 0))],\n    ['Deposit/Credit Totals', markedCell('Deposit_or_Credit_Totals', money(data.Deposit_or_Credit_Totals || 0))],\n    ['Closing Balance', markedCell('Closing_or_Ending_Balance', money(data.Closing_or_Ending_Balance || 0))],\n    ['Bank Name', esc(data.Bank_name || '')]\n  ].map((r, i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n\n  return [\n    section('Statement Summary', `<table style=\"width:100%;border-collapse:collapse\">${factsRows}</table>`),\n    section('Transactions', `\n      <table style=\"width:100%;border-collapse:collapse\">\n        <thead>\n          <tr style=\"background:${secondary};color:#fff\">\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Date</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Transaction #</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Details</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:right\">Amount</th>\n          </tr>\n        </thead>\n        <tbody>${ledgerRows || '<tr><td colspan=\"4\" style=\"padding:10px;color:#666\">No transactions.</td></tr>'}</tbody>\n      </table>`)\n  ].join('');\n}\n\nfunction renderShipping(mode) {\n  const facts = [\n    ['Document', mode === 'recv' ? 'Goods Received Note' : 'Delivery Note'],\n    ['Shipment Date', esc(data.Shipment_Date || data.Delivery_Date || '')],\n    ['Carrier', esc(data.Carrier_Name || data.Shipper || '')],\n    ['Tracking #', esc(data.Tracking_Number || '')],\n    ['Origin', esc(data.Origin || data.Ship_From || '')],\n    ['Destination', esc(data.Destination || data.Ship_To || '')],\n    ['PO Number', esc(data.Purchase_Order_Number || '')],\n    ['Invoice Number', esc(data.Invoice_Number || '')]\n  ];\n  const factRows = facts.map((r,i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n  return [\n    section('Shipment Details', `<table style=\"width:100%;border-collapse:collapse\">${factRows}</table>`),\n    section('Items', renderItemsTable())\n  ].join('');\n}\n\nfunction renderWire() {\n  const facts = [\n    ['Transfer Date', esc(data.Transfer_Date || data.Date_of_transaction || '')],\n    ['Amount', money(data.Amount || data.Withdrawal_or_Debit_Totals || '')],\n    ['Currency', esc(data.Currency_Unit || '')],\n    ['Sender Account', esc(data.Sender_Account || data.Account_Number || '')],\n    ['Receiver Account', esc(data.Receiver_Account || '')],\n    ['Bank', esc(data.Bank_name || '')],\n    ['Reference', esc(data.Reference || data.Transaction_Number || '')],\n    ['Invoice #', esc(data.Invoice_Number || '')],\n    ['PO #', esc(data.Purchase_Order_Number || '')]\n  ];\n  const factRows = facts.map((r,i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n  return section('Wire Transfer Details', `<table style=\"width:100%;border-collapse:collapse\">${factRows}</table>`);\n}\n\nfunction renderContract() {\n  const body = esc(data.Contract_Text || data.Snippet || data.Terms || 'No contract text provided.');\n  const metaRows = [\n    ['Effective Date', esc(data.Effective_Date || '')],\n    ['Supplier', esc(data.Supplier_Name || '')],\n    ['Buyer', esc(data.Customer_Name || company.name || '')],\n    ['PO/Reference', esc(data.Purchase_Order_Number || data.Reference || '')]\n  ].map((r,i)=> `<tr style=\"background:${i%2? '#fafafa':'transparent'}\"><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[0]}</td><td style=\"border:1px solid #e5e7eb;padding:8px\">${r[1]}</td></tr>`).join('');\n  return [\n    section('Contract Metadata', `<table style=\"width:100%;border-collapse:collapse\">${metaRows}</table>`),\n    section('Excerpt', `<div style=\"white-space:pre-wrap;line-height:1.6\">${body}</div>`)\n  ].join('');\n}\n\n// Errors appendix (applied + cross-doc)\nfunction renderErrorsAppendix() {\n  let errorsHtml = '';\n  const applied = c.metadata?.errorsApplied || c._metadata?.errorsApplied || [];\n  if (applied.length) {\n    const rows = applied.map((e,i)=> `\n      <tr style=\"background:${i%2? '#fafafa':'transparent'}\">\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.field)}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.spectrum)}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.originalValue ?? '')}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.errorValue ?? '')}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.reason)}</td>\n      </tr>`).join('');\n    errorsHtml += section('Errors Applied', `\n      <table style=\"width:100%;border-collapse:collapse\">\n        <thead>\n          <tr style=\"background:${secondary};color:#fff\">\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Field</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Type</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Original</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Error Value</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Reason</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>`);\n  }\n\n  const cross = c.errorSummary?.crossDocumentErrors || [];\n  if (cross.length) {\n    const rows = cross.map((e,i)=> `\n      <tr style=\"background:${i%2? '#fafafa':'transparent'}\">\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(e.description)}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc((e.affectedDocuments || []).join(', '))}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc((e.fields || []).join(', '))}</td>\n      </tr>`).join('');\n    errorsHtml += section('Cross-Document Errors', `\n      <table style=\"width:100%;border-collapse:collapse\">\n        <thead>\n          <tr style=\"background:${secondary};color:#fff\">\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Description</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Affected Docs</th>\n            <th style=\"border:1px solid #e5e7eb;padding:10px;text-align:left\">Fields</th>\n          </tr>\n        </thead>\n        <tbody>${rows}</tbody>\n      </table>`);\n  }\n\n  return errorsHtml;\n}\n\n// ---------- choose template ----------\nlet main;\nswitch (normalizeType()) {\n  case 'po':               main = renderPO(); break;\n  case 'invoice_services': main = renderInvoice('services'); break;\n  case 'invoice_goods':    main = renderInvoice('goods'); break;\n  case 'bank':             main = renderBank(); break;\n  case 'ship_recv':        main = renderShipping('recv'); break;\n  case 'ship_send':        main = renderShipping('send'); break;\n  case 'wire':             main = renderWire(); break;\n  case 'contract':         main = renderContract(); break;\n  default: {\n    const rows = Object.entries(data).map(([k,v],i)=>`\n      <tr style=\"background:${i%2? '#fafafa':'transparent'}\">\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(k)}</td>\n        <td style=\"border:1px solid #e5e7eb;padding:8px\">${markedCell(k, esc(v))}</td>\n      </tr>`).join('');\n    main = section('Fields', `<table style=\"width:100%;border-collapse:collapse\">${rows}</table>`);\n  }\n}\n\nconst appendix = renderErrorsAppendix();\n\n// ---------- final HTML ----------\nconst html = `<!DOCTYPE html>\n<html style=\"-webkit-print-color-adjust:exact;color-adjust:exact;\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>${esc(titleFromType())} - ${esc(c.docId || '')}</title>\n  <style>\n    @page { margin: 18mm; }\n    body { font-family:${fontFamily}; margin:0; padding:0; background:#f6f7fb; color:#111827; }\n    .container { max-width:900px; margin:0 auto; padding:24px; position:relative; z-index:1; }\n    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:18px; box-shadow:0 8px 20px rgba(0,0,0,.04); }\n    .brand-bar { height:6px; background:${primary}; border-radius:12px 12px 0 0; }\n  </style>\n</head>\n<body>\n  ${watermarkCss()}\n  <div class=\"container\">\n    <div class=\"card\">\n      <div class=\"brand-bar\"></div>\n      ${headerBlock()}\n      ${section('Parties & Roles', `\n        <table style=\"width:100%;border-collapse:collapse\">\n          <tr style=\"background:#fafafa\">\n            <td style=\"border:1px solid #e5e7eb;padding:8px\">Issuer Role</td>\n            <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(hints.issuer_role || '')}</td>\n          </tr>\n          <tr>\n            <td style=\"border:1px solid #e5e7eb;padding:8px\">Counterparty Role</td>\n            <td style=\"border:1px solid #e5e7eb;padding:8px\">${esc(hints.counterparty_role || '')}</td>\n          </tr>\n        </table>\n      `)}\n      ${main}\n      ${appendix}\n      <hr style=\"border:none;border-top:1px solid #e5e7eb;margin:18px 0\">\n      ${footerBlock()}\n    </div>\n  </div>\n</body>\n</html>`;\n\n// ---------- output binary ----------\nconst outName = (doc.fileName || `${(c.simulationId||'Sim').replace(/\\s+/g,'_')}_${(c.docType||'Document').replace(/\\s+/g,'_')}_${c.docId||'ID'}.txt`)\n  .replace(/\\//g,'_')\n  .replace(/\\.txt$/i,'.html');\n\nreturn {\n  json: {},\n  binary: {\n    data: {\n      data: Buffer.from(html, 'utf8').toString('base64'),\n      mimeType: 'text/html',\n      fileName: outName\n    }\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2300,
        3800
      ],
      "id": "63469ef5-00d4-4644-a8c7-152d852bf31e",
      "name": "Code7"
    },
    {
      "parameters": {
        "operation": "compress",
        "binaryPropertyName": "converted.pdf",
        "fileName": "simthetic.zip",
        "binaryPropertyOutput": "simthetic.pdfs"
      },
      "type": "n8n-nodes-base.compression",
      "typeVersion": 1.1,
      "position": [
        -1660,
        3700
      ],
      "id": "cfb4b5cd-5f57-4c20-9365-bb114f3e64e1",
      "name": "Compression"
    },
    {
      "parameters": {
        "operation": "compress",
        "binaryPropertyName": "converted.pdf",
        "fileName": "test.zip"
      },
      "type": "n8n-nodes-base.compression",
      "typeVersion": 1.1,
      "position": [
        -2360,
        3100
      ],
      "id": "aad87e33-66e1-4054-b2a4-737c0463193f",
      "name": "Compression1"
    },
    {
      "parameters": {
        "outputPrefix": "test_"
      },
      "type": "n8n-nodes-base.compression",
      "typeVersion": 1.1,
      "position": [
        -2060,
        3100
      ],
      "id": "3d93504f-9361-4201-8367-2c1d1eae5af5",
      "name": "Decompress"
    },
    {
      "parameters": {
        "content": "# Bulk PDF or Excel export file genearation:\n## example usage: \nhttps://n8n.simthetic.ai/webhook/simthetic-bulk-docs?project_id=48&format=excel\nhttps://n8n.simthetic.ai/webhook/simthetic-bulk-docs?project_id=48&format=pdf",
        "height": 1240,
        "width": 4640,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4800,
        3520
      ],
      "typeVersion": 1,
      "id": "6203d1e4-ff52-4fcc-b742-d33ff23899de",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "binaryPropertyName": "simthetic.pdfs",
        "outputPrefix": "test_"
      },
      "type": "n8n-nodes-base.compression",
      "typeVersion": 1.1,
      "position": [
        -1320,
        3700
      ],
      "id": "acb7ab16-63a3-45e1-8a36-eda0a903cff1",
      "name": "Decompress1"
    },
    {
      "parameters": {
        "respondWith": "binary",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        840,
        4240
      ],
      "id": "191b9d37-46b1-4fc1-800e-dc4600cb5eda",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "path": "simthetic-bulk-docs",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4640,
        4160
      ],
      "id": "924e0163-3617-458e-bb64-2b2594ae89ba",
      "name": "Webhook4",
      "webhookId": "68f81f33-928d-4610-9a0b-0728caa8f9a6"
    },
    {
      "parameters": {
        "jsCode": "// Helper to parse title like \"disbursement_listing - DL-901\"\nfunction parseTitle(title = \"\") {\n  const [rawType = \"\", rawId = \"\"] = title.split(\" - \").map(s => s.trim());\n  return { docType: rawType, docId: rawId };\n}\n\nconst flattened = items.map(i => {\n  // Drill into the nested body where the document actually is\n  const inner = i?.json?.body?.body || {};\n  const { format = \"\", title = \"\", data = {} } = inner;\n  const { docType, docId } = parseTitle(title);\n\n  return {\n    json: {\n      DocType: docType,\n      DocId: docId,\n      Format: format,\n      ...data,\n    },\n  };\n});\n\nreturn flattened;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2560,
        2000
      ],
      "id": "bf402500-40bd-44ec-9bd3-2f11fe0e2f07",
      "name": "Code13"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2060,
        2000
      ],
      "id": "3c559727-6563-42a5-909b-d2b9b8696538",
      "name": "Convert to File1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -4700,
        1140
      ],
      "id": "afca2626-a6d6-46cc-b870-9f8e5e9a3b61",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "afa2e46d-e500-4261-ae91-c9d393918588",
              "name": "project_id",
              "value": "={{ $('Webhook4').item.json.query.project_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3060,
        4440
      ],
      "id": "ca4a34c4-a0d0-438e-8be4-09d10d17685e",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "project_simulation_id",
              "value": "={{ $('Edit Fields5').item.json.project_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1920,
        4440
      ],
      "id": "6fc0df12-3764-4425-bd0d-6c6fe2a99190",
      "name": "Select rows from a table",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Single csv/excel export",
        "height": 480,
        "width": 2060,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3800,
        1780
      ],
      "typeVersion": 1,
      "id": "2966baa5-3ece-4900-a802-ea4538b3e3af",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "## Single txt export",
        "height": 480,
        "width": 2060,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3820,
        2360
      ],
      "typeVersion": 1,
      "id": "0e3c960d-852b-4f3d-9294-a50312eb2bb8",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "## Single pdf export",
        "height": 480,
        "width": 2060,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3840,
        2940
      ],
      "typeVersion": 1,
      "id": "04014bbe-0849-40bb-81ce-539a317da08e",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "afa2e46d-e500-4261-ae91-c9d393918588",
              "name": "project_id",
              "value": "={{ $('Webhook4').item.json.query.project_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3400,
        3800
      ],
      "id": "de907414-6e71-45c7-ad05-bbb5d996a898",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "project_simulation_id",
              "value": "={{ $json.project_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3100,
        3800
      ],
      "id": "0845e5d7-4b34-43a9-aaef-2fa11a07456e",
      "name": "Select rows from a table1",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8385aac1-f904-4ae8-b657-00e615828980",
              "leftValue": "={{ $json.query.format }}",
              "rightValue": "=pdf",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4020,
        3820
      ],
      "id": "0a367a2b-9830-4f61-9e13-ea3b63f1758c",
      "name": "If2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6d7636c7-9b53-4e3a-8fcb-a01fc1567ad5",
              "leftValue": "={{ $json.query.format }}",
              "rightValue": "excel",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3960,
        4440
      ],
      "id": "7c9c2de0-3d7d-48a8-86d5-457b86d9d618",
      "name": "If3"
    },
    {
      "parameters": {
        "content": "# Listing all simulations for the main page",
        "height": 620,
        "width": 4660,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4800,
        4800
      ],
      "typeVersion": 1,
      "id": "d90200ef-fa3c-490a-a43f-3b12139028e2",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "# PDF",
        "height": 360,
        "width": 3080,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4040,
        3660
      ],
      "typeVersion": 1,
      "id": "9cd4d7f1-9379-4bbb-9c3b-18462529d20d",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "# Excel",
        "height": 360,
        "width": 3080,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4020,
        4300
      ],
      "typeVersion": 1,
      "id": "9f9b8b9c-1ea4-4502-adaf-634311e65e31",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import zipfile\nimport base64\nimport io\n\n# Get all input items \nitems = _input.all()\n\nprint(f\"Processing {len(items)} items for ZIP creation\")\n\n# Create a BytesIO object to hold the ZIP file in memory\nzip_buffer = io.BytesIO()\n\n# Create a ZIP file\nwith zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zip_file:\n    for i, item in enumerate(items):\n        try:\n            # Debug: Print binary keys\n            if 'binary' not in item:\n                print(f\"Item {i} skipped: No binary key\")\n                continue\n\n            binary_keys = list(item['binary'].keys())\n            if not binary_keys:\n                print(f\"Item {i} skipped: Binary key is empty\")\n                continue\n\n            key = binary_keys[0]  # Use the first binary key (e.g., 'test_0', 'data')\n            binary_data = item['binary'][key]\n\n            pdf_data = binary_data.get('data')\n            original_filename = binary_data.get('fileName', f'document_{i+1}.pdf')\n\n            # Fallback for file extension\n            if not original_filename.endswith('.pdf'):\n                pdf_filename = original_filename.replace('.html', '.pdf')\n            else:\n                pdf_filename = original_filename\n\n            # Decode base64 to bytes\n            pdf_bytes = base64.b64decode(pdf_data)\n\n            # Check it's a valid PDF\n            if pdf_bytes.startswith(b'%PDF'):\n                print(f\"Adding valid PDF: {pdf_filename} ({len(pdf_bytes)} bytes)\")\n                zip_file.writestr(pdf_filename, pdf_bytes)\n            else:\n                print(f\"Warning: {pdf_filename} doesn't look like a PDF, adding as INVALID_{pdf_filename}\")\n                zip_file.writestr(f\"INVALID_{pdf_filename}\", pdf_bytes)\n\n        except Exception as e:\n            print(f\"Error processing item {i}: {str(e)}\")\n            continue\n\n# Finalize ZIP\nzip_buffer.seek(0)\nzip_bytes = zip_buffer.read()\nzip_base64 = base64.b64encode(zip_bytes).decode('utf-8')\n\nprint(f\"ZIP created: {len(zip_bytes)} bytes, {len(items)} items\")\n\n# Return final ZIP as binary\nreturn [{\n    'json': {\n        'message': f\"ZIP created with {len(items)} files\",\n        'fileCount': len(items),\n        'zipSizeBytes': len(zip_bytes)\n    },\n    'binary': {\n        'data': {\n            'data': zip_base64,\n            'fileName': 'simulation_documents.zip',\n            'mimeType': 'application/zip'\n        }\n    }\n}]\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1100,
        3700
      ],
      "id": "9c88b7e2-d34f-4096-bc58-5ea4d7b96bb3",
      "name": "Code8"
    },
    {
      "parameters": {
        "content": "# Main Workflow / Error & Documents Generation",
        "height": 1120,
        "width": 5980
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4820,
        560
      ],
      "typeVersion": 1,
      "id": "4e362596-86a4-40c2-9e6d-190d0abda0cf",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "jsCode": "  // 1. Build the array of document-objects\n  const allDocs = items.map(item => item.json);\n\n  // 2. Get the company name from the input data (using array index instead of .last())\n  const inputData = $('Select rows from a table2').item.json;\n  const companies = inputData.input_config.companies;\n  const companyName = companies[companies.length - 1].company_name;\n\n  // 3. Wrap it in an object so `json` is an object, adding company_name below project_simulation_id\n  return [\n    {\n      json: {\n        company_name: companyName,\n        docs: allDocs\n        \n      }\n    }\n  ];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -880,
        4440
      ],
      "id": "d3367431-98c4-4a1d-9de3-f7f54073cab4",
      "name": "Code9"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://34.59.1.191:8000/process-documents",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "body": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -420,
        4440
      ],
      "id": "6b5fae06-857a-4f33-917e-376291b8f8c2",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "jsCode": "// There’s 1 item in your screenshot; grab it\nconst item = $input.first();\nconst run = item.json;            // or item.json.run / item.json.formattedResponse if nested\n\nconst counts = {};\nfor (const d of (run.generatedDocuments ?? [])) {\n  const k = d.docType;\n  counts[k] = (counts[k] ?? 0) + 1;\n}\n\nrun.metadata ??= {};\nrun.metadata.documentCounts = counts;\nrun.metadata.totalDocuments = (run.generatedDocuments ?? []).length;\n\n// Return the modified payload\nreturn [{ json: run }];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2280,
        1140
      ],
      "id": "5ac31c26-55f9-4e33-a10d-42aaaa622d47",
      "name": "documentCounts"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1520,
        1340
      ],
      "id": "bece5b4c-df32-41ea-b91a-061b2072b52b",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "project_simulations",
          "mode": "list",
          "cachedResultName": "project_simulations"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "is_deleted": false,
            "project_name": "={{ $('Get Jsons').item.json.projectName }}",
            "document_count": "={{ $json.document_count }}",
            "scenario_name": "={{ $('Get Jsons').item.json.scenarioName }}",
            "input_config": "={{ $('Webhook').item.json.body }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name",
              "displayName": "project_name",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "scenario_name",
              "displayName": "scenario_name",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "document_count",
              "displayName": "document_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "input_config",
              "displayName": "input_config",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "is_deleted",
              "displayName": "is_deleted",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2500,
        1140
      ],
      "id": "ff0278d9-1b6b-4d9f-93b4-7254e78ff167",
      "name": "Insert rows in a table",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "project_simulations",
          "mode": "list",
          "cachedResultName": "project_simulations"
        },
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('Edit Fields5').item.json.project_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2840,
        4440
      ],
      "id": "d02f64af-1947-404f-a51c-846dce240f1a",
      "name": "Select rows from a table2",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74d35356-73f0-4dc1-90c4-b3b6b0da9526",
              "name": "=company_name",
              "value": "={{ $('Select rows from a table2').item.json.input_config.companies.last().company_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2620,
        4440
      ],
      "id": "babfba11-d592-4242-9f4a-f7cfb9c19de6",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "you have access to google docs tool. always try to read it anytime you're asked about any accounting-related question"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -2600,
        7520
      ],
      "id": "894fd3a1-79bf-4b30-9cff-cadff5247543",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "1_L_YYQ12ev3JeGCQb_jxXvxRz4vdeat7bg4YBPi2TQ4",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "Hanover Trust Bank",
              "replaceText": "Bank of Gotham"
            },
            {
              "action": "replaceAll",
              "text": "*****8432",
              "replaceText": "INVALID-BS-123"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -2020,
        7840
      ],
      "id": "ba5338bc-b189-4861-ab44-a82d8283d6b5",
      "name": "Update a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "vm67P9Gj5inkaSlp",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -2840,
        7520
      ],
      "id": "ff3dca12-e0e0-4049-8adb-0eec991277bf",
      "name": "When chat message received",
      "webhookId": "d2380de1-ecc5-4123-b841-60035c5f2c61"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -2600,
        7760
      ],
      "id": "4893e1dd-8967-4003-8a91-2d2b65a8c195",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -2420,
        7820
      ],
      "id": "ce865bf0-1dd7-4ae8-991b-8727ada82b43",
      "name": "Simple Memory",
      "disabled": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -2760,
        7760
      ],
      "id": "3a293081-bf1a-4e68-a756-1713984e29f6",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "T7DClLev3Ec2hOEo",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -1860,
        7700
      ],
      "id": "f1002b1c-b557-46cc-b75c-b57acf1f96e8",
      "name": "Create a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "vm67P9Gj5inkaSlp",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "db1a8603-ca94-4b31-a19b-e6c8011ba295",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3020,
        7520
      ],
      "id": "9fad87b6-415f-4066-baac-c72e3dd5b9a2",
      "name": "Webhook5",
      "webhookId": "db1a8603-ca94-4b31-a19b-e6c8011ba295"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        -2080,
        7740
      ],
      "id": "e92c01a9-c509-47e5-8845-a0c7a24483f7",
      "name": "MCP Client",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Doc_ID_or_URL', ``, 'string') }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        -2160,
        7880
      ],
      "id": "6521a0ff-6678-4059-9bd5-4aa4203e8a7e",
      "name": "balance_sheet",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "vm67P9Gj5inkaSlp",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "1_L_YYQ12ev3JeGCQb_jxXvxRz4vdeat7bg4YBPi2TQ4",
        "simple": false,
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "locationChoice": "location",
              "index": 10,
              "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('actionFields0_Text', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        -2280,
        7800
      ],
      "id": "380b16fd-e2fb-47fb-b73c-fbe394d0b80c",
      "name": "invoice",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "vm67P9Gj5inkaSlp",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "content": "## docs templates pdf test",
        "height": 80,
        "width": 560
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3000,
        7400
      ],
      "typeVersion": 1,
      "id": "330ec293-365b-47c6-98b9-d6d644e8de9e",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "soft-delete",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4560,
        6440
      ],
      "id": "3d15743f-dc3b-4877-82d4-a2312e127a28",
      "name": "Webhook6",
      "webhookId": "379f2751-9b14-47c7-b9e4-def40f117cc3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE project_simulations\nSET is_deleted = TRUE, updated_at = NOW()\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ $json.body.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3120,
        6440
      ],
      "id": "ec1d59ce-f0da-4b7e-8ae0-71182c541c82",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1860,
        6440
      ],
      "id": "22e641ef-7660-467e-a2fd-f211a7a0c98c",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "content": "## soft delete project simulation\n\n### example usage\n\ncurl -X POST https://n8n.simthetic.ai/webhook-test/soft-delete \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"id\": 2}'",
        "height": 620,
        "width": 4660,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4800,
        6220
      ],
      "typeVersion": 1,
      "id": "75b9b3f8-833e-4234-9507-b7b71bdca6ac",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -7540,
        12480
      ],
      "id": "ff912727-a31a-4061-9987-60df36fe97be",
      "name": "Loop Over Items3",
      "executeOnce": false
    },
    {
      "parameters": {
        "fieldToSplitOut": "simulations",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -6700,
        12580
      ],
      "id": "283c5ab2-b433-477d-9148-3970b84ca613",
      "name": "Split Out7"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://34.59.1.191:8000/html-pdf-converter",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "orientation",
              "value": "portrait"
            },
            {
              "name": "fit_to_page",
              "value": "true"
            },
            {
              "name": "filename",
              "value": "={{ $binary.data.fileName.split('.').slice(0, -1).join('.') }}.pdf"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1300,
        14060
      ],
      "id": "430a54cc-6650-4c31-b86c-be64570b796c",
      "name": "HTTP Request5"
    },
    {
      "parameters": {
        "jsCode": "const item = items[0].json;\n\nconst keys = Object.keys(item);\n\nconst result = [];\n\nkeys.forEach((key) => {\n  result.push({\n    json: {\n      column: key,\n      value: item[key],\n    },\n  });\n});\n\nreturn result;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6640,
        12920
      ],
      "id": "41b20c8a-6e34-4fef-bcdf-5ea2c75a9a62",
      "name": "Code10"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e4c2e8e-27b7-48a9-b524-5753b45e20e9",
              "name": "column",
              "value": "={{ $json.docType }}",
              "type": "string"
            },
            {
              "id": "3fd4f590-689a-498b-bfcf-c9d350b3b150",
              "name": "value",
              "value": "={{ $json.data }}",
              "type": "object"
            },
            {
              "id": "901707af-fae4-4a06-81e7-dd3dd94ece8b",
              "name": "companyProfile",
              "value": "={{ $('Initial1').item.json.document_data.companyProfile }}",
              "type": "object"
            },
            {
              "id": "67ff2370-0714-4433-8573-cbd8d9a34124",
              "name": "runindex",
              "value": "={{ $runIndex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6200,
        12600
      ],
      "id": "7a46039f-7ba2-4a45-83e8-f81192557694",
      "name": "Edit Fields16"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "wire",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "146344cf-50b7-4cff-959d-0415ebcd83ce"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ad0f8eb7-2b1e-420f-8d5a-caa9a837467a",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "bank",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5db1bd82-c9a4-4126-87f8-6f8af18d1394",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Invoice (Goods)",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3fdb2e47-5c26-4020-a180-528ff4f36e3f",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "expenses",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "66b17d40-652b-44d9-85e7-69cea52454d2",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "disbursement",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6fc94af0-bbe9-43a8-bd68-f8e1249b4b71",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Invoices (for Services)",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d8268b87-f26c-45ba-9a14-f56b82e043a7",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Purchase Contract Snippet",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6312c7b0-5402-4ba2-9329-25471c68ed1c",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Shipping Document (Sending)",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51e5a37c-7a3d-4cfe-be8a-1aa924e893e6",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Shipping Document (Receiving)",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0b5e2650-269b-439e-9072-f50ac59aaca1",
                    "leftValue": "={{ $json.column }}",
                    "rightValue": "Order Document",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -5920,
        12460
      ],
      "id": "87e7e72d-3d9f-4426-8b08-cb1e78f11251",
      "name": "Switch3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the json format is stritcly followed from template_json. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only json and no other data. Dont add any ticks or json \n\ntemplate_json:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4680,
        11040
      ],
      "id": "f5a4ec61-e4c0-4159-8efe-0e5c0abcd441",
      "name": "AI Agent25"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4760,
        11220
      ],
      "id": "ad96635a-84a2-4e43-9bcc-c6b810cad7d5",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 10
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1860,
        12880
      ],
      "id": "47310d46-26af-475b-926c-8e5a1642a13b",
      "name": "Merge3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only json and no other data. Dont add any ticks or json \n\ntemplate_json:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only html file, no ticks or ```html"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4620,
        11720
      ],
      "id": "c08493de-3ff6-4ba7-9fdb-b601913baaf6",
      "name": "AI Agent26"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4660,
        11900
      ],
      "id": "1628f95c-3d9a-4b65-8973-408a56fcbaab",
      "name": "OpenAI Chat Model16",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only json and no other data. Dont add any ticks or json \n\ntemplate_json:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4620,
        12040
      ],
      "id": "2a89fa26-01c8-4c63-a016-8b625c0099d8",
      "name": "AI Agent27"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4720,
        12220
      ],
      "id": "615451aa-3776-4d1d-bde5-2d7600a3ff2f",
      "name": "OpenAI Chat Model17",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Expense_sub_Ledger_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3520,
        12040
      ],
      "id": "d3c1ab08-6407-415a-be12-bcd5390ab046",
      "name": "Convert to File18"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only json and no other data. Dont add any ticks or json \n\ntemplate_json:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4680,
        12340
      ],
      "id": "004f172a-b97f-4ec0-b373-e95b582af065",
      "name": "AI Agent28"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4740,
        12520
      ],
      "id": "80557473-28c9-4a67-bcb8-c887f587c1cf",
      "name": "OpenAI Chat Model18",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Disbursment_listing_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3480,
        12340
      ],
      "id": "e2aa2cdf-9123-44c7-8fb5-0d829e710db9",
      "name": "Convert to File19"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4680,
        12660
      ],
      "id": "be56b98c-1403-417a-aa2f-36e7cce560d2",
      "name": "AI Agent29"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4760,
        12840
      ],
      "id": "6b99025a-7580-4d7c-b051-ce98c91ccf50",
      "name": "OpenAI Chat Model19",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Invoice_Services_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3440,
        12660
      ],
      "id": "f33aee42-a0e8-4e89-abee-d6b52400210c",
      "name": "Convert to File20"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4680,
        12980
      ],
      "id": "f417f59f-72d1-43d8-b5f4-c70523f602bd",
      "name": "AI Agent30"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4760,
        13140
      ],
      "id": "6aea8715-d3e3-4e98-8e0c-fdcf756c8094",
      "name": "OpenAI Chat Model20",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Purchase_Order_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3360,
        12980
      ],
      "id": "d74b2827-b96c-4304-9569-94cbe219f1e2",
      "name": "Convert to File21"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4660,
        13220
      ],
      "id": "96752a4f-7859-455d-9119-f0ee8ceb9e5b",
      "name": "AI Agent31"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4740,
        13400
      ],
      "id": "8cd6bfe8-1699-4cff-9288-12a41d1c4152",
      "name": "OpenAI Chat Model21",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Shipping_Document_Sending_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3340,
        13220
      ],
      "id": "db388016-e487-447b-888e-d9d649818405",
      "name": "Convert to File22"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4700,
        13540
      ],
      "id": "a1a37fb3-a206-4a92-a626-d5957e26e346",
      "name": "AI Agent32"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4760,
        13680
      ],
      "id": "8b998e63-30d0-4605-94cf-235250c603a9",
      "name": "OpenAI Chat Model22",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Shipping_Document_Recieving_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3300,
        13540
      ],
      "id": "490740fe-04c3-4aa3-b08c-94d2bc5d2737",
      "name": "Convert to File23"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create seperate json files based on value provided. Seek the information from data provided, and create json file for each doument mentioned. Ensure no document is missed and the format is stritcly followed from template. Only create documents of present documents and not any other.  Ensure Recipeient name and company name should be present if required. strictly following branding guidelines. strictly use logo_url for logo. Make with light backgroud for printout with pdf.   Currency should be in dollar, so add $ in front of currency. \n\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}\nThe output needs to be only html and no other data. Dont add any ticks or html \n\nTemplates:\n{{ $json.template_json }}\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4700,
        13800
      ],
      "id": "d9805812-665e-456b-bbf9-3773f5c309e8",
      "name": "AI Agent33"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4800,
        13980
      ],
      "id": "77b0f451-9632-41f6-9a2d-c79d8afa671b",
      "name": "OpenAI Chat Model23",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Order_Document_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3260,
        13800
      ],
      "id": "99e01821-1813-4be6-a7a5-d3625bd2e8cf",
      "name": "Convert to File24"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {
          "includeBinaries": true
        }
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1100,
        14060
      ],
      "id": "a82d0f86-59c3-423d-b108-d420cd583986",
      "name": "Aggregate6"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "project_simulations",
          "mode": "list",
          "cachedResultName": "project_simulations"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $json.project_simulation_id }}"
            }
          ]
        },
        "sort": {
          "values": [
            {
              "column": "id",
              "direction": "DESC"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8440,
        12640
      ],
      "id": "82cb2210-06c1-4e22-8581-6665f77904d6",
      "name": "Select rows from a table5",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "advanced": true,
        "mergeByFields": {
          "values": [
            {
              "field1": "project_simulation_id",
              "field2": "id"
            }
          ]
        },
        "joinMode": "enrichInput1",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -8200,
        12480
      ],
      "id": "34151d90-caba-4965-bb8e-1415b2c66571",
      "name": "Merge4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ce60c50a-df6d-4908-9630-f920aad9c86f",
              "name": "simulations",
              "value": "={{\n  $json.document_data.simulationsResults[0].simulations.processedRuns\n    .map(run => Object.values(run.processedDocuments || {}))\n    .reduce((acc, arr) => acc.concat(...arr), [])\n}}",
              "type": "array"
            },
            {
              "id": "94d0b360-b005-4dac-82e9-4f31fad3d382",
              "name": "company",
              "value": "={{ $json.input_config.stage1.companies[0] }}",
              "type": "object"
            },
            {
              "id": "a6908ae3-3525-4b62-9d64-5b200fed01d7",
              "name": "company_profile",
              "value": "={{ $json.document_data.companyProfile }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -8000,
        12600
      ],
      "id": "82549b6d-0ae3-48b4-962c-26c0476cc891",
      "name": "Edit Fields17",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Create values based on Data and Generic Information provided. Seek the information from data provided, and create json. Ensure the output json format is stritcly followed from template_json.  As it is bank statement or any other statement create some fake entries to look real. The data contains a specific transaction with transaction number and details. Dont change the transactions details. Keep it as is and create fake credit and deposit entries around it. Also give them a valid transaction number. Bank name should be present with bank details on top. strictly following branding guidelines. strictly use logo_url for logo under templates. Currency should be in dollar, so add $ in front of currency.\n\nReverify-\n- Recalcultae and verify Deposit total. To calculate Deposit total, add all entries under deposit or credit\n- Recalcultae and verify Withdrawl total. To calculate Withdrawl total, add all entries under withdrawl or debit\n- Rest all other fields should match as is in data\n\nThe output needs to be only json and no other data. Dont add any ticks or html \n\ntemplate_json:\n{{ $json.template_json.toJsonString() }}\n\n\nData:\n{{ $json.value.toJsonString() }}\n\nGeneric information:\n{{ $('Merge4').item.json.input_config.stage1.companies[0].toJsonString() }}\n{{ $json.companyProfile.toJsonString() }}",
        "options": {
          "systemMessage": "create only json file, no ticks or ```json"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4640,
        11400
      ],
      "id": "7da2f764-38dc-4dfb-897e-3b784588af6b",
      "name": "AI Agent34"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -4700,
        11580
      ],
      "id": "f008fefd-51d0-4a81-8400-35c4ae83310a",
      "name": "OpenAI Chat Model24",
      "credentials": {
        "openAiApi": {
          "id": "Wxnt3BBrJNtydlea",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"wireTransferSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"styling\": {\n        \"background_color\": \"<<background_color>>\",\n        \"text_color\": \"<<text_color>>\",\n        \"transfer_background\": \"<<transfer_background>>\",\n        \"border_color\": \"<<border_color>>\",\n        \"primary_color\": \"<<primary_color>>\",\n        \"title_background\": \"<<title_background>>\",\n        \"title_text_color\": \"<<title_text_color>>\",\n        \"account_info_background\": \"<<account_info_background>>\",\n        \"detail_border_color\": \"<<detail_border_color>>\",\n        \"details_background\": \"<<details_background>>\",\n        \"accent_color\": \"<<accent_color>>\",\n        \"table_header_background\": \"<<table_header_background>>\",\n        \"table_border_color\": \"<<table_border_color>>\",\n        \"confirmation_background\": \"<<confirmation_background>>\",\n        \"confirmation_border_color\": \"<<confirmation_border_color>>\"\n      },\n      \"logo\": {\n        \"logo_url\": \"<<logo_url>>\",\n        \"logo_width\": \"<<logo_width>>\",\n        \"logo_height\": \"<<logo_height>>\",\n        \"logo_background\": \"<<logo_background>>\",\n        \"logo_text_color\": \"<<logo_text_color>>\",\n        \"logo_text\": \"<<logo_text>>\"\n      },\n      \"bank_info\": {\n        \"bank_name\": \"<<bank_name>>\",\n        \"bank_address\": \"<<bank_address>>\"\n      },\n      \"requestor\": {\n        \"requestor\": \"<<requestor_name>>\",\n        \"requestor_account_number\": \"<<requestor_account_number>>\",\n        \"requestor_routing_number\": \"<<requestor_routing_number>>\",\n        \"requestor_bank_name\": \"<<requestor_bank_name>>\",\n        \"requestor_address\": \"<<requestor_address>>\"\n      },\n      \"recipient\": {\n        \"recipient\": \"<<recipient_name>>\",\n        \"recipient_account_number\": \"<<recipient_account_number>>\",\n        \"recipient_routing_number\": \"<<recipient_routing_number>>\",\n        \"recipient_bank_name\": \"<<recipient_bank_name>>\",\n        \"recipient_address\": \"<<recipient_address>>\"\n      },\n      \"transaction\": {\n        \"transaction_type\": \"<<transaction_type>>\",\n        \"amount\": \"<<amount>>\",\n        \"currency\": \"<<currency>>\",\n        \"wire_date\": \"<<wire_date>>\",\n        \"transaction_number\": \"<<transaction_number>>\",\n        \"memo_reference\": \"<<memo_reference>>\"\n      },\n      \"confirmation\": {\n        \"confirmation_number\": \"<<confirmation_number>>\",\n        \"confirmation_message\": \"<<confirmation_message>>\"\n      },\n      \"footer\": {\n        \"footer_text\": \"<<footer_text>>\"\n      }\n    }\n  }\n}",
              "type": "string"
            },
            {
              "id": "deed7af2-d464-46a0-a5ff-941739da4d01",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4880,
        11040
      ],
      "id": "b7376dcc-5ce8-4491-a0bc-19afc40baf38",
      "name": "Wire Transfer1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"document_title\": \"Bank Statement\",\n  \"theme\": {\n    \"background\": \"<<background_color>>\",\n    \"text\": \"<<text_color>>\",\n    \"primary\": \"<<primary_color>>\",\n    \"border\": \"<<border_color>>\",\n    \"muted\": \"<<muted_text_color>>\",\n    \"header_text\": \"<<header_text_color>>\",\n    \"table_head\": \"<<table_head_bg>>\",\n    \"table_head_text\": \"<<table_head_text_color>>\",\n    \"row_alt\": \"<<row_alternate_bg>>\",\n    \"statement_bg\": \"<<statement_bg_color>>\",\n    \"account_info_bg\": \"<<account_info_bg_color>>\",\n    \"withdrawal\": \"<<withdrawal_color>>\",\n    \"deposit\": \"<<deposit_color>>\",\n    \"balance\": \"<<balance_color>>\",\n    \"footer_text\": \"<<footer_text_color>>\",\n    \"logo_bg\": \"<<logo_background>>\"\n  },\n  \"bank\": {\n    \"name\": \"<<bank_name>>\",\n    \"address\": \"<<bank_address>>\",\n    \"logo\": {\n      \"url\": \"<<bank_logo_url>>\",\n      \"width\": \"<<logo_width>>\",\n      \"height\": \"<<logo_height>>\",\n      \"text\": \"<<bank_logo_text>>\",\n      \"text_color\": \"<<logo_text_color>>\"\n    }\n  },\n  \"account\": {\n    \"name\": \"<<account_holder_name>>\",\n    \"address\": \"<<account_holder_address>>\",\n    \"number\": \"<<account_number>>\",\n    \"type\": \"<<account_type>>\"\n  },\n  \"statement_period\": {\n    \"from\": \"<<start_date>>\",\n    \"to\": \"<<end_date>>\"\n  },\n  \"summary\": {\n    \"opening_balance\": \"<<opening_balance>>\",\n    \"closing_balance\": \"<<closing_balance>>\",\n    \"deposit_totals\": \"<<deposit_totals>>\",\n    \"withdrawal_totals\": \"<<withdrawal_totals>>\",\n    \"fees_total\": \"<<fees_total>>\",\n    \"interest_earned\": \"<<interest_earned>>\",\n    \"interest_paid\": \"<<interest_paid>>\"\n  },\n  \"transactions\": [\n    {\n      \"date\": \"<<transaction_date>>\",\n      \"transaction_number\": \"<<transaction_id>>\",\n      \"description\": \"<<transaction_description>>\",\n      \"debit_amount\": \"<<debit_amount>>\",\n      \"credit_amount\": \"<<credit_amount>>\",\n      \"fees\": \"<<fees_amount>>\",\n      \"interest\": \"<<interest_amount>>\",\n      \"balance\": \"<<post_transaction_balance>>\",\n      \"is_debit\": \"<<true_or_false>>\",\n      \"is_credit\": \"<<true_or_false>>\"\n    },\n    {\n      \"date\": \"<<transaction_date>>\",\n      \"transaction_number\": \"<<transaction_id>>\",\n      \"description\": \"<<transaction_description>>\",\n      \"debit_amount\": \"<<debit_amount>>\",\n      \"credit_amount\": \"<<credit_amount>>\",\n      \"fees\": \"<<fees_amount>>\",\n      \"interest\": \"<<interest_amount>>\",\n      \"balance\": \"<<post_transaction_balance>>\",\n      \"is_debit\": \"<<true_or_false>>\",\n      \"is_credit\": \"<<true_or_false>>\"\n    }\n    // … add more transaction objects as needed\n  ],\n  \"notes\": {\n    \"alerts\": \"<<alerts_text>>\",\n    \"closure_details\": \"<<closure_details>>\"\n  },\n  \"footer_text\": \"<<footer_text>>\"\n}",
              "type": "object"
            },
            {
              "id": "4cf173b8-2b0e-4333-a7f8-d997418deea0",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4920,
        11400
      ],
      "id": "21c48eb3-a793-4ca6-a264-73c78b9abdb4",
      "name": "Bank_Statement1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"invoice\": {\n    \"document_type\": \"<<document_type>>\",\n    \"logo_url\": \"<<logo_url>>\",\n    \"currency\": \"<<currency>>\",\n    \"company\": {\n      \"name\": \"<<company_name>>\",\n      \"address\": \"<<company_address>>\",\n      \"contact\": \"<<company_contact>>\",\n      \"details\": \"<<company_details>>\"\n    },\n    \"meta\": {\n      \"invoice_number\": \"<<invoice_number>>\",\n      \"invoice_date\": \"<<invoice_date>>\",\n      \"due_date\": \"<<due_date>>\",\n      \"po_number\": \"<<po_number>>\",\n      \"delivery_date\": \"<<delivery_date>>\",\n      \"currency_unit\": \"<<currency_unit>>\",\n      \"shipping_terms\": \"<<shipping_terms>>\",\n      \"payment_terms\": \"<<payment_terms>>\"\n    },\n    \"recipient\": {\n      \"label\": \"<<recipient_label>>\",\n      \"name\": \"<<recipient_name>>\",\n      \"customer_number\": \"<<customer_number>>\",\n      \"account_number\": \"<<account_number>>\",\n      \"address\": \"<<recipient_address>>\"\n    },\n    \"items\": [\n      {\n        \"product_code\": \"<<product_code>>\",\n        \"description\": \"<<item_description>>\",\n        \"uom\": \"<<unit_of_measurement>>\",\n        \"quantity\": \"<<quantity>>\",\n        \"unit_price\": \"<<unit_price>>\",\n        \"line_total\": \"<<line_total>>\"\n      }\n    ],\n    \"totals\": {\n      \"subtotal\": \"<<subtotal>>\",\n      \"discount\": \"<<discount>>\",\n      \"freight_charges\": \"<<freight_charges>>\",\n      \"tax_details\": \"<<tax_details>>\",\n      \"tax_amount\": \"<<tax_amount>>\",\n      \"total_due\": \"<<total_due>>\"\n    },\n    \"notes\": [\n      \"<<note_1>>\",\n      \"<<note_2>>\"\n    ]\n  }\n}",
              "type": "string"
            },
            {
              "id": "3ecc8651-4c0b-4153-a07b-b1643bc30335",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4900,
        11720
      ],
      "id": "86ea6b77-c15c-4f29-934b-974f615ed7bd",
      "name": "Invoice(Goods)1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"logo_url\": \"<<logo_url>>\",\n  \"company_name\": \"<<company_name>>\",\n  \"company_address\": \"<<company_address>>\",\n  \"company_phone\": \"<<company_phone>>\",\n  \"company_email\": \"<<company_email>>\",\n  \"ledger_id\": \"<<ledger_id>>\",\n  \"entity_name\": \"<<entity_name>>\",\n  \"period_start\": \"<<period_start>>\",\n  \"period_end\": \"<<period_end>>\",\n  \"base_currency\": \"<<base_currency>>\",\n  \"prepared_on\": \"<<prepared_on>>\",\n  \"prepared_by\": \"<<prepared_by>>\",\n  \"approval_status\": \"<<approval_status>>\",\n  \"department_name\": \"<<department_name>>\",\n  \"cost_center_code\": \"<<cost_center_code>>\",\n  \"project_code\": \"<<project_code>>\",\n  \"expense_items\": [\n    {\n      \"txn_date\": \"<<txn_date>>\",\n      \"vendor_payee\": \"<<vendor_payee>>\",\n      \"expense_category\": \"<<expense_category>>\",\n      \"description\": \"<<description>>\",\n      \"gl_account\": \"<<gl_account>>\",\n      \"quantity\": \"<<quantity>>\",\n      \"unit_cost\": \"<<unit_cost>>\",\n      \"tax_amount\": \"<<tax_amount>>\",\n      \"line_total\": \"<<line_total>>\",\n      \"transaction_number\": \"<<transaction_number>>\"\n    }\n  ],\n  \"category_summary\": [\n    {\n      \"category\": \"<<category>>\",\n      \"pre_tax\": \"<<pre_tax>>\",\n      \"tax\": \"<<tax>>\",\n      \"total\": \"<<total>>\"\n    }\n  ],\n  \"tax_summary\": [\n    {\n      \"tax_code\": \"<<tax_code>>\",\n      \"rate\": \"<<rate>>\",\n      \"taxable_amount\": \"<<taxable_amount>>\",\n      \"tax_amount\": \"<<tax_amount>>\"\n    }\n  ],\n  \"account_summary\": [\n    {\n      \"account_number\": \"<<account_number>>\",\n      \"account_name\": \"<<account_name>>\",\n      \"opening_balance\": \"<<opening_balance>>\",\n      \"debits\": \"<<debits>>\",\n      \"credits\": \"<<credits>>\",\n      \"ending_balance\": \"<<ending_balance>>\"\n    }\n  ],\n  \"subtotal_pretax\": \"<<subtotal_pretax>>\",\n  \"total_tax\": \"<<total_tax>>\",\n  \"gross_total\": \"<<gross_total>>\",\n  \"non_reimbursable_total\": \"<<non_reimbursable_total>>\",\n  \"advances_applied\": \"<<advances_applied>>\",\n  \"net_payable\": \"<<net_payable>>\",\n  \"fx_difference\": \"<<fx_difference>>\",\n  \"journal_entries\": [\n    {\n      \"account\": \"<<account>>\",\n      \"description\": \"<<description>>\",\n      \"debit\": \"<<debit>>\",\n      \"credit\": \"<<credit>>\"\n    }\n  ],\n  \"policy_notes\": \"<<policy_notes>>\",\n  \"approval_trail\": [\n    {\n      \"role\": \"<<role>>\",\n      \"name\": \"<<name>>\",\n      \"action\": \"<<action>>\",\n      \"date_time\": \"<<date_time>>\",\n      \"remarks\": \"<<remarks>>\"\n    }\n  ]\n}",
              "type": "string"
            },
            {
              "id": "d9ed6ffd-fd66-467d-b2c1-2df0b603e15a",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4880,
        12040
      ],
      "id": "9d5ecfe1-3094-42ac-af19-0f83ff7e52c4",
      "name": "Expenses Sub-Ledger1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"branding\": {\n    \"logo_url\": \"<<logo_url>>\",\n    \"logo_width\": \"<<logo_width>>\",\n    \"logo_height\": \"<<logo_height>>\",\n    \"font_family\": \"<<font_family>>\",\n    \"primary_color\": \"<<primary_color>>\"\n  },\n  \"colors\": {\n    \"background_color\": \"<<background_color>>\",\n    \"text_color\": \"<<text_color>>\",\n    \"invoice_background\": \"<<invoice_background>>\",\n    \"border_color\": \"<<border_color>>\",\n    \"header_background\": \"<<header_background>>\",\n    \"header_text_color\": \"<<header_text_color>>\",\n    \"company_name_color\": \"<<company_name_color>>\",\n    \"company_details_color\": \"<<company_details_color>>\",\n    \"details_background\": \"<<details_background>>\",\n    \"table_border_color\": \"<<table_border_color>>\",\n    \"table_header_background\": \"<<table_header_background>>\",\n    \"table_header_text_color\": \"<<table_header_text_color>>\",\n    \"table_text_color\": \"<<table_text_color>>\",\n    \"table_row_alternate_background\": \"<<table_row_alternate_background>>\",\n    \"total_background\": \"<<total_background>>\",\n    \"final_total_color\": \"<<final_total_color>>\"\n  },\n  \"company\": {\n    \"name\": \"<<company_name>>\",\n    \"address\": \"<<company_address>>\",\n    \"phone\": \"<<company_phone>>\",\n    \"email\": \"<<company_email>>\"\n  },\n  \"report_info\": {\n    \"start_date\": \"<<report_start_date>>\",\n    \"end_date\": \"<<report_end_date>>\",\n    \"bank_account\": \"<<bank_account>>\",\n    \"prepared_on\": \"<<prepared_on>>\",\n    \"prepared_by\": \"<<prepared_by>>\"\n  },\n  \"disbursements\": [\n    {\n      \"date\": \"<<disbursement_date>>\",\n      \"voucher\": \"<<voucher_number>>\",\n      \"payee\": \"<<payee_name>>\",\n      \"vendor_number\": \"<<vendor_number>>\",\n      \"mode\": \"<<payment_mode>>\",\n      \"instrument\": \"<<instrument_number>>\",\n      \"gl_account\": \"<<gl_account>>\",\n      \"project\": \"<<project_or_cost_center>>\",\n      \"description\": \"<<description>>\",\n      \"gross_amount\": \"<<gross_amount>>\",\n      \"withholding\": \"<<withholding>>\",\n      \"net_paid\": \"<<net_paid>>\",\n      \"status\": \"<<status>>\",\n      \"approved_by\": \"<<approved_by>>\"\n    }\n  ],\n  \"recipient\": {\n    \"name\": \"<<recipient_name>>\",\n    \"company\": \"<<recipient_company>>\"\n  }\n}",
              "type": "string"
            },
            {
              "id": "ee7794c6-872b-4558-8bef-a67f3c3c5acc",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4940,
        12340
      ],
      "id": "6f052dc0-fce8-4df5-88c6-367f22ef2b7d",
      "name": "Disbursement Listing1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"document_type\": \"<<document_type>>\",\n  \"currency_symbol\": \"<<currency_symbol>>\",\n  \"branding\": {\n    \"logo_url\": \"<<logo_url>>\"\n  },\n  \"theme\": {\n    \"primary_color\": \"<<primary_color>>\",\n    \"secondary_color\": \"<<secondary_color>>\",\n    \"accent_color\": \"<<accent_color>>\",\n    \"background_color\": \"<<background_color>>\",\n    \"text_color\": \"<<text_color>>\"\n  },\n  \"invoice\": {\n    \"header\": {\n      \"invoice_number\": \"<<invoice_number>>\",\n      \"invoice_date\": \"<<invoice_date>>\",\n      \"due_date\": \"<<due_date>>\",\n      \"po_number\": \"<<po_number>>\",\n      \"so_or_wo_number\": \"<<so_or_wo_number>>\",\n      \"delivery_or_completion_date\": \"<<delivery_or_completion_date>>\",\n      \"currency_unit\": \"<<currency_unit>>\",\n      \"shipping_or_delivery_terms\": \"<<shipping_or_delivery_terms>>\",\n      \"transfer_of_rights_indication\": \"<<transfer_of_rights_indication>>\",\n      \"payment_terms\": \"<<payment_terms>>\"\n    },\n    \"supplier\": {\n      \"supplier_name\": \"<<supplier_name>>\",\n      \"supplier_number\": \"<<supplier_number>>\",\n      \"supplier_address\": \"<<supplier_address>>\",\n      \"supplier_email\": \"<<supplier_email>>\",\n      \"supplier_phone\": \"<<supplier_phone>>\"\n    },\n    \"customer\": {\n      \"customer_name\": \"<<customer_name>>\",\n      \"customer_number\": \"<<customer_number>>\",\n      \"customer_account_number\": \"<<customer_account_number>>\",\n      \"customer_address\": \"<<customer_address>>\",\n      \"customer_email\": \"<<customer_email>>\",\n      \"customer_phone\": \"<<customer_phone>>\"\n    },\n    \"items\": [\n      {\n        \"product_code\": \"<<product_code>>\",\n        \"description\": \"<<item_description>>\",\n        \"uom\": \"<<unit_of_measure>>\",\n        \"quantity\": \"<<quantity>>\",\n        \"unit_price\": \"<<unit_price>>\",\n        \"line_total\": \"<<line_total>>\"\n      }\n    ],\n    \"totals\": {\n      \"subtotal\": \"<<subtotal>>\",\n      \"discount\": \"<<discount>>\",\n      \"freight_charges\": \"<<freight_charges>>\",\n      \"selling_costs\": \"<<selling_costs>>\",\n      \"tax_details\": \"<<tax_details>>\",\n      \"tax_amount\": \"<<tax_amount>>\",\n      \"total_amount_due\": \"<<total_amount_due>>\"\n    }\n  },\n  \"notes\": \"<<notes>>\",\n  \"footer\": \"<<footer>>\"\n}",
              "type": "string"
            },
            {
              "id": "94213780-385c-42e9-83d3-592efce6b80e",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4940,
        12660
      ],
      "id": "a162afcf-6dbd-4051-8d5f-6e732a398881",
      "name": "invoices_services1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"branding\": {\n    \"logo_url\": \"<<logo_url>>\",\n    \"font_family\": \"<<font_family>>\",\n    \"document_style\": \"<<document_style>>\"\n  },\n  \"colors\": {\n    \"primary_color\": \"<<primary_color>>\",\n    \"secondary_color\": \"<<secondary_color>>\"\n  },\n  \"company\": {\n    \"company_name\": \"<<company_name>>\",\n    \"department_name\": \"<<department_name>>\",\n    \"company_address\": \"<<company_address>>\"\n  },\n  \"vendor\": {\n    \"vendor_name\": \"<<vendor_name>>\",\n    \"vendor_address\": \"<<vendor_address>>\",\n    \"vendor_email\": \"<<vendor_email>>\"\n  },\n  \"data\": {\n    \"amount\": \"<<amount>>\",\n    \"source\": \"<<source>>\",\n    \"file_type\": \"<<file_type>>\",\n    \"service_dates\": \"<<service_dates>>\",\n    \"transaction_id\": \"<<transaction_id>>\"\n  }\n}",
              "type": "string"
            },
            {
              "id": "58dad027-559c-4f79-bd02-31aa0478746a",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4920,
        12980
      ],
      "id": "8ffdbb6f-38f9-470f-980f-58e59d4dba6e",
      "name": "Purchase Order1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"document\": {\n    \"type\": \"<<document_type>>\",\n    \"template\": \"<<template_name>>\"\n  },\n  \"branding\": {\n    \"logo_url\": \"https://logoipsum.com/wp-content/uploads/2020/07/logo-3.svg\",\n    \"font_family\": \"Inter\",\n    \"document_style\": \"formal\"\n  },\n  \"colors\": {\n    \"primary_color\": \"#334155\",\n    \"secondary_color\": \"#0F172A\"\n  },\n  \"company_info\": {\n    \"company_name\": \"<<company_name>>\",\n    \"company_address\": \"<<company_address>>\",\n    \"company_phone\": \"<<company_phone>>\",\n    \"company_email\": \"<<company_email>>\"\n  },\n  \"document_details\": {\n    \"shipping_document_number\": \"<<shipping_document_number>>\",\n    \"shipping_doc_date\": \"<<shipping_doc_date>>\",\n    \"purchase_order_number\": \"<<purchase_order_number>>\",\n    \"sales_order_number\": \"<<sales_order_number>>\",\n    \"date_shipped\": \"<<date_shipped>>\",\n    \"shipping_carrier\": \"<<shipping_carrier>>\",\n    \"shipping_method\": \"<<shipping_method>>\",\n    \"tracking_number\": \"<<tracking_number>>\",\n    \"customer_number\": \"<<customer_number>>\",\n    \"supplier_number\": \"<<supplier_number>>\",\n    \"date_delivered\": \"<<date_delivered>>\",\n    \"received_date\": \"<<received_date>>\"\n  },\n  \"parties\": {\n    \"customer\": {\n      \"customer_name\": \"<<customer_name>>\",\n      \"customer_address\": \"<<customer_address>>\",\n      \"consignee_name_and_address\": \"<<consignee_name_and_address>>\"\n    },\n    \"supplier\": {\n      \"supplier_name\": \"<<supplier_name>>\",\n      \"supplier_address\": \"<<supplier_address>>\",\n      \"shipper_name_and_address\": \"<<shipper_name_and_address>>\"\n    }\n  },\n  \"line_items\": [\n    {\n      \"product_description\": \"<<product_description>>\",\n      \"product_code\": \"<<product_code>>\",\n      \"unit_of_measurement\": \"<<unit_of_measurement>>\",\n      \"item_quantity\": \"<<item_quantity>>\",\n      \"item_price\": \"<<item_price>>\",\n      \"line_item_amount\": \"<<line_item_amount>>\"\n    }\n  ],\n  \"logistics\": {\n    \"bill_of_lading_number\": \"<<bill_of_lading_number>>\",\n    \"packaging_details\": \"<<packaging_details>>\",\n    \"insurance_details\": \"<<insurance_details>>\",\n    \"customs_information\": \"<<customs_information>>\",\n    \"proof_of_delivery\": \"<<proof_of_delivery>>\",\n    \"shipping_or_delivery_terms\": \"<<shipping_or_delivery_terms>>\"\n  },\n  \"signatures\": {\n    \"prepared_by\": \"<<prepared_by>>\",\n    \"carrier_signature\": \"<<carrier_signature>>\",\n    \"received_by\": \"<<received_by>>\"\n  }\n}",
              "type": "string"
            },
            {
              "id": "eccee5da-3b59-4a05-962c-551f42e9a543",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4920,
        13220
      ],
      "id": "4f54193f-15bc-4e3d-8deb-8679816fa99f",
      "name": "Shipping Document (Sending)1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"branding\": {\n    \"logo_url\": \"<<logo_url>>\",\n    \"font_family\": \"<<font_family>>\",\n    \"document_style\": \"<<document_style>>\"\n  },\n  \"colors\": {\n    \"primary_color\": \"<<primary_color>>\",\n    \"secondary_color\": \"<<secondary_color>>\"\n  },\n  \"company_info\": {\n    \"company_name\": \"<<company_name>>\",\n    \"company_address\": \"<<company_address>>\",\n    \"company_phone\": \"<<company_phone>>\",\n    \"company_email\": \"<<company_email>>\"\n  },\n  \"document_info\": {\n    \"shipping_document_number\": \"<<shipping_document_number>>\",\n    \"shipping_doc_date\": \"<<shipping_doc_date>>\",\n    \"purchase_order_number\": \"<<purchase_order_number>>\",\n    \"sales_order_number\": \"<<sales_order_number>>\",\n    \"shipping_carrier\": \"<<shipping_carrier>>\",\n    \"shipping_method\": \"<<shipping_method>>\",\n    \"tracking_number\": \"<<tracking_number>>\",\n    \"date_shipped\": \"<<date_shipped>>\",\n    \"date_delivered\": \"<<date_delivered>>\",\n    \"received_date\": \"<<received_date>>\",\n    \"proof_of_delivery\": \"<<proof_of_delivery>>\",\n    \"bill_of_lading_number\": \"<<bill_of_lading_number>>\",\n    \"customer_number\": \"<<customer_number>>\",\n    \"supplier_number\": \"<<supplier_number>>\"\n  },\n  \"parties\": {\n    \"customer_name\": \"<<customer_name>>\",\n    \"customer_address\": \"<<customer_address>>\",\n    \"consignee_name_and_address\": \"<<consignee_name_and_address>>\",\n    \"supplier_name\": \"<<supplier_name>>\",\n    \"supplier_address\": \"<<supplier_address>>\",\n    \"shipper_name_and_address\": \"<<shipper_name_and_address>>\"\n  },\n  \"receiving_items\": [\n    {\n      \"product_description\": \"<<product_description>>\",\n      \"product_code\": \"<<product_code>>\",\n      \"unit_of_measurement\": \"<<unit_of_measurement>>\",\n      \"qty_shipped\": \"<<qty_shipped>>\",\n      \"qty_received\": \"<<qty_received>>\",\n      \"damaged_qty\": \"<<damaged_qty>>\",\n      \"short_over\": \"<<short_over>>\",\n      \"remarks\": \"<<remarks>>\"\n    }\n  ],\n  \"receiving_amounts\": [\n    {\n      \"currency\": \"<<currency>>\",\n      \"unit_price\": \"<<unit_price>>\",\n      \"line_amount\": \"<<line_amount>>\",\n      \"pricing_notes\": \"<<pricing_notes>>\"\n    }\n  ],\n  \"additional_info\": {\n    \"packaging_details\": \"<<packaging_details>>\",\n    \"insurance_details\": \"<<insurance_details>>\",\n    \"customs_information\": \"<<customs_information>>\",\n    \"shipping_or_delivery_terms\": \"<<shipping_or_delivery_terms>>\",\n    \"receiving_inspection_status\": \"<<receiving_inspection_status>>\",\n    \"receiving_discrepancy_summary\": \"<<receiving_discrepancy_summary>>\",\n    \"receiving_condition_notes\": \"<<receiving_condition_notes>>\",\n    \"receiving_additional_notes\": \"<<receiving_additional_notes>>\"\n  },\n  \"signatures\": {\n    \"received_by\": \"<<received_by>>\",\n    \"inspected_by\": \"<<inspected_by>>\",\n    \"carrier_signature\": \"<<carrier_signature>>\"\n  }\n}",
              "type": "string"
            },
            {
              "id": "1ce2eeb7-6c01-47e2-a216-c11feb020951",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4920,
        13540
      ],
      "id": "6ea3f52d-a486-4437-8ce4-0d6f8ce532f7",
      "name": "Shipping Document (Receiving)1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7668adf6-3027-4ba8-9c86-6b7077814236",
              "name": "column",
              "value": "={{ $json.column }}",
              "type": "string"
            },
            {
              "id": "82f6813f-0a51-47a5-9477-b7f112be74c5",
              "name": "value",
              "value": "={{ $json.value }}",
              "type": "object"
            },
            {
              "id": "9858b188-50e8-47a1-8fac-858f6f2e8a53",
              "name": "companyProfile",
              "value": "={{ $json.companyProfile }}",
              "type": "object"
            },
            {
              "id": "c0c77da2-eccf-4a4c-b18e-476577b3ed73",
              "name": "template_json",
              "value": "={\n  \"branding\": {\n    \"logo_url\": \"<<logo_url>>\",\n    \"font_family\": \"<<font_family>>\",\n    \"document_style\": \"<<document_style>>\"\n  },\n  \"colors\": {\n    \"primary_color\": \"<<primary_color>>\",\n    \"secondary_color\": \"<<secondary_color>>\"\n  },\n  \"company\": {\n    \"company_name\": \"<<company_name>>\",\n    \"company_address\": \"<<company_address>>\",\n    \"company_phone\": \"<<company_phone>>\",\n    \"company_email\": \"<<company_email>>\"\n  },\n  \"purchase_order\": {\n    \"purchase_order_number\": \"<<purchase_order_number>>\",\n    \"purchase_order_date\": \"<<purchase_order_date>>\",\n    \"sales_order_number\": \"<<sales_order_number>>\",\n    \"sales_order_date\": \"<<sales_order_date>>\",\n    \"delivery_date\": \"<<delivery_date>>\",\n    \"currency_unit\": \"<<currency_unit>>\",\n    \"supplier_number\": \"<<supplier_number>>\",\n    \"customer_number\": \"<<customer_number>>\",\n    \"shipping_terms\": \"<<shipping_terms>>\",\n    \"payment_terms\": \"<<payment_terms>>\"\n  },\n  \"supplier\": {\n    \"supplier_name\": \"<<supplier_name>>\",\n    \"supplier_address\": \"<<supplier_address>>\"\n  },\n  \"customer\": {\n    \"customer_name\": \"<<customer_name>>\",\n    \"customer_address\": \"<<customer_address>>\"\n  },\n  \"items\": [\n    {\n      \"description\": \"<<item_description>>\",\n      \"quantity\": \"<<quantity>>\",\n      \"unit_of_measure\": \"<<unit_of_measure>>\",\n      \"unit_price\": \"<<unit_price>>\",\n      \"line_total\": \"<<line_total>>\",\n      \"product_code\": \"<<product_code>>\"\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": \"<<subtotal>>\",\n    \"tax\": \"<<tax>>\",\n    \"freight_charges\": \"<<freight_charges>>\",\n    \"discount\": \"<<discount>>\",\n    \"total_value\": \"<<total_value>>\"\n  },\n  \"terms_conditions\": \"<<terms_conditions>>\",\n  \"signatures\": {\n    \"supplier_signatory_name\": \"<<supplier_signatory_name>>\",\n    \"supplier_sign_date\": \"<<supplier_sign_date>>\",\n    \"customer_signatory_name\": \"<<customer_signatory_name>>\",\n    \"customer_sign_date\": \"<<customer_sign_date>>\"\n  }\n}",
              "type": "string"
            },
            {
              "id": "d95f3151-b525-4d31-906e-b0594c8421e1",
              "name": "runindex",
              "value": "={{ $json.runindex }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4920,
        13800
      ],
      "id": "c823b217-e996-4987-bd83-994e150aae83",
      "name": "Order Document1"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Edit Fields18').first().json.fileid }}",
            "files": "={{ $json.data[1] }}",
            "doc_type": "pdf",
            "cleanpdffiles": "={{ $json.data[0] }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_simulation_id",
              "displayName": "project_simulation_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "simulation_run_id",
              "displayName": "simulation_run_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "file_name",
              "displayName": "file_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "document_data",
              "displayName": "document_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "doc_type",
              "displayName": "doc_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "files",
              "displayName": "files",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cleanpdffiles",
              "displayName": "cleanpdffiles",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cleansimulation",
              "displayName": "cleansimulation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -6360,
        12340
      ],
      "id": "e65bf8f3-47c1-4dd4-930a-34cf73fc4a89",
      "name": "Update rows in a table1",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "document_data",
              "condition": "IS NOT NULL"
            },
            {
              "column": "id",
              "value": "={{ $('Edit Fields31').first().json.fileid }}"
            }
          ]
        },
        "sort": {
          "values": [
            {
              "column": "id",
              "direction": "DESC"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8680,
        12480
      ],
      "id": "b8672b38-211f-48d9-989c-b60039a4cf24",
      "name": "Initial1",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "destinationKey": "=data",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -6800,
        12340
      ],
      "id": "5746ee0e-8468-4aa7-8bed-425634bc114f",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "20eb691c-d5f4-4270-8dbb-4652177bc419",
              "name": "fileid",
              "value": "={{ $json.project_simulation_id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -10480,
        12580
      ],
      "id": "ffd45067-e7fd-4bc9-a881-586fccfcef69",
      "name": "Edit Fields18"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "simulation_documents",
          "mode": "list",
          "cachedResultName": "simulation_documents"
        },
        "limit": 10,
        "where": {
          "values": [
            {
              "column": "project_simulation_id",
              "value": "={{ $json.fileid }}"
            }
          ]
        },
        "options": {
          "outputColumns": [
            "files",
            "cleanpdffiles",
            "file_name"
          ]
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -9760,
        12460
      ],
      "id": "673a068c-644f-4956-a54c-db1eda2ff54e",
      "name": "Select rows from a table6",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "03ce2801-589f-46d4-93b7-09dcce417d46",
              "leftValue": "={{ $json.files }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "d2c6b351-7769-4a81-ab16-9b535b06ae33",
              "leftValue": "={{ $json.cleanpdffiles }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -9540,
        12460
      ],
      "id": "cd0a8797-71f6-4398-bb7a-67b529c3b19e",
      "name": "If5"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "files",
        "options": {
          "fileName": "={{ $json.file_name+'.zip' }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -8760,
        11940
      ],
      "id": "cfd7cb7b-be15-44b0-ac22-e24dac044620",
      "name": "Convert to File25"
    },
    {
      "parameters": {
        "respondWith": "binary",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -6440,
        11980
      ],
      "id": "b6d0ee00-4799-4376-a9f9-62e07983aceb",
      "name": "Respond to Webhook7"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "ALTER TABLE project_simulations\nDROP COLUMN cleansimulation;\n\nALTER TABLE project_simulations\nADD COLUMN cleansimulation JSONB;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -10280,
        11800
      ],
      "id": "d11808ea-aee8-409d-8e13-3848d8da6b0b",
      "name": "Execute a SQL query2",
      "credentials": {
        "postgres": {
          "id": "XqeBwODpiMWjJGxP",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=The json file is Bank Statement. Verify Deposit Total and withdrawl total calculations. Modify and add new results. Dont change any data other than totals and calculations. Dont change json format, only modify values.\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json. \n\nReverify there are no errors\n\njson is :\n{{ $json.output }}\n\n",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Do not add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4280,
        11400
      ],
      "id": "0028659c-0ca8-494c-bec7-b3397c8229c9",
      "name": "AI Agent35"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4360,
        11560
      ],
      "id": "036866a8-714d-45aa-ab81-6fbe122a8c23",
      "name": "Google Gemini Chat Model10",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4260,
        11720
      ],
      "id": "6b292bef-54ad-4f8a-9706-cb8a1019b9e6",
      "name": "AI Agent36"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4320,
        11920
      ],
      "id": "4a2a02ac-bd81-49ae-9c27-ecb28f030292",
      "name": "Google Gemini Chat Model11",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4280,
        12660
      ],
      "id": "46bb1937-e00b-4dcb-829b-c5c8d7bc54ee",
      "name": "AI Agent37"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4340,
        12860
      ],
      "id": "7195320e-a708-4967-82d7-d56497bf7c69",
      "name": "Google Gemini Chat Model12",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4260,
        12040
      ],
      "id": "f34034cd-aeb3-4d40-b8b4-2600d7ef4d5a",
      "name": "AI Agent38"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4340,
        12200
      ],
      "id": "96795d26-3644-4a01-8c0a-e28155780bda",
      "name": "Google Gemini Chat Model13",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4240,
        12340
      ],
      "id": "96f8fd17-a1df-4a86-8f91-7e928efa11e2",
      "name": "AI Agent39"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4320,
        12500
      ],
      "id": "d9abf1d9-a2fd-49d8-8d62-a53d561170da",
      "name": "Google Gemini Chat Model14",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4280,
        12980
      ],
      "id": "5edaa733-b595-463b-b3c6-8e398b9b6d5d",
      "name": "AI Agent40"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4360,
        13140
      ],
      "id": "8576ba96-6bbe-4dc5-92db-f211d02e7176",
      "name": "Google Gemini Chat Model15",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4220,
        13220
      ],
      "id": "79c6f075-2598-4f70-a91c-13679aff7af6",
      "name": "AI Agent41"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4300,
        13380
      ],
      "id": "9f644bf2-526f-4458-a5d4-a0d69c646dee",
      "name": "Google Gemini Chat Model16",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4280,
        13540
      ],
      "id": "382632b3-93a0-47aa-8b53-e3d787ded469",
      "name": "AI Agent42"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4360,
        13700
      ],
      "id": "298efb63-4df8-4bfb-9a7c-f6d4e404e837",
      "name": "Google Gemini Chat Model17",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add calcuation if wrong. Dont change anything else or modify structure\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4260,
        13800
      ],
      "id": "4a736690-135d-4de4-b06f-d13efeb7e1b7",
      "name": "AI Agent43"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4340,
        13960
      ],
      "id": "40cead79-9ab2-49d9-93c0-ec7af1943ac1",
      "name": "Google Gemini Chat Model18",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Verify all calcuation  and totals.  Modify and add new results. Dont change anything else\n\nThe output needs to be only json and no other data. Dont add any ticks or json or ```json\n\njson is :\n{{ $json.output }}",
        "options": {
          "systemMessage": "The output needs to be only json and no other data. Dont add any ticks or json or ```json.  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -4360,
        11040
      ],
      "id": "1f70a65f-3de7-451a-bf5a-7bfe39435f97",
      "name": "AI Agent44",
      "disabled": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4440,
        11200
      ],
      "id": "f75d09b2-32c0-48cc-ba2a-e56f85c6351a",
      "name": "Google Gemini Chat Model19",
      "credentials": {
        "googlePalmApi": {
          "id": "c28F1j8I35UhbEla",
          "name": "Marisa:Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Bank Statement Generator</title>\n</head>\n<body>\n  <div id=\"statement-container\"></div>\n\n  <script>\n    // JSON DATA VARIABLE - Replace this with your actual data\n    const STATEMENT_DATA = {{ $json.formattedResponse.toJsonString() }};\n\n    // Function to generate transaction rows\n    function generateTransactionRows(transactions) {\n      return transactions.map(transaction => {\n        const debitClass = transaction.is_debit ? ' withdrawal' : '';\n        const creditClass = transaction.is_credit ? ' deposit' : '';\n        const debitAmount = transaction.is_debit ? transaction.debit_amount : '';\n        const creditAmount = transaction.is_credit ? transaction.credit_amount : '';\n        \n        return `\n        <tr>\n          <td>${transaction.date}</td>\n          <td>${transaction.transaction_number}</td>\n          <td>${transaction.description}</td>\n          <td class=\"amount${debitClass}\">${debitAmount}</td>\n          <td class=\"amount${creditClass}\">${creditAmount}</td>\n          <td class=\"amount\">${transaction.fees}</td>\n          <td class=\"amount\">${transaction.interest}</td>\n          <td class=\"amount balance\">${transaction.balance}</td>\n        </tr>`;\n      }).join('');\n    }\n\n    // Function to generate complete HTML\n    function generateBankStatement(data) {\n      const transactionRows = generateTransactionRows(data.transactions);\n      \n      return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>${data.document_title}</title>\n  <style>\n    :root{\n      --background: ${data.theme.background};\n      --text: ${data.theme.text};\n      --primary: ${data.theme.primary};\n      --border: ${data.theme.border};\n      --muted: ${data.theme.muted};\n      --header-text: ${data.theme.header_text};\n      --table-head: ${data.theme.table_head};\n      --table-head-text: ${data.theme.table_head_text};\n      --row-alt: ${data.theme.row_alt};\n      --statement-bg: ${data.theme.statement_bg};\n      --account-info-bg: ${data.theme.account_info_bg};\n      --withdrawal: ${data.theme.withdrawal};\n      --deposit: ${data.theme.deposit};\n      --balance: ${data.theme.balance};\n      --footer-text: ${data.theme.footer_text};\n      --logo-bg: ${data.theme.logo_bg};\n    }\n\n    body{ font-family: Arial, sans-serif; max-width: 900px; margin:0 auto; padding:20px; background:var(--background); color:var(--text); }\n    .statement{ background:var(--statement-bg); padding:30px; border:1px solid var(--border); box-shadow:0 2px 5px rgba(0,0,0,.1); }\n\n    .header{ display:flex; align-items:center; margin-bottom:24px; border-bottom:2px solid var(--primary); padding-bottom:16px; }\n    .logo{ width: ${data.bank.logo.width}px; height: ${data.bank.logo.height}px; background:var(--logo-bg); border-radius:6px; margin-right:16px; display:flex; align-items:center; justify-content:center; color:${data.bank.logo.text_color}; font-weight:bold;\n      background-image:url('${data.bank.logo.url}'); background-size:cover; background-position:center; }\n    .bank-info h1{ margin:0; font-size:24px; color:var(--header-text); }\n    .bank-info p{ margin:6px 0 0; color:var(--muted); font-size:13px; }\n\n    .account-info{ display:flex; justify-content:space-between; gap:16px; margin:18px 0; background:var(--account-info-bg); padding:14px; border-radius:6px; }\n    .account-details h3{ margin:0 0 8px; color:var(--header-text);}\n    .account-details p{ margin:4px 0; }\n    .statement-period{ text-align:right; font-size:14px; }\n    .statement-period p{ margin:4px 0; }\n\n    .summary{ display:grid; grid-template-columns: repeat(2,1fr); gap:12px; border:1px solid var(--border); border-radius:6px; padding:12px; margin:18px 0 6px; }\n    .summary h4{ grid-column:1/-1; margin:0 0 8px; color:var(--header-text);}\n    .kv{ display:flex; justify-content:space-between; border-bottom:1px dashed var(--border); padding:6px 0; }\n    .kv:last-child{ border-bottom:none; }\n\n    .transactions-table{ width:100%; border-collapse:collapse; margin:18px 0; font-size:14px; }\n    .transactions-table th{ background:var(--table-head); color:var(--table-head-text); border:1px solid var(--border); padding:10px; text-align:left; }\n    .transactions-table td{ border:1px solid var(--border); padding:10px; vertical-align:top; }\n    .transactions-table tr:nth-child(even){ background:var(--row-alt); }\n    .amount{ text-align:right; font-family:monospace; }\n    .withdrawal{ color:var(--withdrawal); }\n    .deposit{ color:var(--deposit); }\n    .balance{ font-weight:bold; color:var(--balance); }\n\n    .notes{ margin-top:16px; padding:12px; border:1px solid var(--border); border-radius:6px; }\n    .notes h4{ margin:0 0 8px; color:var(--header-text); }\n\n    .footer{ margin-top:24px; padding-top:12px; border-top:1px solid var(--border); color:var(--footer-text); font-size:12px; }\n  </style>\n</head>\n<body>\n  <div class=\"statement\">\n\n    <!-- HEADER -->\n    <div class=\"header\">\n      <div class=\"logo\">${data.bank.logo.text}</div>\n      <div class=\"bank-info\">\n        <h1>${data.bank.name}</h1>\n        <p>${data.bank.address}</p>\n      </div>\n    </div>\n\n    <!-- ACCOUNT + PERIOD -->\n    <div class=\"account-info\">\n      <div class=\"account-details\">\n        <h3>${data.account.name}</h3>\n        <p>${data.account.address}</p>\n        <p><strong>Account Number:</strong> ${data.account.number}</p>\n        <p><strong>Account Type:</strong> ${data.account.type}</p>\n      </div>\n      <div class=\"statement-period\">\n        <p><strong>Statement Period:</strong></p>\n        <p><strong>${data.statement_period.from} through ${data.statement_period.to}</strong></p>\n      </div>\n    </div>\n\n    <!-- SUMMARY -->\n    <div class=\"summary\">\n      <h4>Statement Summary</h4>\n      <div class=\"kv\"><span>Opening / Beginning / Previous Balance</span><span class=\"amount\">${data.summary.opening_balance}</span></div>\n      <div class=\"kv\"><span>Closing / Ending Balance</span><span class=\"amount balance\">${data.summary.closing_balance}</span></div>\n      <div class=\"kv\"><span>Deposit / Credit Totals</span><span class=\"amount deposit\">${data.summary.deposit_totals}</span></div>\n      <div class=\"kv\"><span>Withdrawal / Debit Totals</span><span class=\"amount withdrawal\">${data.summary.withdrawal_totals}</span></div>\n      <div class=\"kv\"><span>Fees Charged (Total)</span><span class=\"amount\">${data.summary.fees_total}</span></div>\n      <div class=\"kv\"><span>Interest Earned (Total)</span><span class=\"amount\">${data.summary.interest_earned}</span></div>\n      <div class=\"kv\"><span>Interest Paid (Total)</span><span class=\"amount\">${data.summary.interest_paid}</span></div>\n    </div>\n\n    <!-- TRANSACTIONS -->\n    <table class=\"transactions-table\">\n      <thead>\n        <tr>\n          <th>Date</th>\n          <th>Transaction No.</th>\n          <th>Description</th>\n          <th>Debit</th>\n          <th>Credit</th>\n          <th>Fees</th>\n          <th>Interest</th>\n          <th>Balance</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${transactionRows}\n      </tbody>\n    </table>\n\n    <!-- NOTES -->\n    <div class=\"notes\">\n      <h4>Account Alerts</h4>\n      <p>${data.notes.alerts}</p>\n      <h4>Account Closure Details</h4>\n      <p>${data.notes.closure_details}</p>\n    </div>\n\n    <div class=\"footer\">\n      <p>${data.footer_text}</p>\n    </div>\n  </div>\n</body>\n</html>`;\n    }\n\n    // Generate and display the bank statement\n    function renderStatement() {\n      const container = document.getElementById('statement-container');\n      const generatedHTML = generateBankStatement(STATEMENT_DATA);\n      \n      // Replace current document with generated HTML\n      document.open();\n      document.write(generatedHTML);\n      document.close();\n    }\n\n    // Generate statement when page loads\n    document.addEventListener('DOMContentLoaded', renderStatement);\n\n    // Also provide functions for external use\n    window.generateBankStatementHTML = generateBankStatement;\n    window.downloadStatement = function() {\n      const html = generateBankStatement(STATEMENT_DATA);\n      const blob = new Blob([html], { type: 'text/html' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'bank_statement.html';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3700,
        11400
      ],
      "id": "7fbf9666-1b1d-4f5f-a46d-224ce41c1c80",
      "name": "Edit Fields19"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Bank_statement_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3480,
        11400
      ],
      "id": "bb9503e0-7949-4635-9cd1-9e4d83f3cf74",
      "name": "Convert to File3"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3900,
        11400
      ],
      "id": "b986218a-3c2e-4564-b47b-c9be30b7c4c2",
      "name": "Code12",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Wire Transfer</title>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      max-width: 1000px;\n      margin: 0 auto;\n      padding: 20px;\n      background-color: #f9fafb;\n      color: #1e293b;\n    }\n    .wire-transfer {\n      background: #ffffff;\n      border: 1px solid #cbd5e1;\n      padding: 30px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n      border-radius: 8px;\n    }\n    .header {\n      display: flex;\n      align-items: center;\n      margin-bottom: 30px;\n      border-bottom: 2px solid #334155;\n      padding-bottom: 20px;\n      gap: 15px;\n    }\n    .logo {\n      width: 80px;\n      height: 40px;\n      background: #f1f5f9;\n      border-radius: 5px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: #334155;\n      font-weight: bold;\n      background-size: cover;\n      background-position: center;\n      flex: 0 0 auto;\n    }\n    .bank-info h1 {\n      margin: 0;\n      font-size: 24px;\n      color: #0f172a;\n    }\n    .bank-info p {\n      margin: 5px 0 0 0;\n      color: #64748b;\n      font-size: 14px;\n    }\n    .transfer-title {\n      text-align: center;\n      background: #334155;\n      color: #ffffff;\n      padding: 15px;\n      margin: 20px 0;\n      border-radius: 5px;\n      font-size: 22px;\n      font-weight: bold;\n      letter-spacing: 1px;\n    }\n\n    .parties {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 16px;\n      margin: 20px 0;\n    }\n    .panel {\n      background: #f8fafc;\n      padding: 16px;\n      border-radius: 8px;\n      border: 1px solid #e2e8f0;\n    }\n    .panel h3 {\n      margin: 0 0 12px 0;\n      color: #0f172a;\n      font-size: 16px;\n    }\n    .row {\n      display: flex;\n      justify-content: space-between;\n      gap: 16px;\n      padding: 6px 0;\n      border-bottom: 1px dotted #e2e8f0;\n    }\n    .row:last-child { border-bottom: none; }\n    .label { font-weight: bold; color: #374151; }\n    .value { color: #1f2937; font-family: monospace; }\n\n    .transfer-details {\n      background: #f8fafc;\n      padding: 20px;\n      border-radius: 8px;\n      margin: 20px 0;\n      border-left: 4px solid #3b82f6;\n    }\n    .transfer-details h3 {\n      margin: 0 0 12px 0;\n      color: #0f172a;\n    }\n    .detail-row {\n      display: grid;\n      grid-template-columns: 240px 1fr;\n      gap: 16px;\n      margin: 10px 0;\n      padding: 8px 0;\n      border-bottom: 1px dotted #e2e8f0;\n    }\n    .detail-row:last-child { border-bottom: none; }\n\n    .transaction-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 20px 0;\n    }\n    .transaction-table th {\n      background: #f1f5f9;\n      border: 1px solid #d1d5db;\n      padding: 12px;\n      text-align: left;\n      font-weight: bold;\n      color: #374151;\n    }\n    .transaction-table td {\n      border: 1px solid #d1d5db;\n      padding: 12px;\n      color: #1f2937;\n    }\n    .transaction-table tr:nth-child(even) {\n      background: #f9fafb;\n    }\n    .amount {\n      text-align: right;\n      font-family: monospace;\n      font-weight: bold;\n      color: #059669;\n    }\n    .amount.withdrawal { color: #dc2626; }\n    .balance { color: #1d4ed8; font-weight: bold; }\n\n    .confirmation {\n      background: #ecfdf5;\n      padding: 20px;\n      border-radius: 8px;\n      margin: 30px 0;\n      text-align: center;\n      border: 2px solid #10b981;\n    }\n    .confirmation h3 {\n      margin: 0 0 10px 0;\n      color: #065f46;\n    }\n    .confirmation-number {\n      font-size: 18px;\n      font-weight: bold;\n      color: #047857;\n      font-family: monospace;\n      background: #ffffff;\n      padding: 10px;\n      border-radius: 4px;\n      display: inline-block;\n      margin: 10px 0;\n    }\n\n    .footer {\n      margin-top: 30px;\n      padding-top: 15px;\n      border-top: 1px solid #e5e7eb;\n      color: #6b7280;\n      font-size: 12px;\n      text-align: center;\n    }\n\n    @media print {\n      body { max-width: none; background-color: white; }\n      .wire-transfer { box-shadow: none; }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wire-transfer\">\n    <div class=\"header\">\n      <div class=\"logo\" id=\"logo\"></div>\n      <div class=\"bank-info\">\n        <h1 id=\"bank_name\"></h1>\n        <p id=\"bank_address\"></p>\n      </div>\n    </div>\n\n    <div class=\"transfer-title\">\n      WIRE TRANSFER CONFIRMATION\n    </div>\n\n    <div class=\"parties\">\n      <div class=\"panel\">\n        <h3>Requestor</h3>\n        <div class=\"row\"><span class=\"label\">Name</span><span class=\"value\" id=\"requestor\"></span></div>\n        <div class=\"row\"><span class=\"label\">Account Number</span><span class=\"value\" id=\"requestor_account_number\"></span></div>\n        <div class=\"row\"><span class=\"label\">Routing Number</span><span class=\"value\" id=\"requestor_routing_number\"></span></div>\n        <div class=\"row\"><span class=\"label\">Bank Name</span><span class=\"value\" id=\"requestor_bank_name\"></span></div>\n        <div class=\"row\"><span class=\"label\">Address</span><span class=\"value\" id=\"requestor_address\"></span></div>\n      </div>\n\n      <div class=\"panel\">\n        <h3>Recipient</h3>\n        <div class=\"row\"><span class=\"label\">Name</span><span class=\"value\" id=\"recipient\"></span></div>\n        <div class=\"row\"><span class=\"label\">Account Number</span><span class=\"value\" id=\"recipient_account_number\"></span></div>\n        <div class=\"row\"><span class=\"label\">Routing Number</span><span class=\"value\" id=\"recipient_routing_number\"></span></div>\n        <div class=\"row\"><span class=\"label\">Bank Name</span><span class=\"value\" id=\"recipient_bank_name\"></span></div>\n        <div class=\"row\"><span class=\"label\">Address</span><span class=\"value\" id=\"recipient_address\"></span></div>\n      </div>\n    </div>\n\n    <div class=\"transfer-details\">\n      <h3>Transfer Details</h3>\n      <div class=\"detail-row\">\n        <span class=\"label\">Transaction Type / Category</span>\n        <span class=\"value\" id=\"transaction_type\"></span>\n      </div>\n      <div class=\"detail-row\">\n        <span class=\"label\">Amount</span>\n        <span class=\"value amount withdrawal\" id=\"amount\"></span>\n      </div>\n      <div class=\"detail-row\">\n        <span class=\"label\">Currency</span>\n        <span class=\"value\" id=\"currency\"></span>\n      </div>\n      <div class=\"detail-row\">\n        <span class=\"label\">Wire Date</span>\n        <span class=\"value\" id=\"wire_date\"></span>\n      </div>\n      <div class=\"detail-row\">\n        <span class=\"label\">Transaction / Reference Number</span>\n        <span class=\"value\" id=\"transaction_number\"></span>\n      </div>\n      <div class=\"detail-row\">\n        <span class=\"label\">Memo / Reference</span>\n        <span class=\"value\" id=\"memo_reference\"></span>\n      </div>\n    </div>\n\n    <div class=\"confirmation\">\n      <h3>Transfer Completed Successfully</h3>\n      <p>Confirmation Number:</p>\n      <div class=\"confirmation-number\" id=\"confirmation_number\"></div>\n      <p id=\"confirmation_message\"></p>\n    </div>\n\n    <div class=\"footer\">\n      <p id=\"footer_text\"></p>\n    </div>\n  </div>\n\n  <script>\n    // Your JSON Data Variable - Replace placeholders with actual values\n    const jsonData ={{ $json.formattedResponse.toJsonString() }} ;\n\n    // Function to flatten nested JSON structure\n    function flattenData(data) {\n      const flattened = {};\n      \n      if (data.wireTransferSchema && data.wireTransferSchema.properties) {\n        const properties = data.wireTransferSchema.properties;\n        \n        // Flatten all nested objects\n        Object.keys(properties).forEach(section => {\n          if (typeof properties[section] === 'object') {\n            Object.keys(properties[section]).forEach(key => {\n              flattened[key] = properties[section][key];\n            });\n          }\n        });\n      }\n      \n      return flattened;\n    }\n\n    // Function to populate the template with JSON data\n    function populateTemplate() {\n      // Flatten the nested JSON structure\n      const flatData = flattenData(jsonData);\n      \n      // Set logo\n      const logoElement = document.getElementById('logo');\n      if (flatData.logo_url) {\n        logoElement.style.backgroundImage = `url('${flatData.logo_url}')`;\n        logoElement.textContent = '';\n      } else {\n        logoElement.textContent = flatData.logo_text || 'BANK';\n      }\n\n      // Apply dynamic styling if available\n      if (flatData.background_color) {\n        document.body.style.backgroundColor = flatData.background_color;\n      }\n      if (flatData.transfer_background) {\n        document.querySelector('.wire-transfer').style.backgroundColor = flatData.transfer_background;\n      }\n\n      // Populate all other fields\n      Object.keys(flatData).forEach(key => {\n        const element = document.getElementById(key);\n        if (element) {\n          if (key === 'amount' || key === 'withdrawal_amount' || key === 'account_balance') {\n            element.textContent = flatData[key] ? `${flatData[key]}` : '';\n          } else if (key === 'deposit_amount') {\n            element.textContent = flatData[key] ? `${flatData[key]}` : '';\n          } else {\n            element.textContent = flatData[key] || '';\n          }\n        }\n      });\n    }\n\n    // Populate the template when page loads\n    document.addEventListener('DOMContentLoaded', populateTemplate);\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3760,
        11040
      ],
      "id": "086046ff-0131-44a7-8982-c54b45c08810",
      "name": "Edit Fields20"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Wire_Transfer_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3540,
        11040
      ],
      "id": "9d9c5487-2c7c-45f4-bc07-66112952e1bf",
      "name": "Convert to File16"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3960,
        11040
      ],
      "id": "e7ac6be6-a961-4251-a2f4-b663fdc388e0",
      "name": "Code14",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Invoice (Goods)</title>\n  <style>\n    body { \n      font-family: Arial, sans-serif; \n      max-width: 800px; \n      margin: 0 auto; \n      padding: 20px; \n      background: #ffffff;\n      color: #333;\n      line-height: 1.4;\n    }\n    @media print {\n      body { background: white; }\n    }\n    .document-header { \n      text-align: center; \n      font-size: 28px; \n      font-weight: bold; \n      margin-bottom: 30px; \n      color: #2c3e50;\n      text-transform: uppercase;\n    }\n    .logo { \n      max-height: 80px; \n      display: block; \n      margin: 0 auto 30px auto;\n      object-fit: contain;\n    }\n    .company-info { \n      margin-bottom: 25px; \n      padding: 15px;\n      background: #f8f9fa;\n      border-left: 4px solid #3498db;\n    }\n    .company-info h2 {\n      margin: 0 0 10px 0;\n      color: #2c3e50;\n      font-size: 22px;\n    }\n    .company-info p {\n      margin: 5px 0;\n      color: #555;\n    }\n    .meta-grid { \n      display: grid; \n      grid-template-columns: 1fr 1fr; \n      gap: 20px; \n      margin-bottom: 25px; \n      background: #f8f9fa;\n      padding: 20px;\n      border-radius: 5px;\n    }\n    .meta-section h3 {\n      margin: 0 0 15px 0;\n      color: #2c3e50;\n      border-bottom: 2px solid #3498db;\n      padding-bottom: 5px;\n    }\n    .meta-section p {\n      margin: 8px 0;\n      display: flex;\n      justify-content: space-between;\n    }\n    .meta-section strong {\n      color: #2c3e50;\n      min-width: 140px;\n    }\n    .customer-section {\n      margin-bottom: 25px;\n      padding: 15px;\n      background: #f8f9fa;\n      border-left: 4px solid #e74c3c;\n    }\n    .customer-section h3 {\n      margin: 0 0 15px 0;\n      color: #2c3e50;\n    }\n    .items-table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-bottom: 25px; \n      box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n    }\n    .items-table th, .items-table td { \n      border: 1px solid #ddd; \n      padding: 12px; \n      text-align: left; \n    }\n    .items-table th { \n      background: #34495e; \n      color: white;\n      font-weight: bold;\n      text-transform: uppercase;\n      font-size: 12px;\n    }\n    .items-table tr:nth-child(even) {\n      background: #f8f9fa;\n    }\n    .items-table tr:hover {\n      background: #e8f4fd;\n    }\n    .total-section { \n      text-align: right; \n      margin-top: 30px;\n      padding: 20px;\n      background: #f8f9fa;\n      border-radius: 5px;\n    }\n    .total-section p {\n      margin: 8px 0;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .total-section strong {\n      color: #2c3e50;\n      min-width: 150px;\n      text-align: left;\n    }\n    .final-total { \n      font-size: 20px; \n      font-weight: bold; \n      margin-top: 15px;\n      padding-top: 15px;\n      border-top: 2px solid #3498db;\n      color: #2c3e50;\n    }\n    .currency {\n      font-weight: bold;\n      color: #27ae60;\n    }\n    .notes-section {\n      margin-top: 30px;\n      padding: 15px;\n      background: #fff3cd;\n      border-left: 4px solid #ffc107;\n    }\n    .notes-section h4 {\n      margin: 0 0 10px 0;\n      color: #856404;\n    }\n    /* Specific styles for different document types */\n    .statement-entry {\n      display: flex;\n      justify-content: space-between;\n      padding: 8px 0;\n      border-bottom: 1px solid #eee;\n    }\n    .statement-date {\n      font-weight: bold;\n      color: #2c3e50;\n    }\n    .statement-amount {\n      font-weight: bold;\n    }\n    .statement-amount.positive {\n      color: #27ae60;\n    }\n    .statement-amount.negative {\n      color: #e74c3c;\n    }\n  </style>\n</head>\n<body>\n  <!-- Logo placeholder -->\n  <img src=\"\" alt=\"Company Logo\" class=\"logo\" id=\"company_logo\" style=\"display: none;\" />\n  \n  <div class=\"document\">\n    <div class=\"document-header\" id=\"document_header\">INVOICE (GOODS)</div>\n\n    <!-- Company/Supplier Info -->\n    <div class=\"company-info\" id=\"company_section\">\n      <h2 id=\"company_name\"></h2>\n      <p id=\"company_address\"></p>\n      <p id=\"company_contact\"></p>\n      <p id=\"company_details\"></p>\n    </div>\n\n    <!-- Document Meta Information -->\n    <div class=\"meta-grid\" id=\"meta_section\">\n      <div class=\"meta-section\">\n        <h3>Document Details</h3>\n        <div id=\"document_meta\"></div>\n      </div>\n      <div class=\"meta-section\">\n        <h3>Additional Information</h3>\n        <div id=\"additional_meta\"></div>\n      </div>\n    </div>\n\n    <!-- Recipient/Customer Info -->\n    <div class=\"customer-section\" id=\"recipient_section\">\n      <h3 id=\"recipient_label\">Recipient:</h3>\n      <div id=\"recipient_details\"></div>\n    </div>\n\n    <!-- Items/Transactions Table -->\n    <table class=\"items-table\" id=\"items_table\" style=\"display: none;\">\n      <thead id=\"table_header\"></thead>\n      <tbody id=\"table_body\"></tbody>\n    </table>\n\n    <!-- Statement Entries (for bank statements, etc.) -->\n    <div id=\"statement_entries\" style=\"display: none;\"></div>\n\n    <!-- Totals/Summary -->\n    <div class=\"total-section\" id=\"totals_section\" style=\"display: none;\">\n      <div id=\"totals_content\"></div>\n    </div>\n\n    <!-- Notes/Additional Information -->\n    <div class=\"notes-section\" id=\"notes_section\" style=\"display: none;\">\n      <h4>Notes:</h4>\n      <div id=\"notes_content\"></div>\n    </div>\n  </div>\n\n  <script>\n    // This will be populated by your AI system\n    // Replace this entire line with: const TEMPLATE_DATA = [your JSON data];\n    const TEMPLATE_DATA = {{ $json.formattedResponse.toJsonString() }};\n    \n    function formatCurrency(amount, currency = 'USD') {\n      if (amount === null || amount === undefined || amount === '') return '';\n      \n      // Ensure amount is a number\n      const numAmount = parseFloat(amount);\n      if (isNaN(numAmount)) return amount;\n      \n      // Add dollar sign for USD or if currency is not specified\n      if (currency === 'USD' || currency === '$' || !currency) {\n        return '$' + numAmount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 });\n      }\n      \n      return currency + ' ' + numAmount.toLocaleString();\n    }\n    \n    function formatDate(dateStr) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      return date.toLocaleDateString('en-US');\n    }\n    \n    function populateTemplate(data) {\n      if (!data) {\n        console.error('No data provided to template');\n        return;\n      }\n      \n      // Handle nested structure - check if data has invoice/document key\n      let documentData = data;\n      if (data.invoice) {\n        documentData = data.invoice;\n      } else if (data.document) {\n        documentData = data.document;\n      } else if (data.statement) {\n        documentData = data.statement;\n      } else if (data.quote) {\n        documentData = data.quote;\n      } else if (data.purchase_order) {\n        documentData = data.purchase_order;\n      }\n      \n      // Set logo if provided\n      if (documentData.logo_url) {\n        const logo = document.getElementById('company_logo');\n        logo.src = documentData.logo_url;\n        logo.style.display = 'block';\n      }\n      \n      \n      // Populate company info\n      if (documentData.company) {\n        document.getElementById('company_name').textContent = documentData.company.name || '';\n        document.getElementById('company_address').textContent = documentData.company.address || '';\n        document.getElementById('company_contact').textContent = documentData.company.contact || '';\n        document.getElementById('company_details').textContent = documentData.company.details || '';\n      }\n      \n      // Populate document meta information\n      if (documentData.meta) {\n        const docMeta = document.getElementById('document_meta');\n        const addMeta = document.getElementById('additional_meta');\n        \n        // Clear existing content\n        docMeta.innerHTML = '';\n        addMeta.innerHTML = '';\n        \n        // Split meta fields between two columns\n        const metaKeys = Object.keys(documentData.meta);\n        const midPoint = Math.ceil(metaKeys.length / 2);\n        \n        metaKeys.slice(0, midPoint).forEach(key => {\n          const p = document.createElement('p');\n          p.innerHTML = `<strong>${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}:</strong> <span>${documentData.meta[key]}</span>`;\n          docMeta.appendChild(p);\n        });\n        \n        metaKeys.slice(midPoint).forEach(key => {\n          const p = document.createElement('p');\n          p.innerHTML = `<strong>${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}:</strong> <span>${documentData.meta[key]}</span>`;\n          addMeta.appendChild(p);\n        });\n      }\n      \n      // Populate recipient info\n      if (documentData.recipient) {\n        const recipientDetails = document.getElementById('recipient_details');\n        const recipientLabel = document.getElementById('recipient_label');\n        \n        // Clear existing content\n        recipientDetails.innerHTML = '';\n        \n        // Set appropriate label\n        recipientLabel.textContent = documentData.recipient.label || 'Recipient:';\n        \n        // Add recipient information\n        Object.entries(documentData.recipient).forEach(([key, value]) => {\n          if (key !== 'label' && value) {\n            const p = document.createElement('p');\n            if (key === 'name') {\n              p.innerHTML = `<strong>${value}</strong>`;\n            } else {\n              p.innerHTML = `<strong>${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}:</strong> ${value}`;\n            }\n            recipientDetails.appendChild(p);\n          }\n        });\n      }\n      \n      // Handle items table\n      if (documentData.items && documentData.items.length > 0) {\n        const table = document.getElementById('items_table');\n        const header = document.getElementById('table_header');\n        const body = document.getElementById('table_body');\n        \n        // Clear existing content\n        header.innerHTML = '';\n        body.innerHTML = '';\n        \n        table.style.display = 'table';\n        \n        // Create header row\n        if (documentData.items[0]) {\n          const headerRow = document.createElement('tr');\n          Object.keys(documentData.items[0]).forEach(key => {\n            const th = document.createElement('th');\n            th.textContent = key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n            headerRow.appendChild(th);\n          });\n          header.appendChild(headerRow);\n        }\n        \n        // Create data rows\n        documentData.items.forEach(item => {\n          const row = document.createElement('tr');\n          Object.entries(item).forEach(([key, value]) => {\n            const td = document.createElement('td');\n            if (key.includes('amount') || key.includes('price') || key.includes('total') || key.includes('cost')) {\n              td.innerHTML = `<span class=\"currency\">${formatCurrency(value, documentData.currency)}</span>`;\n            } else if (key.includes('date')) {\n              td.textContent = formatDate(value);\n            } else {\n              td.textContent = value || '';\n            }\n            row.appendChild(td);\n          });\n          body.appendChild(row);\n        });\n      }\n      \n      // Handle statement entries (for bank statements)\n      if (documentData.entries && documentData.entries.length > 0) {\n        const entriesContainer = document.getElementById('statement_entries');\n        entriesContainer.innerHTML = '';\n        entriesContainer.style.display = 'block';\n        \n        documentData.entries.forEach(entry => {\n          const entryDiv = document.createElement('div');\n          entryDiv.className = 'statement-entry';\n          \n          const dateSpan = document.createElement('span');\n          dateSpan.className = 'statement-date';\n          dateSpan.textContent = formatDate(entry.date);\n          \n          const descSpan = document.createElement('span');\n          descSpan.textContent = entry.description || '';\n          \n          const amountSpan = document.createElement('span');\n          amountSpan.className = `statement-amount ${parseFloat(entry.amount) >= 0 ? 'positive' : 'negative'}`;\n          amountSpan.textContent = formatCurrency(entry.amount, documentData.currency);\n          \n          entryDiv.appendChild(dateSpan);\n          entryDiv.appendChild(descSpan);\n          entryDiv.appendChild(amountSpan);\n          \n          entriesContainer.appendChild(entryDiv);\n        });\n      }\n      \n      // Handle totals\n      if (documentData.totals) {\n        const totalsSection = document.getElementById('totals_section');\n        const totalsContent = document.getElementById('totals_content');\n        \n        // Clear existing content\n        totalsContent.innerHTML = '';\n        \n        totalsSection.style.display = 'block';\n        \n        Object.entries(documentData.totals).forEach(([key, value]) => {\n          const p = document.createElement('p');\n          const isTotal = key.toLowerCase().includes('total');\n          p.className = isTotal ? 'final-total' : '';\n          \n          if (key.includes('amount') || key.includes('total') || key.includes('due') || key.includes('balance')) {\n            p.innerHTML = `<strong>${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}:</strong> <span class=\"currency\">${formatCurrency(value, documentData.currency)}</span>`;\n          } else {\n            p.innerHTML = `<strong>${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}:</strong> <span>${value}</span>`;\n          }\n          \n          totalsContent.appendChild(p);\n        });\n      }\n      \n      // Handle notes\n      if (documentData.notes) {\n        const notesSection = document.getElementById('notes_section');\n        const notesContent = document.getElementById('notes_content');\n        \n        // Clear existing content\n        notesContent.innerHTML = '';\n        \n        notesSection.style.display = 'block';\n        \n        if (Array.isArray(documentData.notes)) {\n          documentData.notes.forEach(note => {\n            if (note && note.trim()) { // Only add non-empty notes\n              const p = document.createElement('p');\n              p.textContent = note;\n              notesContent.appendChild(p);\n            }\n          });\n        } else if (documentData.notes) {\n          notesContent.textContent = documentData.notes;\n        }\n      }\n    }\n    \n    // Initialize template with data\n    if (typeof TEMPLATE_DATA !== 'undefined' && TEMPLATE_DATA !== null) {\n      populateTemplate(TEMPLATE_DATA);\n    }\n    \n    // Function to update template with new data (for external use)\n    window.updateTemplate = function(newData) {\n      populateTemplate(newData);\n    };\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3700,
        11720
      ],
      "id": "0a17428c-af90-4ef8-8ddd-482361789f6a",
      "name": "Edit Fields21"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "html",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $('Edit Fields16').item.json.companyProfile.company_name }}_Invoice_Goods_run-{{ $('Edit Fields16').item.json.runindex.toNumber() + 1}}_{{ $now.format('MMM-dd-yy')}}.html"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -3480,
        11720
      ],
      "id": "d94f52d9-e6cb-4b1f-9217-4ebe9cf2d5a5",
      "name": "Convert to File15"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3900,
        11720
      ],
      "id": "fd8d76fc-9ed6-46bf-9c1e-cdc5b2e57acf",
      "name": "Code15",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Expenses Sub-Ledger</title>\n  <style>\n    /* Force landscape on print/PDF */\n    @page { size: A4 landscape; margin: 14mm; }\n    @media print { \n      body { -webkit-print-color-adjust: exact; }\n      .items-table th { position: sticky; top: 0; }\n    }\n\n    *, *::before, *::after { box-sizing: border-box; }\n\n    :root { --gap: 18px; }\n\n    body {\n      font-family: Arial, sans-serif;\n      max-width: 100%;\n      margin: 0 auto;\n      padding: 16px;\n      background-color: #f9fafb;\n      color: #1e293b;\n    }\n\n    .ledger {\n      background: #ffffff;\n      border: 2px solid #334155;\n      padding: 16px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n      border-radius: 8px;\n    }\n\n    .ledger-header {\n      background: #334155;\n      color: #f8fafc;\n      padding: 10px 12px;\n      margin: -16px -16px 16px -16px;\n      text-align: center;\n      font-size: 20px;\n      font-weight: bold;\n      letter-spacing: 1.2px;\n      border-top-left-radius: 8px;\n      border-top-right-radius: 8px;\n    }\n\n    .company-info {\n      margin-bottom: 12px;\n      display: flex;\n      align-items: flex-start;\n      gap: var(--gap);\n    }\n    .company-info h2 {\n      margin: 0 0 4px 0;\n      color: #334155;\n      font-size: 18px;\n      line-height: 1.2;\n    }\n    .company-info p { margin: 2px 0; color: #64748b; }\n    .company-info p:empty { display: none; }\n\n    .logo {\n      width: 90px;\n      height: 40px;\n      background: transparent;\n      color: #334155;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 5px;\n      font-weight: bold;\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center;\n      flex-shrink: 0;\n    }\n\n    .report-details {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 10px 18px;\n      margin: 12px 0 10px;\n      background: #e0e7ff;\n      padding: 10px;\n      border-radius: 6px;\n      font-size: 12px;\n    }\n    .report-details p { margin: 0; color: #475569; }\n    .report-details p:empty { display: none; }\n    .report-details strong { color: #1e293b; }\n\n    .entity-block {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 10px 18px;\n      background: #f0f5ff;\n      padding: 10px;\n      border-radius: 6px;\n      margin: 12px 0;\n      font-size: 12px;\n    }\n    .entity-block h3 {\n      grid-column: 1 / -1;\n      margin: 0 0 6px 0;\n      color: #334155;\n      font-size: 14px;\n    }\n    .entity-block p { margin: 0; color: #475569; }\n    .entity-block p:empty { display: none; }\n\n    /* Table Layout - Slimmed columns, fixed layout, wrap long text */\n    .items-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 12px 0;\n      font-size: 11px;\n      table-layout: fixed;\n      word-break: break-word;\n    }\n    .items-table th {\n      background: #334155;\n      color: #f8fafc;\n      border: 1px solid #64748b;\n      padding: 6px 5px;\n      text-align: left;\n      font-weight: bold;\n      white-space: nowrap;\n    }\n    .items-table td {\n      border: 1px solid #64748b;\n      padding: 6px 5px;\n      color: #334155;\n      vertical-align: top;\n    }\n    .items-table tr:nth-child(even) { background: #e0e7ff; }\n    .num, .amount { text-align: right; font-family: monospace; white-space: nowrap; }\n    .col-desc { white-space: normal; }\n\n    /* Panels / Summaries */\n    .summary-grid {\n      display: grid;\n      grid-template-columns: 1.3fr 1.2fr 1fr;\n      gap: 12px;\n      align-items: start;\n      margin-top: 6px;\n    }\n    .panel {\n      background: #eef2ff;\n      padding: 10px;\n      border-radius: 6px;\n    }\n    .panel h4 { margin: 0 0 8px 0; color: #1e40af; font-size: 14px; }\n\n    .mini-table {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 11px;\n      margin-top: 6px;\n      table-layout: fixed;\n    }\n    .mini-table th, .mini-table td {\n      border: 1px solid #64748b;\n      padding: 6px;\n      text-align: left;\n      word-break: break-word;\n    }\n    .mini-table th { background: #334155; color: #f8fafc; }\n\n    .totals p { margin: 4px 0; font-size: 12px; color: #475569; display: flex; justify-content: space-between; }\n    .totals .final-total { font-size: 15px; font-weight: bold; color: #1e40af; border-top: 2px solid #334155; padding-top: 6px; margin-top: 6px; }\n\n    .muted { color: #64748b; font-size: 10px; }\n\n    .notes { background: #e0e7ff; padding: 10px; border-left: 4px solid #3b82f6; margin-top: 12px; color: #334155; border-radius: 6px; font-size: 11px; }\n    .notes:empty { display: none; }\n  </style>\n  <script>\n    const jsonData = {{ $json.formattedResponse.toJsonString() }};\n    \n    function populateTemplate() {\n      // Helper function to safely get value or return empty string/default\n      function safeValue(value, defaultValue = '') {\n        return (value !== null && value !== undefined && value !== '') ? value : defaultValue;\n      }\n\n      // Populate company info\n      document.getElementById('company-name').textContent = safeValue(jsonData.company_name);\n      document.getElementById('company-address').textContent = safeValue(jsonData.company_address);\n      document.getElementById('company-phone').textContent = safeValue(jsonData.company_phone);\n      document.getElementById('company-email').textContent = safeValue(jsonData.company_email);\n      \n      // Hide empty company info paragraphs\n      ['company-address', 'company-phone', 'company-email'].forEach(id => {\n        const element = document.getElementById(id);\n        if (!element.textContent.trim()) {\n          element.style.display = 'none';\n        }\n      });\n\n      // Handle logo URL\n      const logoElement = document.querySelector('.logo');\n      if (logoElement && jsonData.logo_url) {\n        logoElement.style.backgroundImage = `url('${jsonData.logo_url}')`;\n      }\n      \n      // Populate report details\n      document.getElementById('ledger-id').textContent = safeValue(jsonData.ledger_id);\n      document.getElementById('entity-name').textContent = safeValue(jsonData.entity_name);\n      document.getElementById('period-start').textContent = safeValue(jsonData.period_start);\n      document.getElementById('period-end').textContent = safeValue(jsonData.period_end);\n      document.getElementById('base-currency').textContent = safeValue(jsonData.base_currency);\n      document.getElementById('prepared-on').textContent = safeValue(jsonData.prepared_on);\n      document.getElementById('prepared-by').textContent = safeValue(jsonData.prepared_by, 'N/A');\n      document.getElementById('approval-status').textContent = safeValue(jsonData.approval_status, 'Pending');\n      \n      // Populate department info\n      document.getElementById('department-name').textContent = safeValue(jsonData.department_name, 'N/A');\n      document.getElementById('cost-center').textContent = safeValue(jsonData.cost_center_code, 'N/A');\n      document.getElementById('project-code').textContent = safeValue(jsonData.project_code, 'N/A');\n      \n      // Handle expense_items array\n      if (jsonData.expense_items && Array.isArray(jsonData.expense_items)) {\n        let expenseRows = '';\n        jsonData.expense_items.forEach(item => {\n          expenseRows += `\n            <tr>\n              <td>${safeValue(item.txn_date)}</td>\n              <td>${safeValue(item.vendor_payee)}</td>\n              <td>${safeValue(item.expense_category)}</td>\n              <td class=\"col-desc\">${safeValue(item.description)}</td>\n              <td>${safeValue(item.gl_account)}</td>\n              <td class=\"num\">${safeValue(item.quantity)}</td>\n              <td class=\"amount\">${safeValue(item.unit_cost, '$0.00')}</td>\n              <td class=\"amount\">${safeValue(item.tax_amount, '$0.00')}</td>\n              <td class=\"amount\">${safeValue(item.line_total, '$0.00')}</td>\n              <td>${safeValue(item.transaction_number)}</td>\n            </tr>`;\n        });\n        const expenseTableBody = document.querySelector('.items-table tbody');\n        if (expenseTableBody) {\n          expenseTableBody.innerHTML = expenseRows;\n        }\n      }\n      \n      // Handle category_summary array\n      if (jsonData.category_summary && Array.isArray(jsonData.category_summary)) {\n        let categoryRows = '';\n        jsonData.category_summary.forEach(item => {\n          categoryRows += `\n            <tr>\n              <td>${safeValue(item.category)}</td>\n              <td>${safeValue(item.pre_tax, '$0.00')}</td>\n              <td>${safeValue(item.tax, '$0.00')}</td>\n              <td>${safeValue(item.total, '$0.00')}</td>\n            </tr>`;\n        });\n        const categoryTable = document.querySelector('.panel .mini-table tbody');\n        if (categoryTable) {\n          categoryTable.innerHTML = categoryRows;\n        }\n      }\n      \n      // Handle tax_summary array\n      if (jsonData.tax_summary && Array.isArray(jsonData.tax_summary)) {\n        let taxRows = '';\n        jsonData.tax_summary.forEach(item => {\n          const rate = safeValue(item.rate) ? `${item.rate}%` : '0%';\n          const taxCode = safeValue(item.tax_code, 'No Tax');\n          taxRows += `\n            <tr>\n              <td>${taxCode}</td>\n              <td>${rate}</td>\n              <td>${safeValue(item.taxable_amount, '$0.00')}</td>\n              <td>${safeValue(item.tax_amount, '$0.00')}</td>\n            </tr>`;\n        });\n        const taxTables = document.querySelectorAll('.panel .mini-table tbody');\n        if (taxTables[1]) {\n          taxTables[1].innerHTML = taxRows;\n        }\n      }\n      \n      // Handle account_summary array\n      if (jsonData.account_summary && Array.isArray(jsonData.account_summary)) {\n        let accountRows = '';\n        jsonData.account_summary.forEach(item => {\n          accountRows += `\n            <tr>\n              <td>${safeValue(item.account_number)}</td>\n              <td>${safeValue(item.account_name)}</td>\n              <td>${safeValue(item.opening_balance, '$0.00')}</td>\n              <td>${safeValue(item.debits, '$0.00')}</td>\n              <td>${safeValue(item.credits, '$0.00')}</td>\n              <td>${safeValue(item.ending_balance, '$0.00')}</td>\n            </tr>`;\n        });\n        const accountTable = document.querySelectorAll('.panel .mini-table tbody')[2];\n        if (accountTable) {\n          accountTable.innerHTML = accountRows;\n        }\n      }\n      \n      // Populate totals\n      document.getElementById('subtotal-pretax').textContent = safeValue(jsonData.subtotal_pretax, '$0.00');\n      document.getElementById('total-tax').textContent = safeValue(jsonData.total_tax, '$0.00');\n      document.getElementById('gross-total').textContent = safeValue(jsonData.gross_total, '$0.00');\n      document.getElementById('non-reimbursable').textContent = safeValue(jsonData.non_reimbursable_total, '$0.00');\n      document.getElementById('advances-applied').textContent = safeValue(jsonData.advances_applied, '$0.00');\n      document.getElementById('net-payable').textContent = safeValue(jsonData.net_payable, '$0.00');\n      document.getElementById('base-currency-footer').textContent = safeValue(jsonData.base_currency);\n      document.getElementById('fx-difference').textContent = safeValue(jsonData.fx_difference, '$0.00');\n      \n      // Handle journal_entries array\n      if (jsonData.journal_entries && Array.isArray(jsonData.journal_entries)) {\n        let journalRows = '';\n        jsonData.journal_entries.forEach(item => {\n          journalRows += `\n            <tr>\n              <td>${safeValue(item.account)}</td>\n              <td>${safeValue(item.description)}</td>\n              <td>${safeValue(item.debit, '$0.00')}</td>\n              <td>${safeValue(item.credit, '$0.00')}</td>\n            </tr>`;\n        });\n        const journalTable = document.querySelector('.panel[style*=\"margin-top:10px\"] .mini-table tbody');\n        if (journalTable) {\n          journalTable.innerHTML = journalRows;\n        }\n      }\n      \n      // Handle notes\n      const notesElement = document.querySelector('.notes');\n      const policyNotes = safeValue(jsonData.policy_notes);\n      if (policyNotes) {\n        notesElement.innerHTML = `<strong>Notes & Policy References:</strong> ${policyNotes}`;\n      } else {\n        notesElement.style.display = 'none';\n      }\n      \n      // Handle approval_trail array\n      if (jsonData.approval_trail && Array.isArray(jsonData.approval_trail)) {\n        let approvalRows = '';\n        if (jsonData.approval_trail.length === 0) {\n          approvalRows = '<tr><td colspan=\"5\" style=\"text-align:center;color:#64748b;\">No approval trail data</td></tr>';\n        } else {\n          jsonData.approval_trail.forEach(item => {\n            approvalRows += `\n              <tr>\n                <td>${safeValue(item.role)}</td>\n                <td>${safeValue(item.name)}</td>\n                <td>${safeValue(item.action)}</td>\n                <td>${safeValue(item.date_time)}</td>\n                <td>${safeValue(item.remarks)}</td>\n              </tr>`;\n          });\n        }\n        const approvalTables = document.querySelectorAll('.panel .mini-table tbody');\n        const approvalTable = approvalTables[approvalTables.length - 1];\n        if (approvalTable) {\n          approvalTable.innerHTML = approvalRows;\n        }\n      }\n    }\n    \n    // Auto-populate when page loads\n    window.addEventListener('DOMContentLoaded', populateTemplate);\n  </script>\n</head>\n<body>\n  <div class=\"ledger\">\n    <div class=\"ledger-header\">EXPENSES SUB-LEDGER</div>\n\n    <!-- Company Info -->\n    <div class=\"company-info\">\n      <div class=\"logo\"></div>\n      <div>\n        <h2 id=\"company-name\"></h2>\n        <p id=\"company-address\"></p>\n        <p id=\"company-phone\"></p>\n        <p id=\"company-email\"></p>\n      </div>\n    </div>\n\n    <!-- Report Meta -->\n    <div class=\"report-details\">\n      <p><strong>Ledger ID:</strong> <span id=\"ledger-id\"></span></p>\n      <p><strong>Entity:</strong> <span id=\"entity-name\"></span></p>\n      <p><strong>Period Start:</strong> <span id=\"period-start\"></span></p>\n      <p><strong>Period End:</strong> <span id=\"period-end\"></span></p>\n      <p><strong>Base Currency:</strong> <span id=\"base-currency\"></span></p>\n      <p><strong>Prepared On:</strong> <span id=\"prepared-on\"></span></p>\n      <p><strong>Prepared By:</strong> <span id=\"prepared-by\"></span></p>\n      <p><strong>Approval Status:</strong> <span id=\"approval-status\"></span></p>\n    </div>\n\n    <!-- Department / Allocation -->\n    <div class=\"entity-block\">\n      <h3>Department / Allocation</h3>\n      <p><strong>Department:</strong> <span id=\"department-name\"></span></p>\n      <p><strong>Cost Center:</strong> <span id=\"cost-center\"></span></p>\n      <p><strong>Project / Job:</strong> <span id=\"project-code\"></span></p>\n    </div>\n\n    <!-- Line Items Table -->\n    <table class=\"items-table\">\n      <colgroup>\n        <col style=\"width: 7%\">\n        <col style=\"width: 14%\">\n        <col style=\"width: 10%\">\n        <col style=\"width: 22%\">\n        <col style=\"width: 15%\">\n        <col style=\"width: 6%\">\n        <col style=\"width: 8%\">\n        <col style=\"width: 6%\">\n        <col style=\"width: 8%\">\n        <col style=\"width: 10%\">\n      </colgroup>\n      <thead>\n        <tr>\n          <th>Txn Date</th>\n          <th>Vendor / Payee</th>\n          <th>Expense Category</th>\n          <th>Description</th>\n          <th>GL Account</th>\n          <th>Qty</th>\n          <th>Unit Cost</th>\n          <th>Tax</th>\n          <th>Line Total</th>\n          <th>Transaction #</th>\n        </tr>\n      </thead>\n      <tbody>\n        <!-- Expense rows will be populated by JavaScript -->\n      </tbody>\n    </table>\n\n    <!-- Summaries -->\n    <div class=\"summary-grid\">\n      <!-- Category Summary -->\n      <div class=\"panel\">\n        <h4>Category Summary</h4>\n        <table class=\"mini-table\">\n          <thead>\n            <tr><th>Category</th><th>Pre-Tax</th><th>Tax</th><th>Total</th></tr>\n          </thead>\n          <tbody>\n            <!-- Category rows will be populated by JavaScript -->\n          </tbody>\n        </table>\n\n        <h4 style=\"margin-top:8px;\">Tax Summary</h4>\n        <table class=\"mini-table\">\n          <thead>\n            <tr><th>Tax Code</th><th>Rate</th><th>Taxable</th><th>Tax</th></tr>\n          </thead>\n          <tbody>\n            <!-- Tax rows will be populated by JavaScript -->\n          </tbody>\n        </table>\n      </div>\n\n      <!-- Account Summary -->\n      <div class=\"panel\">\n        <h4>Account Summary</h4>\n        <table class=\"mini-table\">\n          <thead>\n            <tr>\n              <th>GL Account #</th>\n              <th>GL Account Name</th>\n              <th>Opening Balance</th>\n              <th>Debits</th>\n              <th>Credits</th>\n              <th>Ending Balance</th>\n            </tr>\n          </thead>\n          <tbody>\n            <!-- Account rows will be populated by JavaScript -->\n          </tbody>\n        </table>\n      </div>\n\n      <!-- Totals / Liability -->\n      <div class=\"panel totals\">\n        <p><span><strong>Pre-Tax Subtotal</strong></span><span class=\"amount\" id=\"subtotal-pretax\"></span></p>\n        <p><span><strong>Total Tax</strong></span><span class=\"amount\" id=\"total-tax\"></span></p>\n        <p class=\"final-total\"><span><strong>Gross Total</strong></span><span class=\"amount\" id=\"gross-total\"></span></p>\n        <p><span>Non-Reimbursable</span><span class=\"amount\" id=\"non-reimbursable\"></span></p>\n        <p><span>Advances Applied</span><span class=\"amount\" id=\"advances-applied\"></span></p>\n        <p class=\"final-total\"><span><strong>Net Payable</strong></span><span class=\"amount\" id=\"net-payable\"></span></p>\n        <p class=\"muted\"><em>Base Currency: <span id=\"base-currency-footer\"></span> | FX Diff: <span id=\"fx-difference\"></span></em></p>\n      </div>\n    </div>\n\n    <!-- Journal Export -->\n    <div class=\"panel\" style=\"margin-top:10px;\">\n      <h4>Journal Export</h4>\n      <table class=\"mini-table\">\n        <thead>\n          <tr><th>Account</th><th>Description</th><th>Debit</th><th>Credit</th></tr>\n        </thead>\n        <tbody>\n          <!-- Journal rows will be populated by JavaScript -->\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Notes -->\n    <div class=\"notes\">\n      <!-- Notes will be populated by JavaScript -->\n    </div>\n\n    <!-- Approval Trail -->\n    <div class=\"panel\" style=\"margin-top:10px;\">\n      <h4>Approval Trail</h4>\n      <table class=\"mini-table\">\n        <thead>\n          <tr><th>Role</th><th>Name</th><th>Action</th><th>Date/Time</th><th>Remarks</th></tr>\n        </thead>\n        <tbody>\n          <!-- Approval rows will be populated by JavaScript -->\n        </tbody>\n      </table>\n    </div>\n  </div>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3780,
        12040
      ],
      "id": "bf0bba16-b9f3-41fb-87f7-aa4f05b2bb8f",
      "name": "Edit Fields22"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3940,
        12040
      ],
      "id": "6c22dc2e-4417-4db6-a7a1-35f19792332f",
      "name": "Code16",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Disbursement Listing</title>\n  <style>\n    /* Force landscape layout for printing */\n    @page {\n      size: A4 landscape;\n      margin: 12mm;\n    }\n    @media print {\n      body { background: #fff !important; }\n      .no-print { display: none !important; }\n    }\n\n    body {\n      font-family: var(--font-family);\n      margin: 0 auto;\n      padding: 12px;\n      background-color: var(--background-color);\n      color: var(--text-color);\n    }\n\n    .report {\n      background: var(--invoice-background);\n      border: 1px solid var(--border-color);\n      padding: 20px;\n    }\n\n    .report-header {\n      background: var(--header-background);\n      color: var(--header-text-color);\n      padding: 14px;\n      margin: -20px -20px 20px -20px;\n      text-align: center;\n      font-size: 22px;\n      font-weight: bold;\n      letter-spacing: 1px;\n    }\n\n    .company-info {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 14px;\n    }\n    .company-info h2 {\n      margin: 0 0 6px 0;\n      color: var(--company-name-color);\n      font-size: 18px;\n    }\n    .company-info p {\n      margin: 2px 0;\n      font-size: 12px;\n      color: var(--company-details-color);\n    }\n    .logo {\n      width: var(--logo-width);\n      height: var(--logo-height);\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center;\n    }\n\n    .filters {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px 20px;\n      margin: 12px 0;\n      background: var(--details-background);\n      padding: 10px 12px;\n      border-radius: 4px;\n      font-size: 12px;\n    }\n    .filters p { margin: 0; }\n\n    .table-wrap {\n      overflow-x: auto;\n      border: 1px solid var(--table-border-color);\n      border-radius: 4px;\n      margin-top: 12px;\n    }\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 12px;\n    }\n    th, td {\n      padding: 6px 8px;\n      border: 1px solid var(--table-border-color);\n    }\n    th {\n      background: var(--table-header-background);\n      color: var(--table-header-text-color);\n      font-weight: bold;\n      text-align: left;\n      white-space: nowrap;\n    }\n    td { color: var(--table-text-color); }\n    tr:nth-child(even) td { background: var(--table-row-alternate-background); }\n    .right { text-align: right; font-family: monospace; }\n    .center { text-align: center; }\n\n    .totals {\n      display: flex;\n      flex-wrap: wrap;\n      justify-content: flex-end;\n      gap: 24px;\n      margin: 14px 0;\n      background: var(--total-background);\n      padding: 12px 14px;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n    .final-total {\n      font-size: 16px;\n      font-weight: bold;\n      color: var(--final-total-color);\n      border-top: 2px solid var(--final-total-color);\n      padding-top: 4px;\n    }\n\n    .summary {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 12px;\n      margin-top: 14px;\n    }\n    .card {\n      border: 1px solid var(--border-color);\n      border-radius: 4px;\n      padding: 8px;\n      font-size: 12px;\n      background: var(--details-background);\n    }\n    .card h4 {\n      margin: 0 0 6px 0;\n      font-size: 13px;\n    }\n    .mini {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 12px;\n    }\n    .mini th, .mini td {\n      padding: 4px 6px;\n      border: 1px dashed var(--table-border-color);\n    }\n    .mini th {\n      background: transparent;\n      color: var(--table-header-text-color);\n      text-align: left;\n    }\n\n    .controls {\n      margin-bottom: 20px;\n      text-align: center;\n    }\n    .controls button {\n      background: var(--primary-color);\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      margin: 0 10px;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n    }\n    .controls button:hover {\n      opacity: 0.8;\n    }\n\n    .recipient-info {\n      margin-top: 20px;\n      padding: 10px;\n      background: var(--details-background);\n      border-radius: 4px;\n      font-size: 12px;\n    }\n    .recipient-info h4 {\n      margin: 0 0 6px 0;\n      color: var(--company-name-color);\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"report\" id=\"report\">\n    <div class=\"report-header\">DISBURSEMENT LISTING</div>\n\n    <div class=\"company-info\">\n      <div>\n        <h2 id=\"companyName\"><<company_name>></h2>\n        <p id=\"companyAddress\"><<company_address>></p>\n        <p>Phone: <span id=\"companyPhone\"><<company_phone>></span></p>\n        <p>Email: <span id=\"companyEmail\"><<company_email>></span></p>\n      </div>\n      <div class=\"logo\" id=\"companyLogo\"></div>\n    </div>\n\n    <div class=\"filters\">\n      <p><strong>Period:</strong> <span id=\"reportStartDate\"><<report_start_date>></span> to <span id=\"reportEndDate\"><<report_end_date>></span></p>\n      <p><strong>Bank A/c:</strong> <span id=\"bankAccount\"><<bank_account>></span></p>\n      <p><strong>Prepared On:</strong> <span id=\"preparedOn\"><<prepared_on>></span></p>\n      <p><strong>Prepared By:</strong> <span id=\"preparedBy\"><<prepared_by>></span></p>\n    </div>\n\n    <div class=\"table-wrap\">\n      <table>\n        <thead>\n          <tr>\n            <th>Date</th>\n            <th>Voucher #</th>\n            <th>Payee</th>\n            <th>Vendor #</th>\n            <th>Mode</th>\n            <th>Instr./UTR</th>\n            <th>GL Account</th>\n            <th>Project / CC</th>\n            <th>Description</th>\n            <th class=\"right\">Gross</th>\n            <th class=\"right\">Withholding/TDS</th>\n            <th class=\"right\">Net Paid</th>\n            <th class=\"center\">Status</th>\n            <th class=\"center\">Approved By</th>\n          </tr>\n        </thead>\n        <tbody id=\"disbursementRows\">\n          <!-- Disbursement rows will be populated here -->\n        </tbody>\n      </table>\n    </div>\n\n    <div class=\"totals\">\n      <p><strong>Total Payees:</strong> <span id=\"totalPayees\">0</span></p>\n      <p><strong>Gross Disbursed:</strong> $<span id=\"totalGross\">0.00</span></p>\n      <p><strong>Total Withholding/TDS:</strong> $<span id=\"totalWithholding\">0.00</span></p>\n      <p class=\"final-total\">Net Disbursed: $<span id=\"totalNet\">0.00</span></p>\n    </div>\n\n    <div class=\"summary\">\n      <div class=\"card\">\n        <h4>Summary by Payment Mode</h4>\n        <table class=\"mini\" id=\"summaryByMode\">\n          <tr><th>Mode</th><th>Amount</th></tr>\n        </table>\n      </div>\n      <div class=\"card\">\n        <h4>Summary by Payee (Top 10)</h4>\n        <table class=\"mini\" id=\"summaryByPayee\">\n          <tr><th>Payee</th><th>Amount</th></tr>\n        </table>\n      </div>\n      <div class=\"card\">\n        <h4>Summary by GL Account</h4>\n        <table class=\"mini\" id=\"summaryByGL\">\n          <tr><th>GL Account</th><th>Amount</th></tr>\n        </table>\n      </div>\n    </div>\n\n    <div class=\"recipient-info\" id=\"recipientInfo\">\n      <h4>Report Recipient</h4>\n      <p><strong>Name:</strong> <span id=\"recipientName\"><<recipient_name>></span></p>\n      <p><strong>Company:</strong> <span id=\"recipientCompany\"><<recipient_company>></span></p>\n    </div>\n  </div>\n\n  <script>\n    // Template JSON Data with placeholders\n    const templateJsonData = {{ $json.formattedResponse.toJsonString() }};\n\n\n\n    // Function to apply CSS custom properties from JSON data\n    function applyBrandingStyles(jsonData) {\n      const root = document.documentElement;\n      \n      // Apply branding styles\n      if (jsonData.branding) {\n        root.style.setProperty('--font-family', jsonData.branding.font_family || 'Inter, Arial, sans-serif');\n        root.style.setProperty('--primary-color', jsonData.branding.primary_color || '#334155');\n        root.style.setProperty('--logo-width', jsonData.branding.logo_width || '80px');\n        root.style.setProperty('--logo-height', jsonData.branding.logo_height || '50px');\n      }\n\n      // Apply color styles\n      if (jsonData.colors) {\n        Object.entries(jsonData.colors).forEach(([key, value]) => {\n          const cssVar = '--' + key.replace(/_/g, '-');\n          root.style.setProperty(cssVar, value);\n        });\n      }\n    }\n\n    // Function to generate the report from JSON data\n    function generateDisbursementReport(jsonData) {\n      // Apply branding and color styles\n      applyBrandingStyles(jsonData);\n\n      // Update company information\n      document.getElementById('companyName').textContent = jsonData.company.name;\n      document.getElementById('companyAddress').textContent = jsonData.company.address;\n      document.getElementById('companyPhone').textContent = jsonData.company.phone;\n      document.getElementById('companyEmail').textContent = jsonData.company.email;\n      \n      // Update logo\n      if (jsonData.branding && jsonData.branding.logo_url && !jsonData.branding.logo_url.includes('<<')) {\n        document.getElementById('companyLogo').style.backgroundImage = `url('${jsonData.branding.logo_url}')`;\n      }\n\n      // Update report information\n      document.getElementById('reportStartDate').textContent = jsonData.report_info.start_date;\n      document.getElementById('reportEndDate').textContent = jsonData.report_info.end_date;\n      document.getElementById('bankAccount').textContent = jsonData.report_info.bank_account;\n      document.getElementById('preparedOn').textContent = jsonData.report_info.prepared_on;\n      document.getElementById('preparedBy').textContent = jsonData.report_info.prepared_by;\n\n      // Update recipient information\n      if (jsonData.recipient) {\n        document.getElementById('recipientName').textContent = jsonData.recipient.name;\n        document.getElementById('recipientCompany').textContent = jsonData.recipient.company;\n      }\n\n      // Generate disbursement table rows\n      const disbursementRows = document.getElementById('disbursementRows');\n      disbursementRows.innerHTML = '';\n      \n      if (jsonData.disbursements && Array.isArray(jsonData.disbursements)) {\n        jsonData.disbursements.forEach(item => {\n          // Handle placeholder values\n          const grossAmount = typeof item.gross_amount === 'number' ? item.gross_amount : 0;\n          const withholding = typeof item.withholding === 'number' ? item.withholding : 0;\n          const netPaid = typeof item.net_paid === 'number' ? item.net_paid : 0;\n\n          const row = document.createElement('tr');\n          row.innerHTML = `\n            <td>${item.date}</td>\n            <td>${item.voucher}</td>\n            <td>${item.payee}</td>\n            <td>${item.vendor_number}</td>\n            <td>${item.mode}</td>\n            <td>${item.instrument}</td>\n            <td>${item.gl_account}</td>\n            <td>${item.project}</td>\n            <td>${item.description}</td>\n            <td class=\"right\">$${grossAmount.toFixed ? grossAmount.toFixed(2) : grossAmount}</td>\n            <td class=\"right\">$${withholding.toFixed ? withholding.toFixed(2) : withholding}</td>\n            <td class=\"right\">$${netPaid.toFixed ? netPaid.toFixed(2) : netPaid}</td>\n            <td class=\"center\">${item.status}</td>\n            <td class=\"center\">${item.approved_by}</td>\n          `;\n          disbursementRows.appendChild(row);\n        });\n\n        // Calculate totals only if we have valid numeric data\n        const validDisbursements = jsonData.disbursements.filter(d => \n          typeof d.gross_amount === 'number' && \n          typeof d.withholding === 'number' && \n          typeof d.net_paid === 'number'\n        );\n\n        const totalPayees = new Set(validDisbursements.map(d => d.payee)).size;\n        const totalGross = validDisbursements.reduce((sum, d) => sum + d.gross_amount, 0);\n        const totalWithholding = validDisbursements.reduce((sum, d) => sum + d.withholding, 0);\n        const totalNet = validDisbursements.reduce((sum, d) => sum + d.net_paid, 0);\n\n        // Update totals\n        document.getElementById('totalPayees').textContent = totalPayees;\n        document.getElementById('totalGross').textContent = totalGross.toFixed(2);\n        document.getElementById('totalWithholding').textContent = totalWithholding.toFixed(2);\n        document.getElementById('totalNet').textContent = totalNet.toFixed(2);\n\n        // Generate summaries only with valid data\n        if (validDisbursements.length > 0) {\n          generateSummaries(validDisbursements);\n        }\n      }\n    }\n\n    // Function to generate summary tables\n    function generateSummaries(disbursements) {\n      // Generate summary by payment mode\n      const modesSummary = {};\n      disbursements.forEach(d => {\n        if (!modesSummary[d.mode]) {\n          modesSummary[d.mode] = 0;\n        }\n        modesSummary[d.mode] += d.net_paid;\n      });\n      \n      const summaryByMode = document.getElementById('summaryByMode');\n      summaryByMode.innerHTML = '<tr><th>Mode</th><th>Amount</th></tr>';\n      Object.entries(modesSummary).forEach(([mode, amount]) => {\n        const row = document.createElement('tr');\n        row.innerHTML = `<td>${mode}</td><td>$${amount.toFixed(2)}</td>`;\n        summaryByMode.appendChild(row);\n      });\n\n      // Generate summary by payee\n      const payeesSummary = {};\n      disbursements.forEach(d => {\n        if (!payeesSummary[d.payee]) {\n          payeesSummary[d.payee] = 0;\n        }\n        payeesSummary[d.payee] += d.net_paid;\n      });\n      \n      const summaryByPayee = document.getElementById('summaryByPayee');\n      summaryByPayee.innerHTML = '<tr><th>Payee</th><th>Amount</th></tr>';\n      Object.entries(payeesSummary)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 10)\n        .forEach(([payee, amount]) => {\n          const row = document.createElement('tr');\n          row.innerHTML = `<td>${payee}</td><td>$${amount.toFixed(2)}</td>`;\n          summaryByPayee.appendChild(row);\n        });\n\n      // Generate summary by GL account\n      const glSummary = {};\n      disbursements.forEach(d => {\n        if (!glSummary[d.gl_account]) {\n          glSummary[d.gl_account] = 0;\n        }\n        glSummary[d.gl_account] += d.net_paid;\n      });\n      \n      const summaryByGL = document.getElementById('summaryByGL');\n      summaryByGL.innerHTML = '<tr><th>GL Account</th><th>Amount</th></tr>';\n      Object.entries(glSummary).forEach(([gl, amount]) => {\n        const row = document.createElement('tr');\n        row.innerHTML = `<td>${gl}</td><td>$${amount.toFixed(2)}</td>`;\n        summaryByGL.appendChild(row);\n      });\n    }\n\n    // Function to generate report (can be called from button or externally)\n    function generateReport() {\n      // Use sample data for demonstration, replace with templateJsonData for template use\n      generateDisbursementReport(templateJsonData);\n    }\n\n    // Auto-generate report on page load\n    document.addEventListener('DOMContentLoaded', function() {\n      generateReport();\n    });\n\n\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3700,
        12340
      ],
      "id": "27516199-4870-4a6f-af3a-3283b7924749",
      "name": "Edit Fields23"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3900,
        12340
      ],
      "id": "f68f4999-03c4-4815-8957-501eb759e76e",
      "name": "Code17",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Invoice Template</title>\n  <style>\n    body { \n      font-family: Arial, sans-serif; \n      max-width: 800px; \n      margin: 0 auto; \n      padding: 20px; \n      background: #ffffff; \n      color: #000000; \n    }\n    .header-section {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 30px;\n      border-bottom: 2px solid #000;\n      padding-bottom: 20px;\n    }\n    .logo-section img {\n      max-height: 80px;\n      max-width: 200px;\n    }\n    .invoice-header { \n      text-align: right;\n      font-size: 28px; \n      font-weight: bold; \n    }\n    .company-info { \n      margin-bottom: 20px; \n      background: #f9f9f9;\n      padding: 15px;\n      border-left: 4px solid #000;\n    }\n    .company-info h2 {\n      margin: 0 0 10px 0;\n      color: #000;\n    }\n    .meta-grid { \n      display: grid; \n      grid-template-columns: 1fr 1fr; \n      gap: 20px; \n      margin-bottom: 20px; \n      background: #f5f5f5;\n      padding: 15px;\n    }\n    .customer-section {\n      background: #f9f9f9;\n      padding: 15px;\n      margin-bottom: 20px;\n      border: 1px solid #ddd;\n    }\n    .customer-section h3 {\n      margin: 0 0 10px 0;\n      color: #000;\n      border-bottom: 1px solid #ccc;\n      padding-bottom: 5px;\n    }\n    .items-table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-bottom: 20px; \n    }\n    .items-table th, .items-table td { \n      border: 1px solid #000; \n      padding: 12px 8px; \n      text-align: left; \n    }\n    .items-table th { \n      background: #e0e0e0; \n      font-weight: bold;\n    }\n    .items-table tr:nth-child(even) {\n      background: #f9f9f9;\n    }\n    .total-section { \n      text-align: right; \n      margin-top: 20px; \n      background: #f5f5f5;\n      padding: 20px;\n      border: 1px solid #ddd;\n    }\n    .total-line {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: 8px;\n      padding: 5px 0;\n    }\n    .final-total { \n      font-size: 20px; \n      font-weight: bold; \n      margin-top: 15px;\n      padding-top: 15px;\n      border-top: 2px solid #000;\n    }\n    .notes-section {\n      margin-top: 30px;\n      padding: 15px;\n      background: #f9f9f9;\n      border-left: 4px solid #000;\n    }\n    .footer-section {\n      margin-top: 30px;\n      text-align: center;\n      font-size: 12px;\n      color: #666;\n      border-top: 1px solid #ccc;\n      padding-top: 15px;\n    }\n  </style>\n</head>\n<body>\n  <!-- OPTION 1: Replace the invoiceData object below with your actual JSON data -->\n  <script>\n    const invoiceData = {{ $json.formattedResponse.toJsonString() }};\n  </script>\n\n  <div class=\"invoice\">\n    <!-- Header with Logo and Title -->\n    <div class=\"header-section\">\n      <div class=\"logo-section\">\n        <img id=\"company_logo\" src=\"\" alt=\"Company Logo\" style=\"display: none;\" onerror=\"this.style.display='none'\" />\n      </div>\n      <div class=\"invoice-header\" id=\"document_title\">INVOICE (Services)</div>\n    </div>\n\n    <!-- Supplier Information -->\n    <div class=\"company-info\">\n      <h2 id=\"supplier_name\">Company Name</h2>\n      <p id=\"supplier_address\">Company Address</p>\n      <p id=\"supplier_email\">company@email.com</p>\n      <p id=\"supplier_phone\">Phone Number</p>\n      <p><strong>Supplier Number:</strong> <span id=\"supplier_number\">-</span></p>\n    </div>\n\n    <!-- Invoice Meta Information -->\n    <div class=\"meta-grid\">\n      <div>\n        <p><strong>Invoice #:</strong> <span id=\"invoice_number\">-</span></p>\n        <p><strong>Invoice Date:</strong> <span id=\"invoice_date\">-</span></p>\n        <p><strong>Due Date:</strong> <span id=\"due_date\">-</span></p>\n        <p><strong>PO Number:</strong> <span id=\"po_number\">-</span></p>\n        <p><strong>SO/WO Number:</strong> <span id=\"so_or_wo_number\">-</span></p>\n      </div>\n      <div>\n        <p><strong>Delivery / Completion Date:</strong> <span id=\"delivery_or_completion_date\">-</span></p>\n        <p><strong>Currency Unit:</strong> <span id=\"currency_unit\">-</span></p>\n        <p><strong>Shipping / Delivery Terms:</strong> <span id=\"shipping_or_delivery_terms\">-</span></p>\n        <p><strong>Transfer of Rights:</strong> <span id=\"transfer_of_rights_indication\">-</span></p>\n        <p><strong>Payment Terms:</strong> <span id=\"payment_terms\">-</span></p>\n      </div>\n    </div>\n\n    <!-- Customer Information -->\n    <div class=\"customer-section\">\n      <h3>Bill To:</h3>\n      <p><strong><span id=\"customer_name\">Customer Name</span></strong></p>\n      <p><strong>Customer Number:</strong> <span id=\"customer_number\">-</span></p>\n      <p><strong>Customer Account #:</strong> <span id=\"customer_account_number\">-</span></p>\n      <p id=\"customer_address\">Customer Address</p>\n      <p id=\"customer_email\">customer@email.com</p>\n      <p id=\"customer_phone\">Customer Phone</p>\n    </div>\n\n    <!-- Items Table -->\n    <table class=\"items-table\">\n      <thead>\n        <tr>\n          <th>Product Code</th>\n          <th>Description</th>\n          <th>UoM</th>\n          <th>Quantity</th>\n          <th>Unit Price</th>\n          <th>Line Item Amount</th>\n        </tr>\n      </thead>\n      <tbody id=\"invoice_items\">\n        <tr>\n          <td colspan=\"6\" style=\"text-align: center; font-style: italic; color: #666;\">Loading invoice items...</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- Totals Section -->\n    <div class=\"total-section\">\n      <div class=\"total-line\">\n        <span><strong>Subtotal:</strong></span>\n        <span id=\"subtotal\">$0.00</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Discount:</strong></span>\n        <span id=\"discount\">$0.00</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Freight Charges:</strong></span>\n        <span id=\"freight_charges\">$0.00</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Selling Costs:</strong></span>\n        <span id=\"selling_costs\">$0.00</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Tax Details:</strong></span>\n        <span id=\"tax_details\">-</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Tax:</strong></span>\n        <span id=\"tax_amount\">$0.00</span>\n      </div>\n      <div class=\"total-line final-total\">\n        <span><strong>Total Due:</strong></span>\n        <span id=\"total_amount_due\">$0.00</span>\n      </div>\n    </div>\n\n    <!-- Notes Section -->\n    <div class=\"notes-section\">\n      <h4>Notes:</h4>\n      <p id=\"notes_content\">Invoice notes will appear here.</p>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"footer-section\" id=\"footer_content\">\n      <p>Thank you for your business!</p>\n    </div>\n  </div>\n\n  <!-- JavaScript Data Binding -->\n  <script>\n    // Data binding function\n    function bindInvoiceData(invoiceData) {\n      // Apply theme colors if provided\n      if (invoiceData.theme) {\n        const theme = invoiceData.theme;\n        \n        if (theme.primary_color) {\n          document.querySelectorAll('.header-section').forEach(el => {\n            el.style.borderBottomColor = theme.primary_color;\n          });\n          document.querySelectorAll('.company-info').forEach(el => {\n            el.style.borderLeftColor = theme.primary_color;\n          });\n          document.querySelectorAll('.company-info h2').forEach(el => {\n            el.style.color = theme.primary_color;\n          });\n          document.querySelectorAll('.customer-section h3').forEach(el => {\n            el.style.color = theme.primary_color;\n          });\n          document.querySelectorAll('.final-total').forEach(el => {\n            el.style.borderTopColor = theme.primary_color;\n          });\n          document.querySelectorAll('.notes-section').forEach(el => {\n            el.style.borderLeftColor = theme.primary_color;\n          });\n          document.querySelectorAll('.items-table th, .items-table td').forEach(el => {\n            el.style.borderColor = theme.primary_color;\n          });\n        }\n        \n        if (theme.secondary_color) {\n          // Force light colors for print-friendly backgrounds, ignore dark secondary colors\n          const lightSecondaryColor = theme.secondary_color === '#0F172A' ? '#f8fafc' : theme.secondary_color;\n          document.querySelectorAll('.company-info, .meta-grid, .customer-section, .total-section, .notes-section').forEach(el => {\n            el.style.backgroundColor = lightSecondaryColor;\n          });\n          document.querySelectorAll('.items-table tr:nth-child(even)').forEach(el => {\n            el.style.backgroundColor = lightSecondaryColor;\n          });\n        }\n        \n        if (theme.accent_color) {\n          // Force light colors for table headers, ignore dark accent colors\n          const lightAccentColor = theme.accent_color === '#0F172A' ? '#e2e8f0' : theme.accent_color;\n          document.querySelectorAll('.items-table th').forEach(el => {\n            el.style.backgroundColor = lightAccentColor;\n          });\n        }\n        \n        if (theme.background_color) {\n          document.body.style.backgroundColor = theme.background_color;\n        }\n        \n        if (theme.text_color) {\n          document.body.style.color = theme.text_color;\n        }\n      }\n\n      // Bind company logo\n      if (invoiceData.branding && invoiceData.branding.logo_url) {\n        const logoImg = document.getElementById('company_logo');\n        if (logoImg) {\n          logoImg.src = invoiceData.branding.logo_url;\n          logoImg.style.display = 'block';\n        }\n      }\n\n\n      // Bind all simple fields\n      const invoice = invoiceData.invoice;\n      \n      // Header/Meta fields\n      if (invoice && invoice.header) {\n        Object.entries(invoice.header).forEach(([key, val]) => {\n          const el = document.getElementById(key);\n          if (el && val !== null && val !== undefined && val !== \"\") {\n            el.textContent = val;\n          }\n        });\n      }\n\n      // Supplier fields\n      if (invoice && invoice.supplier) {\n        Object.entries(invoice.supplier).forEach(([key, val]) => {\n          const el = document.getElementById(key);\n          if (el && val !== null && val !== undefined && val !== \"\") {\n            el.textContent = val;\n          }\n        });\n      }\n\n      // Customer fields\n      if (invoice && invoice.customer) {\n        Object.entries(invoice.customer).forEach(([key, val]) => {\n          const el = document.getElementById(key);\n          if (el && val !== null && val !== undefined && val !== \"\") {\n            el.textContent = val;\n          }\n        });\n      }\n\n      // Currency symbol\n      const currencySymbol = invoiceData.currency_symbol || '$';\n      \n      // Totals fields with currency\n      if (invoice && invoice.totals) {\n        Object.entries(invoice.totals).forEach(([key, val]) => {\n          const el = document.getElementById(key);\n          if (el && val !== null && val !== undefined) {\n            if (key !== 'tax_details') {\n              // Clean up currency values - remove existing currency symbols\n              let cleanValue = val;\n              if (typeof cleanValue === 'string') {\n                cleanValue = cleanValue.replace(/[$,]/g, '');\n              }\n              const numValue = parseFloat(cleanValue);\n              if (!isNaN(numValue)) {\n                el.textContent = currencySymbol + numValue.toLocaleString();\n              } else {\n                el.textContent = val;\n              }\n            } else {\n              el.textContent = val;\n            }\n          }\n        });\n      }\n\n      // Render items table\n      const tbody = document.getElementById('invoice_items');\n      if (tbody && invoice && invoice.items && invoice.items.length > 0) {\n        tbody.innerHTML = ''; // Clear existing items\n        invoice.items.forEach(item => {\n          const tr = document.createElement('tr');\n          \n          // Clean up unit_price and line_total - remove currency symbols and parse\n          let unitPrice = item.unit_price;\n          let lineTotal = item.line_total;\n          \n          // If the values are strings with currency symbols, clean them\n          if (typeof unitPrice === 'string') {\n            unitPrice = unitPrice.replace(/[$,]/g, '');\n          }\n          if (typeof lineTotal === 'string') {\n            lineTotal = lineTotal.replace(/[$,]/g, '');\n          }\n          \n          // Parse to numbers\n          unitPrice = parseFloat(unitPrice) || 0;\n          lineTotal = parseFloat(lineTotal) || 0;\n          \n          tr.innerHTML = `\n            <td>${item.product_code || ''}</td>\n            <td>${item.description || ''}</td>\n            <td>${item.uom || ''}</td>\n            <td>${item.quantity || ''}</td>\n            <td>${currencySymbol}${unitPrice.toLocaleString()}</td>\n            <td>${currencySymbol}${lineTotal.toLocaleString()}</td>\n          `;\n          tbody.appendChild(tr);\n        });\n      }\n\n      // Handle notes section\n      if (invoiceData.notes) {\n        const notesEl = document.getElementById('notes_content');\n        if (notesEl) notesEl.textContent = invoiceData.notes;\n      }\n\n      // Handle footer\n      if (invoiceData.footer) {\n        const footerEl = document.getElementById('footer_content');\n        if (footerEl) footerEl.innerHTML = invoiceData.footer;\n      }\n    }\n\n    // Auto-bind data when page loads\n    document.addEventListener('DOMContentLoaded', function() {\n      if (typeof invoiceData !== 'undefined') {\n        bindInvoiceData(invoiceData);\n      }\n    });\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3680,
        12660
      ],
      "id": "c23b53de-0157-4a7a-9430-48acf71ebcbf",
      "name": "Edit Fields24"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3880,
        12660
      ],
      "id": "2305aad8-fca6-469d-863e-ead7c20583c4",
      "name": "Code18",
      "retryOnFail": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Invoice Template</title>\n  <style>\n    body { \n      font-family: Arial, sans-serif; \n      max-width: 800px; \n      margin: 0 auto; \n      padding: 20px; \n      background: #ffffff; \n      color: #000000; \n    }\n    .header-section {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 30px;\n      border-bottom: 2px solid #000;\n      padding-bottom: 20px;\n    }\n    .logo-section img {\n      max-height: 80px;\n      max-width: 200px;\n    }\n    .invoice-header { \n      text-align: right;\n      font-size: 28px; \n      font-weight: bold; \n    }\n    .company-info { \n      margin-bottom: 20px; \n      background: #f9f9f9;\n      padding: 15px;\n      border-left: 4px solid #000;\n    }\n    .company-info h2 {\n      margin: 0 0 10px 0;\n      color: #000;\n    }\n    .meta-grid { \n      display: grid; \n      grid-template-columns: 1fr 1fr; \n      gap: 20px; \n      margin-bottom: 20px; \n      background: #f5f5f5;\n      padding: 15px;\n    }\n    .customer-section {\n      background: #f9f9f9;\n      padding: 15px;\n      margin-bottom: 20px;\n      border: 1px solid #ddd;\n    }\n    .customer-section h3 {\n      margin: 0 0 10px 0;\n      color: #000;\n      border-bottom: 1px solid #ccc;\n      padding-bottom: 5px;\n    }\n    .items-table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-bottom: 20px; \n    }\n    .items-table th, .items-table td { \n      border: 1px solid #000; \n      padding: 12px 8px; \n      text-align: left; \n    }\n    .items-table th { \n      background: #e0e0e0; \n      font-weight: bold;\n    }\n    .items-table tr:nth-child(even) {\n      background: #f9f9f9;\n    }\n    .total-section { \n      text-align: right; \n      margin-top: 20px; \n      background: #f5f5f5;\n      padding: 20px;\n      border: 1px solid #ddd;\n    }\n    .total-line {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: 8px;\n      padding: 5px 0;\n    }\n    .final-total { \n      font-size: 20px; \n      font-weight: bold; \n      margin-top: 15px;\n      padding-top: 15px;\n      border-top: 2px solid #000;\n    }\n    .notes-section {\n      margin-top: 30px;\n      padding: 15px;\n      background: #f9f9f9;\n      border-left: 4px solid #000;\n    }\n    .footer-section {\n      margin-top: 30px;\n      text-align: center;\n      font-size: 12px;\n      color: #666;\n      border-top: 1px solid #ccc;\n      padding-top: 15px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"invoice\">\n    <!-- Header with Logo and Title -->\n    <div class=\"header-section\">\n      <div class=\"logo-section\">\n        <img id=\"company_logo\" src=\"\" alt=\"Company Logo\" style=\"display: none;\" onerror=\"this.style.display='none'\" />\n      </div>\n      <div class=\"invoice-header\">INVOICE</div>\n    </div>\n\n    <!-- Supplier Information -->\n    <div class=\"company-info\">\n      <h2 id=\"company_name\">Your Company Name</h2>\n      <p id=\"company_address\">123 Business Street</p>\n      <p>City, State 12345</p>\n      <p>Phone: (555) 123-4567</p>\n      <p>Email: billing@yourcompany.com</p>\n      <p id=\"department_name\" style=\"display: none;\"></p>\n    </div>\n\n    <!-- Invoice Meta Information -->\n    <div class=\"meta-grid\">\n      <div>\n        <p><strong>Transaction ID:</strong> <span id=\"transaction_id\">-</span></p>\n        <p><strong>Service Dates:</strong> <span id=\"service_dates\">-</span></p>\n        <p><strong>Source:</strong> <span id=\"source\">-</span></p>\n      </div>\n      <div>\n        <p><strong>File Type:</strong> <span id=\"file_type\">-</span></p>\n        <p><strong>Invoice Date:</strong> <span id=\"invoice_date\">-</span></p>\n        <p><strong>Due Date:</strong> <span id=\"due_date\">-</span></p>\n      </div>\n    </div>\n\n    <!-- Customer Information -->\n    <div class=\"customer-section\">\n      <h3>Bill To:</h3>\n      <p><strong id=\"vendor_name\">Customer Name</strong></p>\n      <p id=\"vendor_address\">Customer Address</p>\n      <p>City, State 12345</p>\n      <p id=\"vendor_email\">customer@email.com</p>\n      <p>(555) 987-6543</p>\n    </div>\n\n    <!-- Items Table -->\n    <table class=\"items-table\">\n      <thead>\n        <tr>\n          <th>Description</th>\n          <th>Service Period</th>\n          <th>Source</th>\n          <th>Amount</th>\n        </tr>\n      </thead>\n      <tbody id=\"invoice_items\">\n        <tr>\n          <td id=\"item_description\">Professional Services</td>\n          <td id=\"item_service_dates\">-</td>\n          <td id=\"item_source\">-</td>\n          <td id=\"item_amount\">$0.00</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- Totals Section -->\n    <div class=\"total-section\">\n      <div class=\"total-line\">\n        <span><strong>Subtotal:</strong></span>\n        <span id=\"subtotal\">$0.00</span>\n      </div>\n      <div class=\"total-line\">\n        <span><strong>Tax (if applicable):</strong></span>\n        <span id=\"tax_amount\">$0.00</span>\n      </div>\n      <div class=\"total-line final-total\">\n        <span><strong>Total Due:</strong></span>\n        <span id=\"total_amount_due\">$0.00</span>\n      </div>\n    </div>\n\n    <!-- Notes Section -->\n    <div class=\"notes-section\">\n      <h4>Payment Information:</h4>\n      <p>Please remit payment within 30 days of invoice date.</p>\n      <p>Thank you for your business!</p>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"footer-section\">\n      <p>Thank you for choosing our services!</p>\n    </div>\n  </div>\n\n  <script>\n    const invoiceData = {{ $json.formattedResponse.toJsonString() }};\n\n    function bindInvoiceData(data) {\n      // Apply branding\n      if (data.branding) {\n        // Apply logo\n        if (data.branding.logo_url) {\n          const logoImg = document.getElementById('company_logo');\n          if (logoImg) {\n            logoImg.src = data.branding.logo_url;\n            logoImg.style.display = 'block';\n          }\n        }\n        \n        // Apply font family\n        if (data.branding.font_family) {\n          document.body.style.fontFamily = data.branding.font_family + \", Arial, sans-serif\";\n        }\n      }\n\n      // Apply colors\n      if (data.colors) {\n        if (data.colors.primary_color) {\n          const primaryColor = data.colors.primary_color;\n          \n          // Apply primary color to borders and accents\n          document.querySelectorAll('.header-section').forEach(el => {\n            el.style.borderBottomColor = primaryColor;\n          });\n          document.querySelectorAll('.company-info').forEach(el => {\n            el.style.borderLeftColor = primaryColor;\n          });\n          document.querySelectorAll('.company-info h2').forEach(el => {\n            el.style.color = primaryColor;\n          });\n          document.querySelectorAll('.customer-section h3').forEach(el => {\n            el.style.color = primaryColor;\n          });\n          document.querySelectorAll('.final-total').forEach(el => {\n            el.style.borderTopColor = primaryColor;\n          });\n          document.querySelectorAll('.notes-section').forEach(el => {\n            el.style.borderLeftColor = primaryColor;\n          });\n          document.querySelectorAll('.items-table th, .items-table td').forEach(el => {\n            el.style.borderColor = primaryColor;\n          });\n        }\n        \n        if (data.colors.secondary_color) {\n          const secondaryColor = data.colors.secondary_color;\n          \n          // For dark colors, use a lighter version for backgrounds\n          const lightSecondaryColor = secondaryColor === '#0F172A' ? '#f8fafc' : secondaryColor;\n          \n          // Apply secondary color to backgrounds\n          document.querySelectorAll('.company-info, .meta-grid, .customer-section, .total-section, .notes-section').forEach(el => {\n            el.style.backgroundColor = lightSecondaryColor;\n          });\n          document.querySelectorAll('.items-table tr:nth-child(even)').forEach(el => {\n            el.style.backgroundColor = lightSecondaryColor;\n          });\n          document.querySelectorAll('.items-table th').forEach(el => {\n            el.style.backgroundColor = lightSecondaryColor;\n          });\n        }\n      }\n\n      // Bind company information\n      if (data.company) {\n        if (data.company.company_name) {\n          document.getElementById('company_name').textContent = data.company.company_name;\n        }\n        if (data.company.company_address) {\n          document.getElementById('company_address').textContent = data.company.company_address;\n        }\n        if (data.company.department_name) {\n          const deptEl = document.getElementById('department_name');\n          deptEl.textContent = data.company.department_name;\n          deptEl.style.display = 'block';\n        }\n      }\n\n      // Bind vendor information\n      if (data.vendor) {\n        if (data.vendor.vendor_name) {\n          document.getElementById('vendor_name').textContent = data.vendor.vendor_name;\n        }\n        if (data.vendor.vendor_address) {\n          document.getElementById('vendor_address').textContent = data.vendor.vendor_address;\n        }\n        if (data.vendor.vendor_email) {\n          document.getElementById('vendor_email').textContent = data.vendor.vendor_email;\n        }\n      }\n\n      // Bind data fields\n      if (data.data) {\n        // Set current date as invoice date\n        const currentDate = new Date().toLocaleDateString();\n        const dueDateObj = new Date();\n        dueDateObj.setDate(dueDateObj.getDate() + 30);\n        const dueDate = dueDateObj.toLocaleDateString();\n        \n        document.getElementById('invoice_date').textContent = currentDate;\n        document.getElementById('due_date').textContent = dueDate;\n        \n        // Bind transaction ID\n        if (data.data.transaction_id) {\n          document.getElementById('transaction_id').textContent = data.data.transaction_id;\n        }\n        \n        // Bind service dates\n        if (data.data.service_dates) {\n          document.getElementById('service_dates').textContent = data.data.service_dates;\n          document.getElementById('item_service_dates').textContent = data.data.service_dates;\n        }\n        \n        // Bind source\n        if (data.data.source) {\n          document.getElementById('source').textContent = data.data.source;\n          document.getElementById('item_source').textContent = data.data.source;\n        }\n        \n        // Bind file type\n        if (data.data.file_type) {\n          document.getElementById('file_type').textContent = data.data.file_type;\n        }\n        \n        // Bind amount\n        if (data.data.amount) {\n          let amount = data.data.amount;\n          \n          // Clean up amount - remove existing currency symbols\n          if (typeof amount === 'string') {\n            amount = amount.replace(/[$,]/g, '');\n          }\n          \n          const numValue = parseFloat(amount);\n          if (!isNaN(numValue)) {\n            const formattedAmount = '$' + numValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});\n            \n            document.getElementById('item_amount').textContent = formattedAmount;\n            document.getElementById('subtotal').textContent = formattedAmount;\n            document.getElementById('total_amount_due').textContent = formattedAmount;\n          }\n        }\n      }\n    }\n\n    // Auto-bind data when page loads\n    document.addEventListener('DOMContentLoaded', function() {\n      if (typeof invoiceData !== 'undefined') {\n        bindInvoiceData(invoiceData);\n      }\n    });\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3620,
        12980
      ],
      "id": "661f2737-b3c0-4d7a-ba19-ad9a5ff19d62",
      "name": "Edit Fields25"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3820,
        12980
      ],
      "id": "12d75a73-da1f-41e5-b928-11cf23226261",
      "name": "Code19",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n<title>Shipping Document (Sending)</title>\n<style>\n  :root{\n    /* Theme tokens */\n    --background: #f9fafb;\n    --text: #1f2937;\n    --panel: #ffffff;\n    --border: #d1d5db;\n    --header-bg: var(--primary-color);\n    --header-text: #ffffff;\n    --company-name: var(--primary-color);\n    --company-details: #4b5563;\n    --meta-text: #475569;\n    --meta-label: var(--secondary-color);\n    --section-bg: #f3f4f6;\n    --party-bg: #e0e7ff;\n    --party-header: var(--secondary-color);\n    --party-text: #1e293b;\n    --th-bg: #c7d2fe;\n    --th-text: #1e293b;\n    --td-text: #374151;\n    --row-alt: #e0e7ff;\n    --total-bg: var(--primary-color);\n    --total-text: #f9fafb;\n    --final-total: var(--secondary-color);\n    --accent: var(--primary-color);\n    --logo-w: 120px;\n    --logo-h: 60px;\n    --logo-bg: #e0e7ff;\n    --logo-text: transparent;\n  }\n\n  /* Screen layout — centered A4 landscape sheet */\n  body{\n    margin:0; background:var(--background); color:var(--text); font-family: var(--font-family), Arial, Helvetica, sans-serif;\n  }\n  .page{\n    width: 297mm;  /* A4 landscape width */\n    min-height: 210mm;\n    margin: 10mm auto;\n    background: var(--panel);\n    border: 2px solid var(--border);\n    box-shadow: 0 4px 10px rgba(0,0,0,.12);\n    padding: 14mm;\n    box-sizing: border-box;\n  }\n\n  /* Print layout */\n  @page {\n    size: A4 landscape;\n    margin: 10mm;\n  }\n  @media print {\n    body { background: #fff; }\n    .page{\n      margin: 0; border: none; box-shadow: none; width: auto; min-height: auto; padding: 0;\n    }\n    .no-print { display: none !important; }\n    thead { display: table-header-group; } /* repeat header on pages */\n    tr, img { page-break-inside: avoid; }\n  }\n\n  .doc-header{\n    background: var(--header-bg);\n    color: var(--header-text);\n    text-align: center;\n    font-size: 26px;\n    font-weight: bold;\n    letter-spacing: 1.5px;\n    padding: 12px 16px;\n    border-radius: 6px;\n    margin-bottom: 12px;\n  }\n\n  .topbar{\n    display: grid;\n    grid-template-columns: 1fr auto;\n    gap: 16px;\n    align-items: center;\n    margin-bottom: 10px;\n  }\n  .logo{\n    width: var(--logo-w);\n    height: var(--logo-h);\n    background: var(--logo-bg);\n    color: var(--logo-text);\n    display: flex; align-items: center; justify-content: center;\n    border-radius: 6px;\n    font-weight: bold;\n    background-image: var(--logo-url);\n    background-size: cover;\n    background-position: center;\n  }\n  .co h2{\n    margin:0 0 6px 0; font-size: 20px; color: var(--company-name);\n  }\n  .co p{ margin: 2px 0; color: var(--company-details); font-size: 12px; }\n\n  .meta{\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 10px 14px;\n    background: var(--section-bg);\n    padding: 10px;\n    border-radius: 6px;\n    margin: 10px 0 12px 0;\n    font-size: 13px;\n  }\n  .kv .k{ color: var(--meta-label); font-weight: 600; }\n  .kv .v{ color: var(--meta-text); }\n\n  .parties{\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 12px;\n    margin-top: 8px;\n  }\n  .card{\n    background: var(--party-bg);\n    padding: 10px;\n    border-radius: 6px;\n  }\n  .card h3{ margin:0 0 6px 0; color: var(--party-header); font-size: 15px; }\n  .card p{ margin:3px 0; color: var(--party-text); font-size: 12.5px; }\n\n  table{\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 14px;\n    font-size: 13px;\n  }\n  th{\n    background: var(--th-bg);\n    color: var(--th-text);\n    border: 1px solid var(--border);\n    padding: 8px;\n    text-align: left;\n  }\n  td{\n    border: 1px solid var(--border);\n    padding: 8px;\n    color: var(--td-text);\n    vertical-align: top;\n  }\n  tbody tr:nth-child(even){ background: var(--row-alt); }\n  .qty, .price, .amount, .uom, .code { text-align: right; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }\n\n  .notes{\n    margin-top: 12px;\n    padding: 10px;\n    border-left: 4px solid var(--accent);\n    background: var(--section-bg);\n    font-size: 12.5px;\n    color: var(--meta-text);\n    border-radius: 4px;\n  }\n\n  .signatures{\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 16px;\n    margin-top: 20px;\n  }\n  .sig{\n    border-top: 1px solid var(--border);\n    padding-top: 8px;\n    font-size: 12px;\n    color: var(--meta-text);\n    min-height: 48px;\n  }\n  .sig .label{ color: var(--meta-label); font-weight: 600; display: block; margin-bottom: 4px; }\n</style>\n</head>\n<body>\n  <div class=\"page\">\n    <div class=\"doc-header\">SHIPPING DOCUMENT (SENDING)</div>\n\n    <div class=\"topbar\">\n      <div class=\"co\">\n        <h2 id=\"company-name\"></h2>\n        <p id=\"company-address\"></p>\n        <p><span id=\"company-phone\"></span> • <span id=\"company-email\"></span></p>\n      </div>\n      <div class=\"logo\" id=\"logo\"></div>\n    </div>\n\n    <!-- Core meta (Mandatory) -->\n    <div class=\"meta\">\n      <div class=\"kv\"><div class=\"k\">Shipping Doc #</div><div class=\"v\" id=\"shipping-document-number\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Document Date</div><div class=\"v\" id=\"shipping-doc-date\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Order # (PO/SO)</div><div class=\"v\"><span id=\"purchase-order-number\"></span> <span id=\"sales-order-number\"></span></div></div>\n      <div class=\"kv\"><div class=\"k\">Date Shipped</div><div class=\"v\" id=\"date-shipped\"></div></div>\n\n      <div class=\"kv\"><div class=\"k\">Carrier</div><div class=\"v\" id=\"shipping-carrier\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Method</div><div class=\"v\" id=\"shipping-method\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Tracking #</div><div class=\"v\" id=\"tracking-number\"></div></div>\n\n      <!-- Optional quick refs -->\n      <div class=\"kv\"><div class=\"k\">Customer #</div><div class=\"v\" id=\"customer-number\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Supplier #</div><div class=\"v\" id=\"supplier-number\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Date Delivered</div><div class=\"v\" id=\"date-delivered\"></div></div>\n      <div class=\"kv\"><div class=\"k\">Received Date</div><div class=\"v\" id=\"received-date\"></div></div>\n    </div>\n\n    <!-- Parties -->\n    <div class=\"parties\">\n      <div class=\"card\">\n        <h3>Customer (Consignee)</h3>\n        <p><strong id=\"customer-name\"></strong></p>\n        <p id=\"customer-address\"></p>\n        <!-- Optional -->\n        <p><em>Consignee's Name & Address:</em> <span id=\"consignee-name-and-address\"></span></p>\n      </div>\n      <div class=\"card\">\n        <h3>Supplier (Shipper)</h3>\n        <p><strong id=\"supplier-name\"></strong></p>\n        <p id=\"supplier-address\"></p>\n        <!-- Optional -->\n        <p><em>Shipper's Name & Address:</em> <span id=\"shipper-name-and-address\"></span></p>\n      </div>\n    </div>\n\n    <!-- Line Items -->\n    <table>\n      <thead>\n        <tr>\n          <th style=\"width:40%\">Product Description</th>\n          <th class=\"code\" style=\"width:12%\">Product Code</th>\n          <th class=\"uom\" style=\"width:8%\">UOM</th>\n          <th class=\"qty\" style=\"width:10%\">Quantity</th>\n          <th class=\"price\" style=\"width:15%\">Unit Price</th>\n          <th class=\"amount\" style=\"width:15%\">Line Amount</th>\n        </tr>\n      </thead>\n      <tbody id=\"line-items-table\">\n      </tbody>\n    </table>\n\n    <!-- Shipment/Logistics (Optional blocks) -->\n    <div class=\"notes\">\n      <strong>Bill of Lading #:</strong> <span id=\"bill-of-lading-number\"></span> &nbsp; | &nbsp;\n      <strong>Packaging:</strong> <span id=\"packaging-details\"></span> &nbsp; | &nbsp;\n      <strong>Insurance:</strong> <span id=\"insurance-details\"></span> &nbsp; | &nbsp;\n      <strong>Customs:</strong> <span id=\"customs-information\"></span> &nbsp; | &nbsp;\n      <strong>Proof of Delivery:</strong> <span id=\"proof-of-delivery\"></span> &nbsp; | &nbsp;\n      <strong>Shipping/Delivery Terms:</strong> <span id=\"shipping-or-delivery-terms\"></span>\n    </div>\n\n    <!-- Signatures -->\n    <div class=\"signatures\">\n      <div class=\"sig\">\n        <span class=\"label\">Prepared By</span>\n        <span id=\"prepared-by\"></span>\n      </div>\n      <div class=\"sig\">\n        <span class=\"label\">Carrier Representative</span>\n        <span id=\"carrier-signature\"></span>\n      </div>\n      <div class=\"sig\">\n        <span class=\"label\">Received By (Consignee)</span>\n        <span id=\"received-by\"></span>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    // JSON data variable - replace this with your actual JSON data\n    const jsonData = {{ $json.formattedResponse.toJsonString() }};\n\n    // Function to populate the document with JSON data\n    function populateDocument(data) {\n      // Set CSS custom properties for colors and branding\n      const root = document.documentElement;\n      root.style.setProperty('--primary-color', data.colors?.primary_color || '#334155');\n      root.style.setProperty('--secondary-color', data.colors?.secondary_color || '#0F172A');\n      root.style.setProperty('--font-family', data.branding?.font_family || 'Inter');\n      root.style.setProperty('--logo-url', `url('${data.branding?.logo_url || ''}')`);\n\n      // Populate company info\n      document.getElementById('company-name').textContent = data.company_info?.company_name || '';\n      document.getElementById('company-address').textContent = data.company_info?.company_address || '';\n      document.getElementById('company-phone').textContent = data.company_info?.company_phone || '';\n      document.getElementById('company-email').textContent = data.company_info?.company_email || '';\n\n      // Populate document details\n      document.getElementById('shipping-document-number').textContent = data.document_details?.shipping_document_number || '';\n      document.getElementById('shipping-doc-date').textContent = data.document_details?.shipping_doc_date || '';\n      document.getElementById('purchase-order-number').textContent = data.document_details?.purchase_order_number || '';\n      document.getElementById('sales-order-number').textContent = data.document_details?.sales_order_number || '';\n      document.getElementById('date-shipped').textContent = data.document_details?.date_shipped || '';\n      document.getElementById('shipping-carrier').textContent = data.document_details?.shipping_carrier || '';\n      document.getElementById('shipping-method').textContent = data.document_details?.shipping_method || '';\n      document.getElementById('tracking-number').textContent = data.document_details?.tracking_number || '';\n      document.getElementById('customer-number').textContent = data.document_details?.customer_number || '';\n      document.getElementById('supplier-number').textContent = data.document_details?.supplier_number || '';\n      document.getElementById('date-delivered').textContent = data.document_details?.date_delivered || '';\n      document.getElementById('received-date').textContent = data.document_details?.received_date || '';\n\n      // Populate parties\n      document.getElementById('customer-name').textContent = data.parties?.customer?.customer_name || '';\n      document.getElementById('customer-address').textContent = data.parties?.customer?.customer_address || '';\n      document.getElementById('consignee-name-and-address').textContent = data.parties?.customer?.consignee_name_and_address || '';\n      document.getElementById('supplier-name').textContent = data.parties?.supplier?.supplier_name || '';\n      document.getElementById('supplier-address').textContent = data.parties?.supplier?.supplier_address || '';\n      document.getElementById('shipper-name-and-address').textContent = data.parties?.supplier?.shipper_name_and_address || '';\n\n      // Populate line items\n      const tableBody = document.getElementById('line-items-table');\n      tableBody.innerHTML = '';\n      \n      if (data.line_items && data.line_items.length > 0) {\n        data.line_items.forEach(item => {\n          const row = document.createElement('tr');\n          \n          // Parse price and calculate if needed\n // Handle both string and number formats for price\nlet unitPrice = 0;\nif (item.item_price) {\n  if (typeof item.item_price === 'string') {\n    unitPrice = parseFloat(item.item_price.replace('$', ''));\n  } else {\n    unitPrice = parseFloat(item.item_price);\n  }\n}\n          const quantity = item.item_quantity ? parseInt(item.item_quantity) : 0;\n          const lineAmount = item.line_item_amount ? item.line_item_amount : `$${(unitPrice * quantity).toLocaleString()}`;\n          \n          row.innerHTML = `\n            <td>${item.product_description || ''}</td>\n            <td class=\"code\">${item.product_code || ''}</td>\n            <td class=\"uom\">${item.unit_of_measurement || 'pcs'}</td>\n            <td class=\"qty\">${item.item_quantity || ''}</td>\n            <td class=\"price\">${item.item_price || '$0.00'}</td>\n            <td class=\"amount\">${lineAmount}</td>\n          `;\n          tableBody.appendChild(row);\n        });\n      }\n\n      // Populate logistics\n      document.getElementById('bill-of-lading-number').textContent = data.logistics?.bill_of_lading_number || 'BOL-394820';\n      document.getElementById('packaging-details').textContent = data.logistics?.packaging_details || 'Crated and Palletized';\n      document.getElementById('insurance-details').textContent = data.logistics?.insurance_details || 'Full Coverage';\n      document.getElementById('customs-information').textContent = data.logistics?.customs_information || 'N/A';\n      document.getElementById('proof-of-delivery').textContent = data.logistics?.proof_of_delivery || 'Pending';\n      document.getElementById('shipping-or-delivery-terms').textContent = data.logistics?.shipping_or_delivery_terms || 'FOB Origin';\n\n      // Populate signatures\n      document.getElementById('prepared-by').textContent = data.signatures?.prepared_by || 'John Anderson';\n      document.getElementById('carrier-signature').textContent = data.signatures?.carrier_signature || 'Rachel Meyers';\n      document.getElementById('received-by').textContent = data.signatures?.received_by || 'Michael Lee';\n    }\n\n    // Populate the document when the page loads\n    document.addEventListener('DOMContentLoaded', function() {\n      populateDocument(jsonData);\n    });\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3620,
        13220
      ],
      "id": "0988cfe8-48aa-4318-baed-46a7c632005f",
      "name": "Edit Fields26"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3820,
        13220
      ],
      "id": "d09b59c6-e84c-4819-9eee-3ac27f70e506",
      "name": "Code20",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n<title>Shipping Document (Receiving)</title>\n<style>\n  :root{\n    --primary: #2563eb;\n    --secondary: #64748b;\n    --background: #f9fafb;\n    --text: #1e293b;\n    --panel: #ffffff;\n    --border: #cbd5e1;\n    --accent: #2563eb;\n  }\n\n  body{ \n    margin:0; \n    background:var(--background); \n    color:var(--text); \n    font-family: Arial, Helvetica, sans-serif;\n  }\n  \n  .page{\n    width: 297mm; min-height: 210mm; margin: 10mm auto;\n    background: var(--panel); border: 2px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,.12);\n    padding: 14mm; box-sizing: border-box;\n  }\n\n  @page { size: A4 landscape; margin: 10mm; }\n  @media print{\n    body{ background:#fff; }\n    .page{ margin:0; border:none; box-shadow:none; width:auto; min-height:auto; padding:0; }\n    .no-print{ display:none !important; }\n    thead{ display: table-header-group; }\n    tr, img{ page-break-inside: avoid; }\n  }\n\n  .doc-header{\n    background: var(--primary); color: white;\n    text-align: center; font-size: 26px; font-weight: bold; letter-spacing: 1.5px;\n    padding: 12px 16px; border-radius: 6px; margin-bottom: 12px;\n  }\n\n  .topbar{\n    display:grid; grid-template-columns: 1fr auto; gap:16px; align-items:center; margin-bottom:10px;\n  }\n  .logo{\n    width: 120px; height: 60px;\n    background: transparent; color: transparent;\n    display:flex; align-items:center; justify-content:center; border-radius:6px; font-weight:bold;\n    background-image:url(''); background-size:cover; background-position:center;\n  }\n  .co h2{ margin:0 0 6px 0; font-size:20px; color:var(--text); }\n  .co p{ margin:2px 0; color:var(--secondary); font-size:12px; }\n\n  .meta{\n    display:grid; grid-template-columns: repeat(4, 1fr);\n    gap:10px 14px; background:#e2e8f0; padding:10px; border-radius:6px; margin:10px 0 12px 0; font-size:13px;\n  }\n  .kv .k{ color:var(--primary); font-weight:600; }\n  .kv .v{ color:var(--secondary); }\n\n  .parties{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:8px; }\n  .card{ background:#f1f5f9; padding:10px; border-radius:6px; }\n  .card h3{ margin:0 0 6px 0; color:var(--primary); font-size:15px; }\n  .card p{ margin:3px 0; color:var(--secondary); font-size:12.5px; }\n\n  table{ width:100%; border-collapse:collapse; margin-top:14px; font-size:13px; }\n  th{ background:var(--primary); color:white; border:1px solid var(--border); padding:8px; text-align:left; }\n  td{ border:1px solid var(--border); padding:8px; color:var(--text); vertical-align:top; }\n  tbody tr:nth-child(even){ background:#f1f5f9; }\n  .mono{ text-align:right; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }\n\n  .notes, .receiving-notes{\n    margin-top:12px; padding:10px; border-left:4px solid var(--accent); background:#e2e8f0;\n    font-size:12.5px; color:var(--secondary); border-radius:4px;\n  }\n\n  .signatures{ display:grid; grid-template-columns: repeat(3,1fr); gap:16px; margin-top:20px; }\n  .sig{ border-top:1px solid var(--border); padding-top:8px; font-size:12px; color:var(--secondary); min-height:48px; }\n  .sig .label{ color:var(--primary); font-weight:600; display:block; margin-bottom:4px; }\n</style>\n</head>\n<body>\n  <div class=\"page\">\n    <div class=\"doc-header\">SHIPPING DOCUMENT (RECEIVING)</div>\n\n    <div class=\"topbar\">\n      <div class=\"co\">\n        <h2 id=\"company_name\">Company Name</h2>\n        <p id=\"company_address\">Company Address</p>\n        <p><span id=\"company_phone\">Phone</span> • <span id=\"company_email\">Email</span></p>\n      </div>\n      <div class=\"logo\" id=\"logo\"></div>\n    </div>\n\n    <div class=\"meta\">\n      <div class=\"kv\"><div class=\"k\">Shipping Doc #</div><div class=\"v\" id=\"shipping_document_number\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Document Date</div><div class=\"v\" id=\"shipping_doc_date\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Order # (PO/SO)</div><div class=\"v\"><span id=\"purchase_order_number\">-</span> <span id=\"sales_order_number\">-</span></div></div>\n      <div class=\"kv\"><div class=\"k\">Carrier</div><div class=\"v\" id=\"shipping_carrier\">-</div></div>\n\n      <div class=\"kv\"><div class=\"k\">Method</div><div class=\"v\" id=\"shipping_method\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Tracking #</div><div class=\"v\" id=\"tracking_number\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Date Shipped</div><div class=\"v\" id=\"date_shipped\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Date Delivered</div><div class=\"v\" id=\"date_delivered\">-</div></div>\n\n      <div class=\"kv\"><div class=\"k\">Received Date</div><div class=\"v\" id=\"received_date\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Proof of Delivery</div><div class=\"v\" id=\"proof_of_delivery\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Bill of Lading #</div><div class=\"v\" id=\"bill_of_lading_number\">-</div></div>\n      <div class=\"kv\"><div class=\"k\">Customer #</div><div class=\"v\" id=\"customer_number\">-</div></div>\n    </div>\n\n    <div class=\"parties\">\n      <div class=\"card\">\n        <h3>Customer / Receiver (Consignee)</h3>\n        <p><strong id=\"customer_name_party\">Customer Name</strong></p>\n        <p id=\"customer_address_party\">Customer Address</p>\n        <p><em>Consignee's Name & Address:</em> <span id=\"consignee_name_and_address\">-</span></p>\n      </div>\n      <div class=\"card\">\n        <h3>Supplier / Shipper</h3>\n        <p><strong id=\"supplier_name\">Supplier Name</strong></p>\n        <p id=\"supplier_address\">Supplier Address</p>\n        <p><em>Shipper's Name & Address:</em> <span id=\"shipper_name_and_address\">-</span></p>\n      </div>\n    </div>\n\n    <table>\n      <thead>\n        <tr>\n          <th style=\"width:24%\">Product Description</th>\n          <th style=\"width:10%\">Product Code</th>\n          <th style=\"width:8%\">UOM</th>\n          <th class=\"mono\" style=\"width:10%\">Qty Shipped</th>\n          <th class=\"mono\" style=\"width:10%\">Qty Received</th>\n          <th class=\"mono\" style=\"width:10%\">Damaged Qty</th>\n          <th class=\"mono\" style=\"width:10%\">Short/Over</th>\n          <th style=\"width:18%\">Remarks</th>\n        </tr>\n      </thead>\n      <tbody id=\"receiving_items_table\">\n        <tr>\n          <td>-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td>-</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <table>\n      <thead>\n        <tr>\n          <th style=\"width:20%\">Currency</th>\n          <th class=\"mono\" style=\"width:20%\">Unit Price</th>\n          <th class=\"mono\" style=\"width:20%\">Line Amount</th>\n          <th style=\"width:40%\">Pricing Notes</th>\n        </tr>\n      </thead>\n      <tbody id=\"receiving_amounts_table\">\n        <tr>\n          <td>-</td>\n          <td class=\"mono\">-</td>\n          <td class=\"mono\">-</td>\n          <td>-</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <div class=\"notes\">\n      <strong>Packaging:</strong> <span id=\"packaging_details\">-</span> &nbsp; | &nbsp;\n      <strong>Insurance:</strong> <span id=\"insurance_details\">-</span> &nbsp; | &nbsp;\n      <strong>Customs:</strong> <span id=\"customs_information\">-</span> &nbsp; | &nbsp;\n      <strong>Shipping/Delivery Terms:</strong> <span id=\"shipping_or_delivery_terms\">-</span>\n    </div>\n\n    <div class=\"receiving-notes\">\n      <p><strong>Inspection Status:</strong> <span id=\"receiving_inspection_status\">-</span></p>\n      <p><strong>Discrepancy Summary:</strong> <span id=\"receiving_discrepancy_summary\">-</span></p>\n      <p><strong>Condition on Arrival:</strong> <span id=\"receiving_condition_notes\">-</span></p>\n      <p><strong>Additional Notes:</strong> <span id=\"receiving_additional_notes\">-</span></p>\n    </div>\n\n    <div class=\"signatures\">\n      <div class=\"sig\">\n        <span class=\"label\">Received By (Consignee)</span>\n        <span id=\"received_by\">-</span>\n      </div>\n      <div class=\"sig\">\n        <span class=\"label\">Checked/Inspected By</span>\n        <span id=\"inspected_by\">-</span>\n      </div>\n      <div class=\"sig\">\n        <span class=\"label\">Carrier Representative</span>\n        <span id=\"carrier_signature\">-</span>\n      </div>\n    </div>\n  </div>\n\n<script>\n// JSON Data Variable - Replace this with your actual JSON data\nconst jsonData = {{ $json.formattedResponse.toJsonString() }} ;\n\nfunction formatCurrency(value, currency = 'USD') {\n  if (!value) return '';\n  const num = parseFloat(value.toString().replace(/[^\\d.-]/g, ''));\n  if (isNaN(num)) return value;\n  return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 });\n}\n\nfunction updateDocument(data) {\n  // Update colors\n  if (data.colors) {\n    const root = document.documentElement;\n    if (data.colors.primary_color) root.style.setProperty('--primary', data.colors.primary_color);\n    if (data.colors.secondary_color) root.style.setProperty('--secondary', data.colors.secondary_color);\n  }\n  \n  // Update branding\n  if (data.branding) {\n    if (data.branding.logo_url) {\n      const logo = document.getElementById('logo');\n      logo.style.backgroundImage = `url('${data.branding.logo_url}')`;\n    }\n    if (data.branding.font_family) {\n      document.body.style.fontFamily = data.branding.font_family;\n    }\n  }\n  \n  // Update company info\n  if (data.company_info) {\n    updateElement('company_name', data.company_info.company_name);\n    updateElement('company_address', data.company_info.company_address);\n    updateElement('company_phone', data.company_info.company_phone);\n    updateElement('company_email', data.company_info.company_email);\n  }\n  \n  // Update document info\n  if (data.document_info) {\n    Object.keys(data.document_info).forEach(key => {\n      updateElement(key, data.document_info[key]);\n    });\n  }\n  \n  // Update parties\n  if (data.parties) {\n    updateElement('customer_name_party', data.parties.customer_name);\n    updateElement('customer_address_party', data.parties.customer_address);\n    updateElement('consignee_name_and_address', data.parties.consignee_name_and_address);\n    updateElement('supplier_name', data.parties.supplier_name);\n    updateElement('supplier_address', data.parties.supplier_address);\n    updateElement('shipper_name_and_address', data.parties.shipper_name_and_address);\n  }\n  \n  // Update receiving items table\n  if (data.receiving_items && data.receiving_items.length > 0) {\n    const tbody = document.getElementById('receiving_items_table');\n    tbody.innerHTML = '';\n    data.receiving_items.forEach(item => {\n      const row = document.createElement('tr');\n      row.innerHTML = `\n        <td>${item.product_description || ''}</td>\n        <td class=\"mono\">${item.product_code || ''}</td>\n        <td class=\"mono\">${item.unit_of_measurement || ''}</td>\n        <td class=\"mono\">${item.qty_shipped || ''}</td>\n        <td class=\"mono\">${item.qty_received || ''}</td>\n        <td class=\"mono\">${item.damaged_qty || ''}</td>\n        <td class=\"mono\">${item.short_over || ''}</td>\n        <td>${item.remarks || ''}</td>\n      `;\n      tbody.appendChild(row);\n    });\n  }\n  \n  // Update receiving amounts table\n  if (data.receiving_amounts && data.receiving_amounts.length > 0) {\n    const tbody = document.getElementById('receiving_amounts_table');\n    tbody.innerHTML = '';\n    data.receiving_amounts.forEach(amount => {\n      const row = document.createElement('tr');\n      row.innerHTML = `\n        <td>${amount.currency || ''}</td>\n        <td class=\"mono\">${formatCurrency(amount.unit_price)}</td>\n        <td class=\"mono\">${formatCurrency(amount.line_amount)}</td>\n        <td>${amount.pricing_notes || ''}</td>\n      `;\n      tbody.appendChild(row);\n    });\n  }\n  \n  // Update additional info\n  if (data.additional_info) {\n    Object.keys(data.additional_info).forEach(key => {\n      updateElement(key, data.additional_info[key]);\n    });\n  }\n  \n  // Update signatures\n  if (data.signatures) {\n    Object.keys(data.signatures).forEach(key => {\n      updateElement(key, data.signatures[key]);\n    });\n  }\n}\n\nfunction updateElement(id, value) {\n  const element = document.getElementById(id);\n  if (element && value !== undefined && value !== null) {\n    element.textContent = value;\n  }\n}\n\n// Auto-update on page load\ndocument.addEventListener('DOMContentLoaded', function() {\n  updateDocument(jsonData);\n});\n</script>\n\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3600,
        13540
      ],
      "id": "11f5b801-f87a-4b05-a055-74faf25f4197",
      "name": "Edit Fields27"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3800,
        13540
      ],
      "id": "2209472e-7e21-416f-8843-7baf9fdc6a6a",
      "name": "Code21",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cc58413-63c7-4085-bd98-9d87569e032b",
              "name": "=html",
              "value": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Order Document</title>\n  <style>\n    :root {\n      --space: 20px;\n      --primary-color: #334155;\n      --secondary-color: #4338ca;\n      --font-family: Arial;\n    }\n    body {\n      font-family: var(--font-family), Arial, sans-serif;\n      max-width: 1000px;\n      margin: 0 auto;\n      padding: 20px;\n      background-color: #f9fafb;\n      color: #1e293b;\n    }\n    .doc {\n      background: #ffffff;\n      border: 2px solid var(--primary-color);\n      padding: 30px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    }\n    .doc-header {\n      background: var(--primary-color);\n      color: #ffffff;\n      padding: 20px;\n      margin: -30px -30px 30px -30px;\n      text-align: center;\n      font-size: 28px;\n      font-weight: bold;\n      letter-spacing: 2px;\n    }\n    .subtitle {\n      font-size: 14px;\n      opacity: 0.9;\n      margin-top: 4px;\n      letter-spacing: 1px;\n    }\n    .company-info {\n      margin-bottom: 30px;\n      position: relative;\n      min-height: 70px;\n    }\n    .company-info h2 {\n      margin: 0 0 10px 0;\n      color: var(--primary-color);\n      font-size: 22px;\n    }\n    .company-info p {\n      margin: 2px 0;\n      color: #475569;\n    }\n    .logo {\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 100px;\n      height: 70px;\n      background: var(--primary-color);\n      color: #ffffff;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 5px;\n      font-weight: bold;\n      background-image: url('https://logoipsum.com/wp-content/uploads/2020/07/logo-29.svg');\n      background-size: cover;\n      background-position: center;\n    }\n\n    .order-details {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 16px;\n      margin: 30px 0;\n      background: rgba(67, 56, 202, 0.1);\n      padding: 15px;\n      border-radius: 5px;\n    }\n    .meta p {\n      margin: 6px 0;\n      color: #334155;\n      line-height: 1.25;\n    }\n    .meta strong {\n      color: var(--primary-color);\n    }\n\n    .party-cards {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 16px;\n    }\n    .card {\n      background: rgba(67, 56, 202, 0.05);\n      padding: 15px;\n      border-radius: 5px;\n      border-left: 3px solid var(--secondary-color);\n    }\n    .card h3 {\n      margin: 0 0 10px 0;\n      color: var(--primary-color);\n    }\n    .card p {\n      margin: 3px 0;\n      color: #475569;\n    }\n\n    .items-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 30px 0;\n      table-layout: fixed;\n      word-wrap: break-word;\n    }\n    .items-table th {\n      background: var(--primary-color);\n      color: #ffffff;\n      border: 1px solid var(--primary-color);\n      padding: 10px 12px;\n      text-align: left;\n      font-weight: bold;\n    }\n    .items-table td {\n      border: 1px solid #cbd5e1;\n      padding: 10px 12px;\n      color: #1e293b;\n      vertical-align: top;\n    }\n    .items-table tr:nth-child(even) {\n      background: rgba(67, 56, 202, 0.05);\n    }\n    .amount {\n      text-align: right;\n      font-family: monospace;\n      font-weight: bold;\n      white-space: nowrap;\n    }\n\n    .total-section {\n      margin: 30px 0;\n      background: rgba(67, 56, 202, 0.1);\n      padding: 20px;\n      border-radius: 5px;\n      display: grid;\n      gap: 6px;\n      justify-items: end;\n    }\n    .total-section p {\n      margin: 0;\n      font-size: 16px;\n      color: #334155;\n    }\n    .final-total {\n      font-size: 20px;\n      font-weight: bold;\n      color: var(--primary-color);\n      border-top: 2px solid var(--primary-color);\n      padding-top: 10px;\n      margin-top: 6px;\n    }\n\n    .terms, .sign {\n      background: #f1f5f9;\n      padding: 15px;\n      border-left: 4px solid var(--secondary-color);\n      margin: 20px 0 0 0;\n      color: #475569;\n    }\n    .terms h4, .sign h4 {\n      margin: 0 0 10px 0;\n      color: var(--primary-color);\n    }\n    .sign .row {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 16px;\n    }\n    .sig-line {\n      margin-top: 24px;\n      border-top: 1px solid #cbd5e1;\n      padding-top: 8px;\n      color: #1e293b;\n    }\n\n    @media print {\n      @page { size: A4 landscape; margin: 12mm; }\n      body { max-width: none; padding: 0; background-color: #ffffff; }\n      .doc { box-shadow: none; border: 1px solid var(--primary-color); }\n      .items-table tr, .items-table td, .items-table th { page-break-inside: avoid; }\n      .total-section, .terms, .sign { page-break-inside: avoid; }\n    }\n\n    /* Dynamic color support */\n    .primary-bg { background-color: var(--primary-color); }\n    .secondary-bg { background-color: var(--secondary-color); }\n    .primary-text { color: var(--primary-color); }\n    .secondary-text { color: var(--secondary-color); }\n  </style>\n</head>\n<body>\n  <div class=\"doc\">\n    <div class=\"doc-header\">\n      ORDER DOCUMENT\n      <div class=\"subtitle\">Purchase Order</div>\n    </div>\n\n    <div class=\"company-info\">\n      <div class=\"logo\"></div>\n      <h2 id=\"company-name\">SolarVista Energy</h2>\n      <p id=\"company-address\">123 Business Plaza, Suite 500, Denver, CO 80202</p>\n      <p id=\"company-phone\">Phone: (555) 123-4567</p>\n      <p id=\"company-email\">Email: orders@solarvista.com</p>\n    </div>\n\n    <div class=\"order-details\">\n      <div class=\"meta\">\n        <p><strong>Purchase Order Number:</strong> <span id=\"purchase_order_number\">PO-0021</span></p>\n        <p><strong>Sales Order Number:</strong> <span id=\"sales_order_number\">SO-2024-0158</span></p>\n        <p><strong>Purchase Order Date:</strong> <span id=\"purchase_order_date\">2024-01-03</span></p>\n        <p><strong>Sales Order Date:</strong> <span id=\"sales_order_date\">2024-01-02</span></p>\n        <p><strong>Delivery Date:</strong> <span id=\"delivery_date\">2024-01-09</span></p>\n        <p><strong>Currency Unit:</strong> <span id=\"currency_unit\">USD ($)</span></p>\n      </div>\n      <div class=\"meta\">\n        <p><strong>Supplier Number:</strong> <span id=\"supplier_number\">SUPP-001</span></p>\n        <p><strong>Customer Number:</strong> <span id=\"customer_number\">CUST-SVE-001</span></p>\n        <p><strong>Shipping Terms:</strong> <span id=\"shipping_terms\">FOB Destination</span></p>\n        <p><strong>Payment Terms:</strong> <span id=\"payment_terms\">Net 45</span></p>\n      </div>\n    </div>\n\n    <div class=\"party-cards\">\n      <div class=\"card\">\n        <h3>Supplier</h3>\n        <p><strong>Name:</strong> <span id=\"supplier_name\">Valarix Supplies</span></p>\n        <p><strong>Address:</strong> <span id=\"supplier_address\">650 Market St, Denver, CO 80203</span></p>\n      </div>\n      <div class=\"card\">\n        <h3>Customer</h3>\n        <p><strong>Name:</strong> <span id=\"customer_name\">SolarVista Energy</span></p>\n        <p><strong>Address:</strong> <span id=\"customer_address\">123 Business Plaza, Suite 500, Denver, CO 80202</span></p>\n      </div>\n    </div>\n\n    <table class=\"items-table\">\n      <thead>\n        <tr>\n          <th>Product Description</th>\n          <th>Quantity</th>\n          <th>Unit</th>\n          <th>Unit Price</th>\n          <th>Line Total</th>\n          <th>Product Code</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>High-efficiency solar panels (Model X2), partial procurement for initial installation phase.</td>\n          <td class=\"amount\">99</td>\n          <td>Units</td>\n          <td class=\"amount\">$301.00</td>\n          <td class=\"amount\">$29,799.00</td>\n          <td>SP-X2-300W</td>\n        </tr>\n        <tr>\n          <td>Mounting hardware and installation brackets for solar panel system.</td>\n          <td class=\"amount\">99</td>\n          <td>Sets</td>\n          <td class=\"amount\">$45.00</td>\n          <td class=\"amount\">$4,455.00</td>\n          <td>MH-BRKT-STD</td>\n        </tr>\n        <tr>\n          <td>DC to AC inverters for solar energy conversion (high efficiency model).</td>\n          <td class=\"amount\">12</td>\n          <td>Units</td>\n          <td class=\"amount\">$850.00</td>\n          <td class=\"amount\">$10,200.00</td>\n          <td>INV-HE-5000</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <div class=\"total-section\">\n      <p><strong>Subtotal:</strong> <span id=\"subtotal\">$44,454.00</span></p>\n      <p><strong>Tax (5%):</strong> <span id=\"tax\">$2,222.70</span></p>\n      <p><strong>Freight Charges:</strong> <span id=\"freight_charges\">$750.00</span></p>\n      <p><strong>Discount:</strong> <span id=\"discount\">$0.00</span></p>\n      <p class=\"final-total\"><strong>Total:</strong> <span id=\"total_value\">$47,426.70</span></p>\n    </div>\n\n    <div class=\"terms\">\n      <h4>Terms and Conditions</h4>\n      <div id=\"terms_conditions\">\n        All goods remain the property of the supplier until payment is received in full. \n        Delivery terms are FOB destination. Any damages must be reported within 48 hours of delivery. \n        Payment is due within 45 days of invoice date. Late payments may incur a 1.5% monthly service charge.\n        All returns require prior authorization and are subject to a 15% restocking fee.\n      </div>\n    </div>\n\n    <div class=\"sign\">\n      <h4>Signatures</h4>\n      <div class=\"row\">\n        <div>\n          <div class=\"sig-line\">Authorized Signatory (Supplier)</div>\n          <div>Name: <span id=\"supplier_signatory_name\">Michael Rodriguez</span></div>\n          <div>Date: <span id=\"supplier_sign_date\">2024-01-03</span></div>\n        </div>\n        <div>\n          <div class=\"sig-line\">Authorized Signatory (Customer)</div>\n          <div>Name: <span id=\"customer_signatory_name\">Sarah Chen</span></div>\n          <div>Date: <span id=\"customer_sign_date\">2024-01-03</span></div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    // Function to populate document with JSON data\n    function renderOrderDocument(jsonData) {\n      // Helper function to add $ prefix if not present\n      function formatCurrency(value) {\n        if (!value) return '$0.00';\n        const numStr = value.toString().replace(/[$,]/g, '');\n        const num = parseFloat(numStr);\n        return isNaN(num) ? value : '$' + num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});\n      }\n\n      // Update CSS variables for colors\n      if (jsonData.colors || jsonData.document_style) {\n        const colors = jsonData.colors || jsonData.document_style;\n        if (colors.primary_color) {\n          document.documentElement.style.setProperty('--primary-color', colors.primary_color);\n        }\n        if (colors.secondary_color) {\n          document.documentElement.style.setProperty('--secondary-color', colors.secondary_color);\n        }\n      }\n\n      if (jsonData.branding && jsonData.branding.font_family) {\n        document.documentElement.style.setProperty('--font-family', jsonData.branding.font_family);\n      }\n\n      // Update logo\n      if (jsonData.branding && jsonData.branding.logo_url) {\n        const logoElement = document.querySelector('.logo');\n        if (logoElement) {\n          logoElement.style.backgroundImage = `url('${jsonData.branding.logo_url}')`;\n        }\n      }\n\n      // Update company information\n      if (jsonData.company) {\n        const companyName = document.getElementById('company-name');\n        const companyAddress = document.getElementById('company-address');\n        const companyPhone = document.getElementById('company-phone');\n        const companyEmail = document.getElementById('company-email');\n        \n        if (companyName) companyName.textContent = jsonData.company.company_name || 'SolarVista Energy';\n        if (companyAddress) companyAddress.textContent = jsonData.company.company_address || '123 Business Plaza, Suite 500, Denver, CO 80202';\n        if (companyPhone) companyPhone.textContent = jsonData.company.company_phone || 'Phone: (555) 123-4567';\n        if (companyEmail) companyEmail.textContent = jsonData.company.company_email || 'Email: orders@solarvista.com';\n      }\n\n      // Update purchase order details\n      if (jsonData.purchase_order) {\n        const po = jsonData.purchase_order;\n        document.getElementById('purchase_order_number').textContent = po.purchase_order_number || 'PO-0021';\n        document.getElementById('purchase_order_date').textContent = po.purchase_order_date || '2024-01-03';\n        document.getElementById('sales_order_number').textContent = po.sales_order_number || 'SO-2024-0158';\n        document.getElementById('sales_order_date').textContent = po.sales_order_date || '2024-01-02';\n        document.getElementById('delivery_date').textContent = po.delivery_date || '2024-01-09';\n        document.getElementById('currency_unit').textContent = po.currency_unit || 'USD ($)';\n        document.getElementById('supplier_number').textContent = po.supplier_number || 'SUPP-001';\n        document.getElementById('customer_number').textContent = po.customer_number || 'CUST-SVE-001';\n        document.getElementById('shipping_terms').textContent = po.shipping_terms || 'FOB Destination';\n        document.getElementById('payment_terms').textContent = po.payment_terms || 'Net 45';\n      }\n\n      // Update supplier and customer information\n      if (jsonData.supplier) {\n        document.getElementById('supplier_name').textContent = jsonData.supplier.supplier_name || jsonData.supplier.name || 'Valarix Supplies';\n        document.getElementById('supplier_address').textContent = jsonData.supplier.supplier_address || jsonData.supplier.address || '650 Market St, Denver, CO 80203';\n      }\n\n      if (jsonData.customer) {\n        document.getElementById('customer_name').textContent = jsonData.customer.customer_name || jsonData.customer.name || 'SolarVista Energy';\n        document.getElementById('customer_address').textContent = jsonData.customer.customer_address || jsonData.customer.address || '123 Business Plaza, Suite 500, Denver, CO 80202';\n      }\n\n      // Update items table\n      if (jsonData.items && jsonData.items.length > 0) {\n        const tbody = document.querySelector('.items-table tbody');\n        if (tbody) {\n          tbody.innerHTML = '';\n          jsonData.items.forEach(item => {\n            const row = document.createElement('tr');\n            row.innerHTML = `\n              <td>${item.description || ''}</td>\n              <td class=\"amount\">${item.quantity || ''}</td>\n              <td>${item.unit_of_measure || item.unit || 'Units'}</td>\n              <td class=\"amount\">${formatCurrency(item.unit_price)}</td>\n              <td class=\"amount\">${formatCurrency(item.line_total)}</td>\n              <td>${item.product_code || item.item_id || ''}</td>\n            `;\n            tbody.appendChild(row);\n          });\n        }\n      }\n\n      // Update totals\n      if (jsonData.totals) {\n        document.getElementById('subtotal').textContent = formatCurrency(jsonData.totals.subtotal);\n        document.getElementById('tax').textContent = formatCurrency(jsonData.totals.tax);\n        document.getElementById('freight_charges').textContent = formatCurrency(jsonData.totals.freight_charges);\n        document.getElementById('discount').textContent = formatCurrency(jsonData.totals.discount);\n        document.getElementById('total_value').textContent = formatCurrency(jsonData.totals.total_value);\n      }\n\n      // Update terms and conditions\n      if (jsonData.terms_conditions) {\n        document.getElementById('terms_conditions').textContent = jsonData.terms_conditions;\n      }\n\n      // Update signatures\n      if (jsonData.signatures) {\n        document.getElementById('supplier_signatory_name').textContent = jsonData.signatures.supplier_signatory_name || 'Michael Rodriguez';\n        document.getElementById('supplier_sign_date').textContent = jsonData.signatures.supplier_sign_date || '2024-01-03';\n        document.getElementById('customer_signatory_name').textContent = jsonData.signatures.customer_signatory_name || 'Sarah Chen';\n        document.getElementById('customer_sign_date').textContent = jsonData.signatures.customer_sign_date || '2024-01-03';\n      }\n    }\n\n    // Sample data with complete information\n    const sampleData ={{ $json.formattedResponse.toJsonString() }} ;\n\n    // Make functions globally available\n    window.renderOrderDocument = renderOrderDocument;\n\n    // Load the sample data on page load\n    document.addEventListener('DOMContentLoaded', function() {\n      renderOrderDocument(sampleData);\n    });\n  </script>\n</body>\n</html>",
              "type": "object"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3580,
        13800
      ],
      "id": "69f129f9-ce55-4267-92b2-8a8ff57c481c",
      "name": "Edit Fields28"
    },
    {
      "parameters": {
        "jsCode": "return {\n  formattedResponse: JSON.parse($json.output)\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3780,
        13800
      ],
      "id": "47d8cab7-a8d8-47c8-8d4c-7ee84a2f1b5e",
      "name": "Code22",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "94d0b360-b005-4dac-82e9-4f31fad3d382",
              "name": "company",
              "value": "={{ $json.input_config.stage1.companies[0] }}",
              "type": "object"
            },
            {
              "id": "4b5fe273-05f5-4869-8d4e-c4184b57b72e",
              "name": "clean_document_data",
              "value": "={{ $json.cleansimulation.simulationRuns[0].generatedDocuments }}",
              "type": "array"
            },
            {
              "id": "a6908ae3-3525-4b62-9d64-5b200fed01d7",
              "name": "company_profile",
              "value": "={{ $json.document_data.companyProfile }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -8000,
        12340
      ],
      "id": "1e73870d-83c4-4826-b880-2446e58bce80",
      "name": "Edit Fields29",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7800,
        12480
      ],
      "id": "38aa3ec4-a377-432f-87ad-c6d71179b7cb",
      "name": "Merge5"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.simulations }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "03b76d57-096f-4cc4-910d-4d3a30f37478"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c1fd9088-d987-47e1-bb98-73aaa21c35a0",
                    "leftValue": "={{ $json.clean_document_data }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -6980,
        12600
      ],
      "id": "cb11086c-739a-46ea-84ba-c65b8a605d8b",
      "name": "Switch1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "clean_document_data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -6700,
        12720
      ],
      "id": "47f000fa-2402-497e-84b2-58d533884106",
      "name": "Split Out8"
    },
    {
      "parameters": {
        "operation": "compress",
        "binaryPropertyName": "={{ Object.keys($binary).join(',') }}",
        "fileName": "={{ $runIndex === 0 \n    ? $('Switch3').first().json.companyProfile.company_name + '_'+ $now.format('yyyy-MM-dd') +'_Clean.zip' \n    : $('Switch3').first().json.companyProfile.company_name + '_'+$now.format('yyyy-MM-dd') +'.zip' \n}}"
      },
      "type": "n8n-nodes-base.compression",
      "typeVersion": 1.1,
      "position": [
        -900,
        14060
      ],
      "id": "62b5f014-c288-4c0e-93ac-35289f9cd495",
      "name": "Compression2"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -6580,
        12340
      ],
      "id": "23385cba-6395-442e-affb-5beebead2c93",
      "name": "Aggregate4"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "cleanpdffiles",
        "options": {
          "fileName": "={{ $('If5').item.json.file_name+'_clean.zip' }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -8780,
        12100
      ],
      "id": "86ccae54-adfd-4a45-a4c5-5de7a32b4658",
      "name": "Convert to File17"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -8440,
        12020
      ],
      "id": "cd4bee4f-cf60-42c1-92a4-c4200e3e4901",
      "name": "Merge6"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -10700,
        12580
      ],
      "id": "45f145a6-f49f-40e6-9f22-68bc1cd07588",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ad77a3cb-3593-4bc8-a8bc-9af28245fae1",
              "name": "fileid",
              "value": "={{ $json.query.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -10500,
        12240
      ],
      "id": "1dbccacb-cc0e-439f-a485-ea9a1ddc7bb6",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -9100,
        12480
      ],
      "id": "5a4e5564-e9a4-41da-9791-af9b20b825a1",
      "name": "Edit Fields30"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "faaee4d1-dc0f-4a07-afb8-de1dbc552c6d",
              "name": "fileid",
              "value": "={{ $json.fileid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -10100,
        12440
      ],
      "id": "7745f033-4cec-4191-9524-0016c527a354",
      "name": "Edit Fields31"
    },
    {
      "parameters": {
        "path": "get_pdf",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -10720,
        12240
      ],
      "id": "1236775c-f0be-4e97-81b4-b4465040a797",
      "name": "Webhook7",
      "webhookId": "f29fb583-53b3-4aa3-a286-955e1c21da05"
    }
  ],
  "pinData": {
    "When clicking ‘Execute workflow’": [
      {
        "json": {
          "body": {
            "projectName": "Docent Project",
            "scenarioName": "Docent Scenario",
            "session_id": "21c8d724-fdbb-49db-9fbe-612d82e87645",
            "company_count": 1,
            "stage1": {
              "company_count": 1,
              "companies": [
                {
                  "company_name": "NeuroSynth MedTech",
                  "industry": "Healthcare",
                  "region": "United States",
                  "fiscal_year_end": "December 31",
                  "business_context": {
                    "business_model": "Subscription-based",
                    "description": "NeuroSynth MedTech is a health tech company specialized in creating transformative technology for the neurology sector. They offer a subscription-based model where healthcare organizations get access to their innovative medical devices and software solutions. These tools help doctors to diagnose and treat neurological disorders with higher accuracy and efficiency."
                  }
                }
              ]
            },
            "profiles": [
              {
                "company_name": "NeuroSynth MedTech",
                "industry": "healthcare",
                "region": "United States",
                "fiscal_year_end": "December 31",
                "business_context": {
                  "ticker": null,
                  "sector": "Other",
                  "market_cap": null,
                  "primary_products": [
                    "Booking platform",
                    "Practice mgmt"
                  ],
                  "business_model": "Subscription-based",
                  "regulatory_environment": "HIPAA, HITECH",
                  "known_risks": [
                    "PHI handling",
                    "chargebacks/rebates",
                    "cutoff errors",
                    "missing documentation"
                  ],
                  "description": "NeuroSynth MedTech is a health tech company specialized in creating transformative technology for the neurology sector. They offer a subscription-based model where healthcare organizations get access to their innovative medical devices and software solutions. These tools help doctors to diagnose and treat neurological disorders with higher accuracy and efficiency.",
                  "revenue_model": "subscription",
                  "geographic_footprint": [
                    "United States"
                  ],
                  "key_customers": [
                    "clinics",
                    "hospitals"
                  ],
                  "seasonal_patterns": false,
                  "prior_audit_findings": null,
                  "management_integrity_concerns": null,
                  "internal_control_maturity": "developing"
                },
                "branding": {
                  "logo_url": "https://logoipsum.com/wp-content/uploads/2020/07/logo-23.svg",
                  "primary_color": "#334155",
                  "secondary_color": "#0F172A",
                  "font_family": "Inter",
                  "document_style": "modern"
                },
                "revenue_model": "subscription",
                "company_specific_risks": null,
                "vendors": [
                  {
                    "name": "Synetix Global",
                    "entity_type": "vendor",
                    "industry": "healthcare",
                    "address": "575 Market St, Denver, CO",
                    "tags": [
                      "preferred",
                      "net30"
                    ],
                    "metadata": {},
                    "branding": {
                      "logo_url": "https://logoipsum.com/wp-content/uploads/2020/07/logo-13.svg",
                      "primary_color": "#334155",
                      "secondary_color": "#0F172A",
                      "font_family": "Inter",
                      "document_style": "formal"
                    }
                  }
                ],
                "banks": [
                  {
                    "name": "RiverRock Bank",
                    "entity_type": "bank",
                    "industry": "Financials",
                    "address": "383 Main Ave, Evergreen, CO",
                    "tags": [
                      "primary"
                    ],
                    "metadata": {},
                    "branding": {
                      "logo_url": "https://logoipsum.com/wp-content/uploads/2020/07/logo-10.svg",
                      "primary_color": "#334155",
                      "secondary_color": "#0F172A",
                      "font_family": "Inter",
                      "document_style": "formal"
                    }
                  }
                ],
                "shipping_partners": [
                  {
                    "name": "SwiftShip Logistics",
                    "entity_type": "shipper",
                    "industry": "Logistics",
                    "address": "1251 Freight Rd, Denver, CO",
                    "tags": [
                      "ground",
                      "tracking"
                    ],
                    "metadata": {},
                    "branding": {
                      "logo_url": "https://logoipsum.com/wp-content/uploads/2020/07/logo-13.svg",
                      "primary_color": "#334155",
                      "secondary_color": "#0F172A",
                      "font_family": "Inter",
                      "document_style": "formal"
                    }
                  }
                ]
              }
            ],
            "companies": [
              {
                "company_name": "NeuroSynth MedTech",
                "industry": "healthcare",
                "documents": [
                  {
                    "document_type": "Invoice (Goods)",
                    "source": "External",
                    "file_type": "PDF",
                    "required_fields": [
                      "Invoice_Number",
                      "Date_of_Invoice",
                      "Supplier_Name",
                      "Product_Description",
                      "Item_Quantity",
                      "Item_Price",
                      "Total_Amount_Due",
                      "Purchase_Order_Number",
                      "Delivery_/_Completion_Date",
                      "Currency_Unit"
                    ],
                    "optional_fields": [
                      "Payment_Due_Date",
                      "Supplier_Number",
                      "Supplier_Address",
                      "Customer_Name",
                      "Customer_Account_Number",
                      "Customer_Address",
                      "Product_Code",
                      "Payment_Terms",
                      "Tax_Details",
                      "Line_Item_Amount",
                      "Tax",
                      "Freight_Charges",
                      "Discount",
                      "Shipping_or_Delivery_Terms",
                      "Sales_Order_Number_/_Work_Order_Number",
                      "Unit_of_measurement",
                      "Selling_costs",
                      "Transfer_of_rights_indication",
                      "Customer_Number",
                      "Signature"
                    ],
                    "linking_fields": [
                      "Invoice Number",
                      "PO Number"
                    ],
                    "hints": {
                      "preferred_vendors": [
                        "Synetix Global"
                      ],
                      "primary_bank": "RiverRock Bank",
                      "shipping_partners": [
                        "SwiftShip Logistics"
                      ],
                      "industry": "healthcare",
                      "region": "United States"
                    },
                    "edge_case_hooks": [
                      "timing_cutoff_errors",
                      "document_mismatches",
                      "vendor_irregularities",
                      "process_gaps",
                      "suspicious_amounts_or_frequencies",
                      "external_discrepancies",
                      "documentation_anomalies"
                    ]
                  },
                  {
                    "document_type": "Bank Statement",
                    "source": "External",
                    "file_type": "PDF",
                    "required_fields": [
                      "Account_Number",
                      "Statement_Period",
                      "Opening_or_Beginning_or_Previous_Balance",
                      "Closing_or_Ending_Balance",
                      "Deposit_or_Credit_Totals",
                      "Withdrawal_or_Debit_Totals",
                      "Transactional_Details",
                      "Date_of_transaction",
                      "Transaction_Number",
                      "Balance",
                      "Bank_name"
                    ],
                    "optional_fields": [
                      "Deposit_or_Credit_Amount",
                      "Withdrawals_or_Debit_Amounts",
                      "Fees_Charged",
                      "Interest_Earned",
                      "Interest_Paid",
                      "Account_Alerts",
                      "Account_Closure_details",
                      "Account_type"
                    ],
                    "linking_fields": [
                      "Vendor",
                      "Amount",
                      "Date"
                    ],
                    "hints": {
                      "preferred_vendors": [
                        "Synetix Global"
                      ],
                      "primary_bank": "RiverRock Bank",
                      "shipping_partners": [
                        "SwiftShip Logistics"
                      ],
                      "industry": "healthcare",
                      "region": "United States"
                    },
                    "edge_case_hooks": [
                      "timing_cutoff_errors",
                      "document_mismatches",
                      "vendor_irregularities",
                      "process_gaps",
                      "suspicious_amounts_or_frequencies",
                      "external_discrepancies",
                      "documentation_anomalies"
                    ]
                  },
                  {
                    "document_type": "Shipping Document (Sending)",
                    "source": "External",
                    "file_type": "PDF",
                    "required_fields": [
                      "Shipping_Document_Number",
                      "Shipping_Doc_date",
                      "Customer_name",
                      "Customer_Address",
                      "Purchase_Order_Number",
                      "Item_Quantity",
                      "Product_Description",
                      "Supplier_Name",
                      "Supplier_Address",
                      "Date_Shipped",
                      "Shipping_carrier",
                      "Shipping_method",
                      "Tracking_number"
                    ],
                    "optional_fields": [
                      "Customer_Number",
                      "Supplier_Number",
                      "Product_Code",
                      "Item_Price",
                      "Unit_of_measurement",
                      "Currency_Unit",
                      "Line_item_amount",
                      "Date_Delivered",
                      "Shipper's_name_and_address",
                      "Consignee's_name_and_address",
                      "Bill_of_lading_number",
                      "Packaging_details",
                      "Insurance_details",
                      "Customs_information",
                      "Proof_of_delivery",
                      "Received_Date",
                      "Shipping_or_Delivery_Terms"
                    ],
                    "linking_fields": [
                      "Invoice Number",
                      "PO Number"
                    ],
                    "hints": {
                      "preferred_vendors": [
                        "Synetix Global"
                      ],
                      "primary_bank": "RiverRock Bank",
                      "shipping_partners": [
                        "SwiftShip Logistics"
                      ],
                      "industry": "healthcare",
                      "region": "United States"
                    },
                    "edge_case_hooks": [
                      "timing_cutoff_errors",
                      "document_mismatches",
                      "vendor_irregularities",
                      "process_gaps",
                      "suspicious_amounts_or_frequencies",
                      "external_discrepancies",
                      "documentation_anomalies"
                    ]
                  },
                  {
                    "document_type": "Order Document (Sales and Purchases)",
                    "source": "Internal",
                    "file_type": "PDF",
                    "required_fields": [
                      "Purchase_Order_Number",
                      "Purchase_Order_Date",
                      "Supplier_Name",
                      "Customer_Name",
                      "Item_Quantity",
                      "Product_Description",
                      "Unit_of_measurement",
                      "Currency_Unit",
                      "Item_Price",
                      "Total_Purchase_Order_Value",
                      "Delivery_Date"
                    ],
                    "optional_fields": [
                      "Supplier_Number",
                      "Supplier_Address",
                      "Customer_Number",
                      "Customer_Address",
                      "Product_Code",
                      "Line_Item_Amount",
                      "Tax",
                      "Freight_Charges",
                      "Discount",
                      "Shipping_or_Delivery_Terms",
                      "Payment_Terms",
                      "Terms_and_Conditions",
                      "Signature"
                    ],
                    "linking_fields": [
                      "Vendor",
                      "Amount",
                      "Date"
                    ],
                    "hints": {
                      "preferred_vendors": [
                        "Synetix Global"
                      ],
                      "primary_bank": "RiverRock Bank",
                      "shipping_partners": [
                        "SwiftShip Logistics"
                      ],
                      "industry": "healthcare",
                      "region": "United States"
                    },
                    "edge_case_hooks": [
                      "timing_cutoff_errors",
                      "document_mismatches",
                      "vendor_irregularities",
                      "process_gaps",
                      "suspicious_amounts_or_frequencies",
                      "external_discrepancies",
                      "documentation_anomalies"
                    ]
                  },
                  {
                    "document_type": "Disbursement Listing",
                    "source": "Internal",
                    "file_type": "CSV",
                    "required_fields": [
                      "Account_Number",
                      "Date_of_transaction",
                      "Transactional_Details",
                      "Transaction_Amount",
                      "Document Number",
                      "Transaction Description",
                      "Vendor Name",
                      "Vendor Number"
                    ],
                    "optional_fields": [],
                    "linking_fields": [
                      "Invoice Number"
                    ],
                    "hints": {
                      "preferred_vendors": [
                        "Synetix Global"
                      ],
                      "primary_bank": "RiverRock Bank",
                      "shipping_partners": [
                        "SwiftShip Logistics"
                      ],
                      "industry": "healthcare",
                      "region": "United States"
                    },
                    "edge_case_hooks": [
                      "timing_cutoff_errors",
                      "document_mismatches",
                      "vendor_irregularities",
                      "process_gaps",
                      "suspicious_amounts_or_frequencies",
                      "external_discrepancies",
                      "documentation_anomalies"
                    ]
                  }
                ]
              }
            ],
            "warnings": []
          }
        }
      }
    ]
  },
  "repo": {
    "owner": "Isaakkamau",
    "name": "simthetic-n8n-backup"
  },
  "repo_path": "workflows/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-07-11T10:25:22.773Z",
      "updatedAt": "2025-07-11T10:25:22.773Z",
      "role": "workflow:owner",
      "workflowId": "ZQ7ogeBD0qiSBtBM",
      "projectId": "qQl0DgBrylkFr1iU"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 7,
  "updatedAt": "2025-09-17T07:42:20.000Z",
  "versionId": "2cc18ef9-be2a-4f8b-9329-eabb89d0e578"
}